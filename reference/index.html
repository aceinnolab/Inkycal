
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://aceinnolab.github.io/Inkycal/reference/">
      
      
        <link rel="prev" href="../api/utils/">
      
      
        <link rel="next" href="../about/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>API Reference - Inkycal Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#inkycal-api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Inkycal Documentation" class="md-header__button md-logo" aria-label="Inkycal Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Inkycal Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-purple"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="deep-purple"  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Inkycal Documentation" class="md-nav__button md-logo" aria-label="Inkycal Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Inkycal Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Installation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install Inkycal
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quickstart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hardware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hardware Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Modules
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Modules
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/display/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Display Class
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/calendar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Calendar
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/weather.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Weather
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/image.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Image
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../inkycal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dev_doc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Developer Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modules/custom.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custom Module Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/canvas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Canvas Class
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#architecture-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        ðŸ§© Architecture Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#built-in-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        ðŸ“¦ Built-in Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ“¦ Built-in Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-index" class="md-nav__link">
    <span class="md-ellipsis">
      
        Module Index
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#module-reference-auto-generated" class="md-nav__link">
    <span class="md-ellipsis">
      
        ðŸ“š Module Reference (Auto-Generated)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ“š Module Reference (Auto-Generated)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#template-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        Template Module
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calendar" class="md-nav__link">
    <span class="md-ellipsis">
      
        Calendar
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_calendar" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_calendar
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_calendar.Calendar" class="md-nav__link">
    <span class="md-ellipsis">
      
        Calendar
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Calendar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_calendar.Calendar.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_calendar.Calendar.flatten" class="md-nav__link">
    <span class="md-ellipsis">
      
        flatten
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_calendar.Calendar.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather" class="md-nav__link">
    <span class="md-ellipsis">
      
        Weather
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_weather" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_weather
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_weather.Weather" class="md-nav__link">
    <span class="md-ellipsis">
      
        Weather
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Weather">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_weather.Weather.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_weather.Weather.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feeds" class="md-nav__link">
    <span class="md-ellipsis">
      
        Feeds
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_feeds" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_feeds
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_feeds.Feeds" class="md-nav__link">
    <span class="md-ellipsis">
      
        Feeds
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Feeds">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_feeds.Feeds.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_feeds.Feeds.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stocks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_stocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_stocks
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_stocks.Stocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stocks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_stocks.Stocks.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Module
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_image
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_image.Inkyimage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inkyimage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inkyimage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_image.Inkyimage.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_image.Inkyimage.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agenda" class="md-nav__link">
    <span class="md-ellipsis">
      
        Agenda
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_agenda" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_agenda
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_agenda.Agenda" class="md-nav__link">
    <span class="md-ellipsis">
      
        Agenda
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Agenda">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_agenda.Agenda.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_agenda.Agenda.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#todoist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Todoist
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_todoist" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_todoist
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_todoist.Todoist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Todoist
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Todoist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_todoist.Todoist.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_todoist.Todoist.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        Webshot
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_webshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_webshot
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_webshot.Webshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        Webshot
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Webshot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_webshot.Webshot.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slideshow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Slideshow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_slideshow" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_slideshow
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_slideshow.Slideshow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Slideshow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Slideshow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_slideshow.Slideshow.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_slideshow.Slideshow.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        Server Module
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_server" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_server
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_server.Inkyserver" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inkyserver
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inkyserver">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_server.Inkyserver.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_server.Inkyserver.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xkcd" class="md-nav__link">
    <span class="md-ellipsis">
      
        XKCD
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_xkcd" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_xkcd
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_xkcd.Xkcd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Xkcd
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Xkcd">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_xkcd.Xkcd.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jokes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Jokes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_jokes" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_jokes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_jokes.Jokes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Jokes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Jokes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_jokes.Jokes.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_jokes.Jokes.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tindie" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tindie
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_tindie" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_tindie
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_tindie.Tindie" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tindie
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tindie">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_tindie.Tindie.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_tindie.Tindie.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#text-file-renderer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Text File Renderer
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_textfile_to_display" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_textfile_to_display
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_textfile_to_display.TextToDisplay" class="md-nav__link">
    <span class="md-ellipsis">
      
        TextToDisplay
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TextToDisplay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_textfile_to_display.TextToDisplay.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_textfile_to_display.TextToDisplay.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#architecture-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        ðŸ§© Architecture Summary
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#built-in-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        ðŸ“¦ Built-in Modules
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ“¦ Built-in Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#module-index" class="md-nav__link">
    <span class="md-ellipsis">
      
        Module Index
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#module-reference-auto-generated" class="md-nav__link">
    <span class="md-ellipsis">
      
        ðŸ“š Module Reference (Auto-Generated)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ðŸ“š Module Reference (Auto-Generated)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#template-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        Template Module
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#calendar" class="md-nav__link">
    <span class="md-ellipsis">
      
        Calendar
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_calendar" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_calendar
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_calendar.Calendar" class="md-nav__link">
    <span class="md-ellipsis">
      
        Calendar
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Calendar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_calendar.Calendar.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_calendar.Calendar.flatten" class="md-nav__link">
    <span class="md-ellipsis">
      
        flatten
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_calendar.Calendar.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weather" class="md-nav__link">
    <span class="md-ellipsis">
      
        Weather
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_weather" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_weather
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_weather.Weather" class="md-nav__link">
    <span class="md-ellipsis">
      
        Weather
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Weather">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_weather.Weather.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_weather.Weather.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#feeds" class="md-nav__link">
    <span class="md-ellipsis">
      
        Feeds
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_feeds" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_feeds
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_feeds.Feeds" class="md-nav__link">
    <span class="md-ellipsis">
      
        Feeds
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Feeds">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_feeds.Feeds.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_feeds.Feeds.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stocks
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_stocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_stocks
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_stocks.Stocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stocks
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Stocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_stocks.Stocks.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#image-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        Image Module
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_image
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_image.Inkyimage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inkyimage
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inkyimage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_image.Inkyimage.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_image.Inkyimage.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#agenda" class="md-nav__link">
    <span class="md-ellipsis">
      
        Agenda
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_agenda" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_agenda
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_agenda.Agenda" class="md-nav__link">
    <span class="md-ellipsis">
      
        Agenda
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Agenda">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_agenda.Agenda.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_agenda.Agenda.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#todoist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Todoist
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_todoist" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_todoist
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_todoist.Todoist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Todoist
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Todoist">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_todoist.Todoist.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_todoist.Todoist.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        Webshot
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_webshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_webshot
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_webshot.Webshot" class="md-nav__link">
    <span class="md-ellipsis">
      
        Webshot
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Webshot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_webshot.Webshot.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slideshow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Slideshow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_slideshow" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_slideshow
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_slideshow.Slideshow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Slideshow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Slideshow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_slideshow.Slideshow.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_slideshow.Slideshow.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server-module" class="md-nav__link">
    <span class="md-ellipsis">
      
        Server Module
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_server" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_server
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_server.Inkyserver" class="md-nav__link">
    <span class="md-ellipsis">
      
        Inkyserver
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inkyserver">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_server.Inkyserver.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_server.Inkyserver.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xkcd" class="md-nav__link">
    <span class="md-ellipsis">
      
        XKCD
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_xkcd" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_xkcd
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_xkcd.Xkcd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Xkcd
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Xkcd">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_xkcd.Xkcd.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jokes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Jokes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_jokes" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_jokes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_jokes.Jokes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Jokes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Jokes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_jokes.Jokes.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_jokes.Jokes.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tindie" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tindie
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_tindie" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_tindie
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_tindie.Tindie" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tindie
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tindie">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_tindie.Tindie.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_tindie.Tindie.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#text-file-renderer" class="md-nav__link">
    <span class="md-ellipsis">
      
        Text File Renderer
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_textfile_to_display" class="md-nav__link">
    <span class="md-ellipsis">
      
        inkycal_textfile_to_display
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_textfile_to_display.TextToDisplay" class="md-nav__link">
    <span class="md-ellipsis">
      
        TextToDisplay
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TextToDisplay">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_textfile_to_display.TextToDisplay.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inkycal.modules.inkycal_textfile_to_display.TextToDisplay.generate_image" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_image
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="inkycal-api-reference">ðŸ“˜ Inkycal API Reference<a class="headerlink" href="#inkycal-api-reference" title="Permanent link">&para;</a></h1>
<p>Welcome to the full <strong>API reference</strong> for Inkycal.</p>
<p>This page contains:</p>
<ul>
<li>A complete list of all available modules  </li>
<li>API documentation for the Canvas and Display classes  </li>
<li>Utilities included in <code>inkycal.utils</code>  </li>
<li>Auto-generated API docs (if mkdocstrings is enabled)</li>
</ul>
<hr />
<h2 id="architecture-summary">ðŸ§© Architecture Summary<a class="headerlink" href="#architecture-summary" title="Permanent link">&para;</a></h2>
<p>Inkycal is composed of:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Location</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Modules</strong></td>
<td><code>inkycal/modules/</code></td>
<td>Pluggable units (Calendar, Weather, Stocks, etc.)</td>
</tr>
<tr>
<td><strong>Display Interface</strong></td>
<td><code>inkycal/display/</code></td>
<td>Hardware drivers for supported ePaper displays</td>
</tr>
<tr>
<td><strong>Canvas Engine</strong></td>
<td><code>inkycal/utils/canvas.py</code></td>
<td>Text / icon / drawing engine used by all modules</td>
</tr>
<tr>
<td><strong>Utilities</strong></td>
<td><code>inkycal/utils/</code></td>
<td>Helpers (timezone, borders, networking, line charts)</td>
</tr>
</tbody>
</table>
<p>Most modules extend:</p>
<div class="codehilite"><pre><span></span><code>inkycal.modules.template.InkycalModule
</code></pre></div>

<hr />
<h2 id="built-in-modules">ðŸ“¦ Built-in Modules<a class="headerlink" href="#built-in-modules" title="Permanent link">&para;</a></h2>
<p>Inkycal ships with the following modules, available via the Web-UI and automatically registered via:</p>
<div class="codehilite"><pre><span></span><code>inkycal.modules.__init__.py
</code></pre></div>

<h3 id="module-index">Module Index<a class="headerlink" href="#module-index" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Class</th>
<th>Import Path</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Agenda</strong></td>
<td><code>Agenda</code></td>
<td><code>inkycal.modules.inkycal_agenda.Agenda</code></td>
</tr>
<tr>
<td><strong>Calendar</strong></td>
<td><code>Calendar</code></td>
<td><code>inkycal.modules.inkycal_calendar.Calendar</code></td>
</tr>
<tr>
<td><strong>Feeds</strong></td>
<td><code>Feeds</code></td>
<td><code>inkycal.modules.inkycal_feeds.Feeds</code></td>
</tr>
<tr>
<td><strong>Image</strong></td>
<td><code>Inkyimage</code></td>
<td><code>inkycal.modules.inky_image.Inkyimage</code></td>
</tr>
<tr>
<td><strong>Jokes</strong></td>
<td><code>Jokes</code></td>
<td><code>inkycal.modules.inkycal_jokes.Jokes</code></td>
</tr>
<tr>
<td><strong>Server Status</strong></td>
<td><code>Inkyserver</code></td>
<td><code>inkycal.modules.inkycal_server.Inkyserver</code></td>
</tr>
<tr>
<td><strong>Slideshow</strong></td>
<td><code>Slideshow</code></td>
<td><code>inkycal.modules.inkycal_slideshow.Slideshow</code></td>
</tr>
<tr>
<td><strong>Stocks</strong></td>
<td><code>Stocks</code></td>
<td><code>inkycal.modules.inkycal_stocks.Stocks</code></td>
</tr>
<tr>
<td><strong>Text File Renderer</strong></td>
<td><code>TextToDisplay</code></td>
<td><code>inkycal.modules.inkycal_textfile_to_display.TextToDisplay</code></td>
</tr>
<tr>
<td><strong>Tindie Stats</strong></td>
<td><code>Tindie</code></td>
<td><code>inkycal.modules.inkycal_tindie.Tindie</code></td>
</tr>
<tr>
<td><strong>Todoist</strong></td>
<td><code>Todoist</code></td>
<td><code>inkycal.modules.inkycal_todoist.Todoist</code></td>
</tr>
<tr>
<td><strong>Weather</strong></td>
<td><code>Weather</code></td>
<td><code>inkycal.modules.inkycal_weather.Weather</code></td>
</tr>
<tr>
<td><strong>Webshot</strong></td>
<td><code>Webshot</code></td>
<td><code>inkycal.modules.inkycal_webshot.Webshot</code></td>
</tr>
<tr>
<td><strong>XKCD</strong></td>
<td><code>Xkcd</code></td>
<td><code>inkycal.modules.inkycal_xkcd.Xkcd</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="module-reference-auto-generated">ðŸ“š Module Reference (Auto-Generated)<a class="headerlink" href="#module-reference-auto-generated" title="Permanent link">&para;</a></h2>
<h3 id="template-module">Template Module<a class="headerlink" href="#template-module" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><code>::: inkycal.modules.template
</code></pre></div>

<h3 id="calendar">Calendar<a class="headerlink" href="#calendar" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.modules.inkycal_calendar"></a>
    <div class="doc doc-contents first">

        <p>Inkycal Calendar Module
Copyright by aceinnolab</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.modules.inkycal_calendar.Calendar" class="doc doc-heading">
            <code>Calendar</code>


<a href="#inkycal.modules.inkycal_calendar.Calendar" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="inkycal.modules.template.InkycalModule">InkycalModule</span></code></p>



        <p>Calendar class
Create monthly calendar and show events from given iCalendars</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/modules/inkycal_calendar.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Calendar</span><span class="p">(</span><span class="n">InkycalModule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calendar class</span>
<span class="sd">    Create monthly calendar and show events from given iCalendars</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Calendar - Show monthly calendar with events from iCalendars&quot;</span>

    <span class="n">optional</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;week_starts_on&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;When does your week start? (default=Monday)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Monday&quot;</span><span class="p">,</span> <span class="s2">&quot;Sunday&quot;</span><span class="p">],</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;Monday&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;show_events&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Show parsed events? (default = True)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;ical_urls&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;iCalendar URL/s, separate multiple ones with a comma&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;ical_files&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;iCalendar filepaths, separated with a comma&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;date_format&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Use an arrow-supported token for custom date formatting &quot;</span>
                     <span class="o">+</span> <span class="s2">&quot;see https://arrow.readthedocs.io/en/stable/#supported-tokens, e.g. D MMM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;D MMM&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;time_format&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Use an arrow-supported token for custom time formatting &quot;</span>
                     <span class="o">+</span> <span class="s2">&quot;see https://arrow.readthedocs.io/en/stable/#supported-tokens, e.g. HH:mm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;HH:mm&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_calendar module&quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ical</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">month_events</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upcoming_events</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_days_with_events</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># optional parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">week_start</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;week_starts_on&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_events</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;show_events&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_format</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;date_format&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_format</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;time_format&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">]</span>

        <span class="c1"># additional configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="n">get_system_tz</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_font</span> <span class="o">=</span> <span class="n">FONTS</span><span class="o">.</span><span class="n">noto_sans_semicondensed</span>

        <span class="c1"># give an OK message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">flatten</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Flatten the values.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">values</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

        <span class="c1"># Define new image size with respect to padding</span>
        <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
        <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
        <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
        <span class="n">events_height</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="c1"># Allocate space for month-names, weekdays etc.</span>
        <span class="n">month_name_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">*</span> <span class="mf">0.10</span><span class="p">)</span> <span class="c1"># 10% of the available height</span>
        <span class="n">weekdays_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">)</span> <span class="c1"># slightly more height for some padding</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;month_name_height: </span><span class="si">{</span><span class="n">month_name_height</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;weekdays_height: </span><span class="si">{</span><span class="n">weekdays_height</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_events</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Allocating space for events&quot;</span><span class="p">)</span>
            <span class="n">calendar_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)</span>
            <span class="n">events_height</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">im_height</span> <span class="o">-</span> <span class="n">month_name_height</span> <span class="o">-</span> <span class="n">weekdays_height</span> <span class="o">-</span> <span class="n">calendar_height</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;calendar-section size: </span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">calendar_height</span><span class="si">}</span><span class="s1"> px&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;events-section size: </span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">events_height</span><span class="si">}</span><span class="s1"> px&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Not allocating space for events&quot;</span><span class="p">)</span>
            <span class="n">calendar_height</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">-</span> <span class="n">month_name_height</span> <span class="o">-</span> <span class="n">weekdays_height</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;calendar-section size: </span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">calendar_height</span><span class="si">}</span><span class="s1"> px&#39;</span><span class="p">)</span>

        <span class="c1"># Create a 7x6 grid and calculate icon sizes</span>
        <span class="n">calendar_rows</span><span class="p">,</span> <span class="n">calendar_cols</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span>
        <span class="n">icon_width</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">//</span> <span class="n">calendar_cols</span>
        <span class="n">icon_height</span> <span class="o">=</span> <span class="n">calendar_height</span> <span class="o">//</span> <span class="n">calendar_rows</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;icon_size: </span><span class="si">{</span><span class="n">icon_width</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">icon_height</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate spacings for calendar area</span>
        <span class="n">x_spacing_calendar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_width</span> <span class="o">%</span> <span class="n">calendar_cols</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">y_spacing_calendar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">calendar_rows</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x_spacing_calendar: </span><span class="si">{</span><span class="n">x_spacing_calendar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y_spacing_calendar :</span><span class="si">{</span><span class="n">y_spacing_calendar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate positions for days of month</span>
        <span class="n">grid_start_y</span> <span class="o">=</span> <span class="n">month_name_height</span> <span class="o">+</span> <span class="n">weekdays_height</span> <span class="o">+</span> <span class="n">y_spacing_calendar</span>
        <span class="n">grid_start_x</span> <span class="o">=</span> <span class="n">x_spacing_calendar</span>

        <span class="n">grid_coordinates</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">grid_start_x</span> <span class="o">+</span> <span class="n">icon_width</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">grid_start_y</span> <span class="o">+</span> <span class="n">icon_height</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">calendar_rows</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">calendar_cols</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">weekday_pos</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">grid_start_x</span> <span class="o">+</span> <span class="n">icon_width</span> <span class="o">*</span> <span class="n">_</span><span class="p">,</span> <span class="n">month_name_height</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">calendar_cols</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">now</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>

        <span class="c1"># Set week-start of calendar to specified week-start</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">week_start</span> <span class="o">==</span> <span class="s2">&quot;Monday&quot;</span><span class="p">:</span>
            <span class="n">cal</span><span class="o">.</span><span class="n">setfirstweekday</span><span class="p">(</span><span class="n">cal</span><span class="o">.</span><span class="n">MONDAY</span><span class="p">)</span>
            <span class="n">week_start</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=-</span><span class="n">now</span><span class="o">.</span><span class="n">weekday</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cal</span><span class="o">.</span><span class="n">setfirstweekday</span><span class="p">(</span><span class="n">cal</span><span class="o">.</span><span class="n">SUNDAY</span><span class="p">)</span>
            <span class="n">week_start</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=-</span><span class="n">now</span><span class="o">.</span><span class="n">isoweekday</span><span class="p">())</span>

        <span class="c1"># Write the name of current month</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">month_name_height</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;MMMM&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)),</span>
            <span class="n">autofit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Set up week-names in local language and add to main section</span>
        <span class="n">weekday_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">week_start</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=+</span><span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ddd&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;weekday names: </span><span class="si">{</span><span class="n">weekday_names</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">weekday</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">weekday_pos</span><span class="p">):</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="n">weekday</span><span class="p">,</span>
                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">icon_width</span><span class="p">,</span> <span class="n">weekdays_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">weekday_names</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                <span class="n">autofit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">fill_height</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Create a calendar template and flatten (remove nesting)</span>
        <span class="n">calendar_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">cal</span><span class="o">.</span><span class="n">monthcalendar</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">month</span><span class="p">))</span>
        <span class="c1"># logger.debug(f&quot; calendar_flat: {calendar_flat}&quot;)</span>

        <span class="c1"># Map days of month to co-ordinates of grid -&gt; 3: (row2_x,col3_y)</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">calendar_flat</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_coordinates</span><span class="p">[</span><span class="n">calendar_flat</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
        <span class="c1"># logger.debug(f&quot;grid:{grid}&quot;)</span>

        <span class="c1"># remove zeros from calendar since they are not required</span>
        <span class="n">calendar_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">calendar_flat</span> <span class="k">if</span> <span class="n">num</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>

        <span class="c1"># ensure all numbers have the same size</span>
        <span class="n">fontsize_numbers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">icon_width</span><span class="p">,</span> <span class="n">icon_height</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">fontsize_numbers</span><span class="p">)</span>
        <span class="c1"># Add the numbers on the correct positions</span>
        <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">calendar_flat</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">number</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">day</span><span class="p">):</span>
                <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">xy</span><span class="o">=</span><span class="n">grid</span><span class="p">[</span><span class="n">number</span><span class="p">],</span>
                    <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">icon_width</span><span class="p">,</span> <span class="n">icon_height</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="c1"># special handling of current day</span>
        <span class="n">day_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>

        <span class="c1"># Icon canvas</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">icon_width</span><span class="p">,</span> <span class="n">icon_height</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>

        <span class="c1"># --- Larger circle (properly centered) ---</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="n">icon_width</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">cy</span> <span class="o">=</span> <span class="n">icon_height</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">radius</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">icon_width</span> <span class="o">*</span> <span class="mf">0.40</span><span class="p">)</span>

        <span class="n">draw</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span>
            <span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cx</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">radius</span><span class="p">),</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;black&quot;</span>
        <span class="p">)</span>

        <span class="c1"># --- Load number font ---</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_font</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">fontsize_numbers</span><span class="p">)</span>

        <span class="c1"># --- Perfect vertical + horizontal centering using anchor=&quot;mm&quot; ---</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">),</span>
            <span class="n">day_str</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;mm&quot;</span>  <span class="c1"># â† the magic incantation</span>
        <span class="p">)</span>

        <span class="c1"># --- Paste onto main canvas ---</span>
        <span class="n">cell_x</span><span class="p">,</span> <span class="n">cell_y</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">day</span><span class="p">)]</span>

        <span class="c1"># center the icon inside its grid cell</span>
        <span class="n">paste_x</span> <span class="o">=</span> <span class="n">cell_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">icon_width</span> <span class="o">-</span> <span class="n">icon</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">paste_y</span> <span class="o">=</span> <span class="n">cell_y</span> <span class="o">+</span> <span class="p">(</span><span class="n">icon_height</span> <span class="o">-</span> <span class="n">icon</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="p">(</span><span class="n">paste_x</span><span class="p">,</span> <span class="n">paste_y</span><span class="p">),</span> <span class="n">icon</span><span class="p">)</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="p">(</span><span class="n">paste_x</span><span class="p">,</span> <span class="n">paste_y</span><span class="p">),</span> <span class="n">icon</span><span class="p">)</span>




        <span class="c1"># If events should be loaded and shown...</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_events</span><span class="p">:</span>

            <span class="c1"># If this month requires 5 instead of 6 rows, increase event section height</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cal</span><span class="o">.</span><span class="n">monthcalendar</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">month</span><span class="p">))</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">events_height</span> <span class="o">+=</span> <span class="n">icon_height</span>

            <span class="c1"># If this month requires 4 instead of 6 rows, increase event section height</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cal</span><span class="o">.</span><span class="n">monthcalendar</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">month</span><span class="p">))</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">events_height</span> <span class="o">+=</span> <span class="n">icon_height</span> <span class="o">*</span> <span class="mi">2</span>

            <span class="c1"># import the ical-parser</span>
            <span class="c1"># pylint: disable=import-outside-toplevel</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">inkycal.utils.ical_parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">iCalendar</span>

            <span class="c1"># find out how many lines can fit at max in the event section</span>
            <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>
            <span class="n">max_event_lines</span> <span class="o">=</span> <span class="n">events_height</span> <span class="o">//</span> <span class="p">(</span><span class="n">line_height</span> <span class="o">+</span> <span class="n">line_spacing</span><span class="p">)</span>

            <span class="c1"># generate list of coordinates for each line</span>
            <span class="n">events_offset</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">-</span> <span class="n">events_height</span>
            <span class="n">event_lines</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">events_offset</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">events_height</span> <span class="o">/</span> <span class="n">max_event_lines</span> <span class="o">*</span> <span class="n">_</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_event_lines</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="c1"># logger.debug(f&quot;event_lines {event_lines}&quot;)</span>

            <span class="c1"># timeline for filtering events within this month</span>
            <span class="n">month_start</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">))</span>
            <span class="n">month_end</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">))</span>

            <span class="c1"># fetch events from given iCalendars</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ical</span> <span class="o">=</span> <span class="n">iCalendar</span><span class="p">()</span>
            <span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ical</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">load_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span><span class="p">)</span>

            <span class="c1"># Filter events for full month (even past ones) for drawing event icons</span>
            <span class="n">month_events</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_events</span><span class="p">(</span><span class="n">month_start</span><span class="p">,</span> <span class="n">month_end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">month_events</span> <span class="o">=</span> <span class="n">month_events</span>

            <span class="c1"># Initialize days_with_events as an empty list</span>
            <span class="n">days_with_events</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="c1"># Handle multi-day events by adding all days between start and end</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">month_events</span><span class="p">:</span>

                <span class="c1"># Convert start and end dates to arrow objects with timezone</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>

                <span class="c1"># Use arrow&#39;s range function for generating dates</span>
                <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">arrow</span><span class="o">.</span><span class="n">Arrow</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
                    <span class="n">day_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">day</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">))</span>  <span class="c1"># get day number using arrow&#39;s format method</span>
                    <span class="k">if</span> <span class="n">day_num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">days_with_events</span><span class="p">:</span>
                        <span class="n">days_with_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">day_num</span><span class="p">)</span>

            <span class="c1"># remove duplicates (more than one event in a single day)</span>
            <span class="n">days_with_events</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">days_with_events</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_days_with_events</span> <span class="o">=</span> <span class="n">days_with_events</span>

            <span class="c1"># Draw a border with specified parameters around days with events</span>
            <span class="k">for</span> <span class="n">days</span> <span class="ow">in</span> <span class="n">days_with_events</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">days</span> <span class="ow">in</span> <span class="n">grid</span><span class="p">:</span>
                    <span class="n">draw_border</span><span class="p">(</span>
                        <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span><span class="p">,</span>
                        <span class="n">grid</span><span class="p">[</span><span class="n">days</span><span class="p">],</span>
                        <span class="p">(</span><span class="n">icon_width</span><span class="p">,</span> <span class="n">icon_height</span><span class="p">),</span>
                        <span class="n">radius</span><span class="o">=</span><span class="mi">6</span>
                    <span class="p">)</span>

            <span class="c1"># Filter upcoming events until 4 weeks in the future</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">clear_events</span><span class="p">()</span>
            <span class="n">upcoming_events</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_events</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_upcoming_events</span> <span class="o">=</span> <span class="n">upcoming_events</span>

            <span class="c1"># delete events which won&#39;t be able to fit (more events than lines)</span>
            <span class="n">upcoming_events</span> <span class="o">=</span> <span class="n">upcoming_events</span><span class="p">[:</span><span class="n">max_event_lines</span><span class="p">]</span>

            <span class="c1"># Check if any events were found in the given timerange</span>
            <span class="k">if</span> <span class="n">upcoming_events</span><span class="p">:</span>

                <span class="c1"># Find out how much space (width) the date format requires</span>
                <span class="n">lang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span>

                <span class="n">date_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">((</span>
                    <span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">lang</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">events</span> <span class="ow">in</span> <span class="n">upcoming_events</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1.1</span>
                                 <span class="p">)</span>

                <span class="n">time_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">((</span>
                    <span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">lang</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">events</span> <span class="ow">in</span> <span class="n">upcoming_events</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1.1</span>
                                 <span class="p">)</span>

                <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>

                <span class="n">event_width_s</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">-</span> <span class="n">date_width</span> <span class="o">-</span> <span class="n">time_width</span>
                <span class="n">event_width_l</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">-</span> <span class="n">date_width</span>

                <span class="c1"># Display upcoming events below calendar TODO: not used?</span>
                <span class="c1"># tomorrow = now.shift(days=1).floor(&#39;day&#39;)</span>
                <span class="c1"># in_two_days = now.shift(days=2).floor(&#39;day&#39;)</span>

                <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">upcoming_events</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cursor</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">event_lines</span><span class="p">):</span>
                        <span class="n">event_duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">days</span>
                        <span class="k">if</span> <span class="n">event_duration</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="c1"># Format the duration using Arrow&#39;s localization</span>
                            <span class="n">days_translation</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">event_duration</span><span class="p">)</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="n">only_distance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                               <span class="n">locale</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>
                            <span class="n">the_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">days_translation</span><span class="si">}</span><span class="s2">)&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">the_name</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
                        <span class="n">the_date</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>
                        <span class="n">the_time</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>
                        <span class="c1"># logger.debug(f&quot;name:{the_name}   date:{the_date} time:{the_time}&quot;)</span>

                        <span class="k">if</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]:</span>
                            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                <span class="n">xy</span><span class="o">=</span><span class="n">event_lines</span><span class="p">[</span><span class="n">cursor</span><span class="p">],</span>
                                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">date_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                                <span class="n">text</span><span class="o">=</span><span class="n">the_date</span><span class="p">,</span>
                                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                            <span class="p">)</span>

                            <span class="c1"># Check if event is all day</span>
                            <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">all_day</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                                <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">date_width</span><span class="p">,</span> <span class="n">event_lines</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                                    <span class="n">box_size</span><span class="o">=</span> <span class="p">(</span><span class="n">event_width_l</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                                    <span class="n">text</span><span class="o">=</span><span class="n">the_name</span><span class="p">,</span>
                                    <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">date_width</span><span class="p">,</span> <span class="n">event_lines</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                                    <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">time_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                                    <span class="n">text</span><span class="o">=</span><span class="n">the_time</span><span class="p">,</span>
                                    <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                <span class="p">)</span>

                                <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">date_width</span> <span class="o">+</span> <span class="n">time_width</span><span class="p">,</span> <span class="n">event_lines</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                                    <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">event_width_s</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                                    <span class="n">text</span><span class="o">=</span><span class="n">the_name</span><span class="p">,</span>
                                    <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                <span class="p">)</span>
                            <span class="n">cursor</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">symbol</span> <span class="o">=</span> <span class="s1">&#39;- &#39;</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
                <span class="n">multiplier</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_width</span> <span class="o">//</span> <span class="n">length</span><span class="p">)</span>
                <span class="n">symbol</span> <span class="o">=</span> <span class="n">symbol</span> <span class="o">*</span> <span class="n">multiplier</span>

                <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">xy</span><span class="o">=</span><span class="n">event_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
                    <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="c1"># return the images ready for the display</span>
        <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_calendar.Calendar.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#inkycal.modules.inkycal_calendar.Calendar.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize inkycal_calendar module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_calendar.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_calendar module&quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">ical</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">month_events</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_upcoming_events</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_days_with_events</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># optional parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">week_start</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;week_starts_on&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">show_events</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;show_events&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">date_format</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;date_format&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_format</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;time_format&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">]</span>

    <span class="c1"># additional configuration</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="n">get_system_tz</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">num_font</span> <span class="o">=</span> <span class="n">FONTS</span><span class="o">.</span><span class="n">noto_sans_semicondensed</span>

    <span class="c1"># give an OK message</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_calendar.Calendar.flatten" class="doc doc-heading">
            <code class=" language-python"><span class="n">flatten</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#inkycal.modules.inkycal_calendar.Calendar.flatten" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Flatten the values.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_calendar.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">flatten</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Flatten the values.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">values</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_calendar.Calendar.generate_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate_image</span><span class="p">()</span></code>

<a href="#inkycal.modules.inkycal_calendar.Calendar.generate_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate image for this module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_calendar.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

    <span class="c1"># Define new image size with respect to padding</span>
    <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
    <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
    <span class="n">events_height</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Allocate space for month-names, weekdays etc.</span>
    <span class="n">month_name_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">*</span> <span class="mf">0.10</span><span class="p">)</span> <span class="c1"># 10% of the available height</span>
    <span class="n">weekdays_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.25</span><span class="p">)</span> <span class="c1"># slightly more height for some padding</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;month_name_height: </span><span class="si">{</span><span class="n">month_name_height</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;weekdays_height: </span><span class="si">{</span><span class="n">weekdays_height</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_events</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Allocating space for events&quot;</span><span class="p">)</span>
        <span class="n">calendar_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">*</span> <span class="mf">0.6</span><span class="p">)</span>
        <span class="n">events_height</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">im_height</span> <span class="o">-</span> <span class="n">month_name_height</span> <span class="o">-</span> <span class="n">weekdays_height</span> <span class="o">-</span> <span class="n">calendar_height</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;calendar-section size: </span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">calendar_height</span><span class="si">}</span><span class="s1"> px&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;events-section size: </span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">events_height</span><span class="si">}</span><span class="s1"> px&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Not allocating space for events&quot;</span><span class="p">)</span>
        <span class="n">calendar_height</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">-</span> <span class="n">month_name_height</span> <span class="o">-</span> <span class="n">weekdays_height</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;calendar-section size: </span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">calendar_height</span><span class="si">}</span><span class="s1"> px&#39;</span><span class="p">)</span>

    <span class="c1"># Create a 7x6 grid and calculate icon sizes</span>
    <span class="n">calendar_rows</span><span class="p">,</span> <span class="n">calendar_cols</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span>
    <span class="n">icon_width</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">//</span> <span class="n">calendar_cols</span>
    <span class="n">icon_height</span> <span class="o">=</span> <span class="n">calendar_height</span> <span class="o">//</span> <span class="n">calendar_rows</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;icon_size: </span><span class="si">{</span><span class="n">icon_width</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">icon_height</span><span class="si">}</span><span class="s2">px&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate spacings for calendar area</span>
    <span class="n">x_spacing_calendar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_width</span> <span class="o">%</span> <span class="n">calendar_cols</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">y_spacing_calendar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">calendar_rows</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;x_spacing_calendar: </span><span class="si">{</span><span class="n">x_spacing_calendar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;y_spacing_calendar :</span><span class="si">{</span><span class="n">y_spacing_calendar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate positions for days of month</span>
    <span class="n">grid_start_y</span> <span class="o">=</span> <span class="n">month_name_height</span> <span class="o">+</span> <span class="n">weekdays_height</span> <span class="o">+</span> <span class="n">y_spacing_calendar</span>
    <span class="n">grid_start_x</span> <span class="o">=</span> <span class="n">x_spacing_calendar</span>

    <span class="n">grid_coordinates</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">grid_start_x</span> <span class="o">+</span> <span class="n">icon_width</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">grid_start_y</span> <span class="o">+</span> <span class="n">icon_height</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">calendar_rows</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">calendar_cols</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">weekday_pos</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">grid_start_x</span> <span class="o">+</span> <span class="n">icon_width</span> <span class="o">*</span> <span class="n">_</span><span class="p">,</span> <span class="n">month_name_height</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">calendar_cols</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="n">now</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>

    <span class="c1"># Set week-start of calendar to specified week-start</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">week_start</span> <span class="o">==</span> <span class="s2">&quot;Monday&quot;</span><span class="p">:</span>
        <span class="n">cal</span><span class="o">.</span><span class="n">setfirstweekday</span><span class="p">(</span><span class="n">cal</span><span class="o">.</span><span class="n">MONDAY</span><span class="p">)</span>
        <span class="n">week_start</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=-</span><span class="n">now</span><span class="o">.</span><span class="n">weekday</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cal</span><span class="o">.</span><span class="n">setfirstweekday</span><span class="p">(</span><span class="n">cal</span><span class="o">.</span><span class="n">SUNDAY</span><span class="p">)</span>
        <span class="n">week_start</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=-</span><span class="n">now</span><span class="o">.</span><span class="n">isoweekday</span><span class="p">())</span>

    <span class="c1"># Write the name of current month</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">month_name_height</span><span class="p">),</span>
        <span class="n">text</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;MMMM&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)),</span>
        <span class="n">autofit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Set up week-names in local language and add to main section</span>
    <span class="n">weekday_names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">week_start</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=+</span><span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ddd&#39;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;weekday names: </span><span class="si">{</span><span class="n">weekday_names</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">weekday</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">weekday_pos</span><span class="p">):</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">weekday</span><span class="p">,</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">icon_width</span><span class="p">,</span> <span class="n">weekdays_height</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="n">weekday_names</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
            <span class="n">autofit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">fill_height</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Create a calendar template and flatten (remove nesting)</span>
    <span class="n">calendar_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">cal</span><span class="o">.</span><span class="n">monthcalendar</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">month</span><span class="p">))</span>
    <span class="c1"># logger.debug(f&quot; calendar_flat: {calendar_flat}&quot;)</span>

    <span class="c1"># Map days of month to co-ordinates of grid -&gt; 3: (row2_x,col3_y)</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">calendar_flat</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_coordinates</span><span class="p">[</span><span class="n">calendar_flat</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
    <span class="c1"># logger.debug(f&quot;grid:{grid}&quot;)</span>

    <span class="c1"># remove zeros from calendar since they are not required</span>
    <span class="n">calendar_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">calendar_flat</span> <span class="k">if</span> <span class="n">num</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>

    <span class="c1"># ensure all numbers have the same size</span>
    <span class="n">fontsize_numbers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">icon_width</span><span class="p">,</span> <span class="n">icon_height</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>

    <span class="n">canvas</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">fontsize_numbers</span><span class="p">)</span>
    <span class="c1"># Add the numbers on the correct positions</span>
    <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">calendar_flat</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">day</span><span class="p">):</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="n">grid</span><span class="p">[</span><span class="n">number</span><span class="p">],</span>
                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">icon_width</span><span class="p">,</span> <span class="n">icon_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="n">canvas</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># special handling of current day</span>
    <span class="n">day_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>

    <span class="c1"># Icon canvas</span>
    <span class="n">icon</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">icon_width</span><span class="p">,</span> <span class="n">icon_height</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>

    <span class="c1"># --- Larger circle (properly centered) ---</span>
    <span class="n">cx</span> <span class="o">=</span> <span class="n">icon_width</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">cy</span> <span class="o">=</span> <span class="n">icon_height</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">icon_width</span> <span class="o">*</span> <span class="mf">0.40</span><span class="p">)</span>

    <span class="n">draw</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span>
        <span class="p">(</span><span class="n">cx</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cx</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">radius</span><span class="p">),</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;black&quot;</span>
    <span class="p">)</span>

    <span class="c1"># --- Load number font ---</span>
    <span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_font</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">fontsize_numbers</span><span class="p">)</span>

    <span class="c1"># --- Perfect vertical + horizontal centering using anchor=&quot;mm&quot; ---</span>
    <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">),</span>
        <span class="n">day_str</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span>
        <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;mm&quot;</span>  <span class="c1"># â† the magic incantation</span>
    <span class="p">)</span>

    <span class="c1"># --- Paste onto main canvas ---</span>
    <span class="n">cell_x</span><span class="p">,</span> <span class="n">cell_y</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">day</span><span class="p">)]</span>

    <span class="c1"># center the icon inside its grid cell</span>
    <span class="n">paste_x</span> <span class="o">=</span> <span class="n">cell_x</span> <span class="o">+</span> <span class="p">(</span><span class="n">icon_width</span> <span class="o">-</span> <span class="n">icon</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">paste_y</span> <span class="o">=</span> <span class="n">cell_y</span> <span class="o">+</span> <span class="p">(</span><span class="n">icon_height</span> <span class="o">-</span> <span class="n">icon</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="p">(</span><span class="n">paste_x</span><span class="p">,</span> <span class="n">paste_y</span><span class="p">),</span> <span class="n">icon</span><span class="p">)</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="p">(</span><span class="n">paste_x</span><span class="p">,</span> <span class="n">paste_y</span><span class="p">),</span> <span class="n">icon</span><span class="p">)</span>




    <span class="c1"># If events should be loaded and shown...</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_events</span><span class="p">:</span>

        <span class="c1"># If this month requires 5 instead of 6 rows, increase event section height</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cal</span><span class="o">.</span><span class="n">monthcalendar</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">month</span><span class="p">))</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">events_height</span> <span class="o">+=</span> <span class="n">icon_height</span>

        <span class="c1"># If this month requires 4 instead of 6 rows, increase event section height</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">cal</span><span class="o">.</span><span class="n">monthcalendar</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">month</span><span class="p">))</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">events_height</span> <span class="o">+=</span> <span class="n">icon_height</span> <span class="o">*</span> <span class="mi">2</span>

        <span class="c1"># import the ical-parser</span>
        <span class="c1"># pylint: disable=import-outside-toplevel</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">inkycal.utils.ical_parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">iCalendar</span>

        <span class="c1"># find out how many lines can fit at max in the event section</span>
        <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>
        <span class="n">max_event_lines</span> <span class="o">=</span> <span class="n">events_height</span> <span class="o">//</span> <span class="p">(</span><span class="n">line_height</span> <span class="o">+</span> <span class="n">line_spacing</span><span class="p">)</span>

        <span class="c1"># generate list of coordinates for each line</span>
        <span class="n">events_offset</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">-</span> <span class="n">events_height</span>
        <span class="n">event_lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">events_offset</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">events_height</span> <span class="o">/</span> <span class="n">max_event_lines</span> <span class="o">*</span> <span class="n">_</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_event_lines</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># logger.debug(f&quot;event_lines {event_lines}&quot;)</span>

        <span class="c1"># timeline for filtering events within this month</span>
        <span class="n">month_start</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">))</span>
        <span class="n">month_end</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">))</span>

        <span class="c1"># fetch events from given iCalendars</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ical</span> <span class="o">=</span> <span class="n">iCalendar</span><span class="p">()</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ical</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">load_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span><span class="p">)</span>

        <span class="c1"># Filter events for full month (even past ones) for drawing event icons</span>
        <span class="n">month_events</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_events</span><span class="p">(</span><span class="n">month_start</span><span class="p">,</span> <span class="n">month_end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">month_events</span> <span class="o">=</span> <span class="n">month_events</span>

        <span class="c1"># Initialize days_with_events as an empty list</span>
        <span class="n">days_with_events</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Handle multi-day events by adding all days between start and end</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">month_events</span><span class="p">:</span>

            <span class="c1"># Convert start and end dates to arrow objects with timezone</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>

            <span class="c1"># Use arrow&#39;s range function for generating dates</span>
            <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">arrow</span><span class="o">.</span><span class="n">Arrow</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
                <span class="n">day_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">day</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">))</span>  <span class="c1"># get day number using arrow&#39;s format method</span>
                <span class="k">if</span> <span class="n">day_num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">days_with_events</span><span class="p">:</span>
                    <span class="n">days_with_events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">day_num</span><span class="p">)</span>

        <span class="c1"># remove duplicates (more than one event in a single day)</span>
        <span class="n">days_with_events</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">days_with_events</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_days_with_events</span> <span class="o">=</span> <span class="n">days_with_events</span>

        <span class="c1"># Draw a border with specified parameters around days with events</span>
        <span class="k">for</span> <span class="n">days</span> <span class="ow">in</span> <span class="n">days_with_events</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">days</span> <span class="ow">in</span> <span class="n">grid</span><span class="p">:</span>
                <span class="n">draw_border</span><span class="p">(</span>
                    <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span><span class="p">,</span>
                    <span class="n">grid</span><span class="p">[</span><span class="n">days</span><span class="p">],</span>
                    <span class="p">(</span><span class="n">icon_width</span><span class="p">,</span> <span class="n">icon_height</span><span class="p">),</span>
                    <span class="n">radius</span><span class="o">=</span><span class="mi">6</span>
                <span class="p">)</span>

        <span class="c1"># Filter upcoming events until 4 weeks in the future</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">clear_events</span><span class="p">()</span>
        <span class="n">upcoming_events</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_events</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="n">now</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_upcoming_events</span> <span class="o">=</span> <span class="n">upcoming_events</span>

        <span class="c1"># delete events which won&#39;t be able to fit (more events than lines)</span>
        <span class="n">upcoming_events</span> <span class="o">=</span> <span class="n">upcoming_events</span><span class="p">[:</span><span class="n">max_event_lines</span><span class="p">]</span>

        <span class="c1"># Check if any events were found in the given timerange</span>
        <span class="k">if</span> <span class="n">upcoming_events</span><span class="p">:</span>

            <span class="c1"># Find out how much space (width) the date format requires</span>
            <span class="n">lang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span>

            <span class="n">date_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">((</span>
                <span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">lang</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">events</span> <span class="ow">in</span> <span class="n">upcoming_events</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1.1</span>
                             <span class="p">)</span>

            <span class="n">time_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">((</span>
                <span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">lang</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">events</span> <span class="ow">in</span> <span class="n">upcoming_events</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1.1</span>
                             <span class="p">)</span>

            <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>

            <span class="n">event_width_s</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">-</span> <span class="n">date_width</span> <span class="o">-</span> <span class="n">time_width</span>
            <span class="n">event_width_l</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">-</span> <span class="n">date_width</span>

            <span class="c1"># Display upcoming events below calendar TODO: not used?</span>
            <span class="c1"># tomorrow = now.shift(days=1).floor(&#39;day&#39;)</span>
            <span class="c1"># in_two_days = now.shift(days=2).floor(&#39;day&#39;)</span>

            <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">upcoming_events</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cursor</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">event_lines</span><span class="p">):</span>
                    <span class="n">event_duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">days</span>
                    <span class="k">if</span> <span class="n">event_duration</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="c1"># Format the duration using Arrow&#39;s localization</span>
                        <span class="n">days_translation</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">event_duration</span><span class="p">)</span><span class="o">.</span><span class="n">humanize</span><span class="p">(</span><span class="n">only_distance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                                                           <span class="n">locale</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>
                        <span class="n">the_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">days_translation</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">the_name</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
                    <span class="n">the_date</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>
                    <span class="n">the_time</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>
                    <span class="c1"># logger.debug(f&quot;name:{the_name}   date:{the_date} time:{the_time}&quot;)</span>

                    <span class="k">if</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;end&#39;</span><span class="p">]:</span>
                        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="n">xy</span><span class="o">=</span><span class="n">event_lines</span><span class="p">[</span><span class="n">cursor</span><span class="p">],</span>
                            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">date_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                            <span class="n">text</span><span class="o">=</span><span class="n">the_date</span><span class="p">,</span>
                            <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                        <span class="p">)</span>

                        <span class="c1"># Check if event is all day</span>
                        <span class="k">if</span> <span class="n">parser</span><span class="o">.</span><span class="n">all_day</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">date_width</span><span class="p">,</span> <span class="n">event_lines</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                                <span class="n">box_size</span><span class="o">=</span> <span class="p">(</span><span class="n">event_width_l</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                                <span class="n">text</span><span class="o">=</span><span class="n">the_name</span><span class="p">,</span>
                                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">date_width</span><span class="p">,</span> <span class="n">event_lines</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">time_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                                <span class="n">text</span><span class="o">=</span><span class="n">the_time</span><span class="p">,</span>
                                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                            <span class="p">)</span>

                            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">date_width</span> <span class="o">+</span> <span class="n">time_width</span><span class="p">,</span> <span class="n">event_lines</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">event_width_s</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                                <span class="n">text</span><span class="o">=</span><span class="n">the_name</span><span class="p">,</span>
                                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                            <span class="p">)</span>
                        <span class="n">cursor</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="s1">&#39;- &#39;</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
            <span class="n">multiplier</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_width</span> <span class="o">//</span> <span class="n">length</span><span class="p">)</span>
            <span class="n">symbol</span> <span class="o">=</span> <span class="n">symbol</span> <span class="o">*</span> <span class="n">multiplier</span>

            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="n">event_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">symbol</span><span class="p">,</span>
                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="c1"># return the images ready for the display</span>
    <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="weather">Weather<a class="headerlink" href="#weather" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.modules.inkycal_weather"></a>
    <div class="doc doc-contents first">

        <p>Inkycal weather module
Copyright by aceinnolab</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.modules.inkycal_weather.Weather" class="doc doc-heading">
            <code>Weather</code>


<a href="#inkycal.modules.inkycal_weather.Weather" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="inkycal.modules.template.InkycalModule">InkycalModule</span></code></p>



        <p>Weather class
parses weather details from openweathermap</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/modules/inkycal_weather.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Weather</span><span class="p">(</span><span class="n">InkycalModule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Weather class</span>
<span class="sd">    parses weather details from openweathermap</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Weather (openweathermap) - Get weather forecasts from openweathermap&quot;</span>

    <span class="n">requires</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Please enter openweathermap api-key. You can create one for free on openweathermap&quot;</span><span class="p">,</span>
        <span class="p">},</span>

        <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Please enter your location in the following format: City, Country-Code. &quot;</span> <span class="o">+</span>
                     <span class="s2">&quot;You can also enter the location ID found in the url &quot;</span> <span class="o">+</span>
                     <span class="s2">&quot;e.g. https://openweathermap.org/city/4893171 -&gt; ID is 4893171&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">optional</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s2">&quot;round_temperature&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Round temperature to the nearest degree?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="p">},</span>

        <span class="s2">&quot;round_wind_speed&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Round windspeed?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="p">},</span>

        <span class="s2">&quot;forecast_interval&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Please select the forecast interval&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;daily&quot;</span><span class="p">,</span> <span class="s2">&quot;hourly&quot;</span><span class="p">],</span>
        <span class="p">},</span>

        <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Which units should be used?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">,</span> <span class="s2">&quot;imperial&quot;</span><span class="p">],</span>
        <span class="p">},</span>

        <span class="s2">&quot;hour_format&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Which hour format do you prefer?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span>
        <span class="p">},</span>

        <span class="s2">&quot;use_beaufort&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Use beaufort scale for windspeed?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="p">},</span>

    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_weather module&quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="n">get_system_tz</span><span class="p">()</span>

        <span class="c1"># Check if all required parameters are present</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;config is missing </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># required parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>

        <span class="c1"># optional parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">round_temperature</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;round_temperature&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">round_wind_speed</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;round_windspeed&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forecast_interval</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;forecast_interval&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hour_format</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;hour_format&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;imperial&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span> <span class="o">=</span> <span class="s2">&quot;fahrenheit&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span> <span class="o">=</span> <span class="s2">&quot;celsius&quot;</span>

        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;use_beaufort&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span> <span class="o">=</span> <span class="s2">&quot;beaufort&quot;</span>
        <span class="k">elif</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;imperial&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span> <span class="o">=</span> <span class="s2">&quot;miles_hour&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span> <span class="o">=</span> <span class="s2">&quot;meters_sec&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span>
        <span class="c1"># additional configuration</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">owm</span> <span class="o">=</span> <span class="n">OpenWeatherMap</span><span class="p">(</span>
            <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
            <span class="n">city_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
            <span class="n">wind_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span><span class="p">,</span>
            <span class="n">temp_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span><span class="p">,</span>
            <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locale</span><span class="p">,</span>
            <span class="n">tz_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span><span class="o">=</span> <span class="n">FONTS</span><span class="o">.</span><span class="n">weather_icons</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span> <span class="o">==</span> <span class="s2">&quot;beaufort&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">windDispUnit</span> <span class="o">=</span> <span class="s2">&quot;bft&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span> <span class="o">==</span> <span class="s2">&quot;knots&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">windDispUnit</span> <span class="o">=</span> <span class="s2">&quot;kn&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span> <span class="o">==</span> <span class="s2">&quot;km_hour&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">windDispUnit</span> <span class="o">=</span> <span class="s2">&quot;km/h&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span> <span class="o">==</span> <span class="s2">&quot;miles_hour&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">windDispUnit</span> <span class="o">=</span> <span class="s2">&quot;mph&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">windDispUnit</span> <span class="o">=</span> <span class="s2">&quot;m/s&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span> <span class="o">==</span> <span class="s2">&quot;fahrenheit&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span> <span class="o">==</span> <span class="s2">&quot;celsius&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span> <span class="o">=</span> <span class="s2">&quot;Â°&quot;</span>

        <span class="c1"># give an OK message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> loaded&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

        <span class="c1"># Define new image size with respect to padding</span>
        <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
        <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
        <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Create an image for black pixels and one for coloured pixels</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="c1"># Check if internet is available</span>
        <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Network not reachable. Please check your connection.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">NetworkNotReachableError</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_moon_phase</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Calculate the current (approximate) moon phase</span>

<span class="sd">            Returns:</span>
<span class="sd">                The corresponding moonphase-icon.</span>
<span class="sd">            &quot;&quot;&quot;</span>

            <span class="n">dec</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">days</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">days</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dec</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span> <span class="o">/</span> <span class="n">dec</span><span class="p">(</span><span class="mi">86400</span><span class="p">))</span>
            <span class="n">lunations</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="s2">&quot;0.20439731&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">days</span> <span class="o">*</span> <span class="n">dec</span><span class="p">(</span><span class="s2">&quot;0.03386319269&quot;</span><span class="p">))</span>
            <span class="n">position</span> <span class="o">=</span> <span class="n">lunations</span> <span class="o">%</span> <span class="n">dec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">position</span> <span class="o">*</span> <span class="n">dec</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span> <span class="o">+</span> <span class="n">dec</span><span class="p">(</span><span class="s2">&quot;0.5&quot;</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf095</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf099</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf09c</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf0a0</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf0a3</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf0a7</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf0aa</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf0ae</span><span class="s1">&#39;</span>
            <span class="p">}[</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">is_negative</span><span class="p">(</span><span class="n">temp</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Check if temp is below freezing point of water (0Â°C/32Â°F)</span>
<span class="sd">            returns True if temp below freezing point, else False&quot;&quot;&quot;</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span> <span class="o">==</span> <span class="s1">&#39;celsius&#39;</span> <span class="ow">and</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span> <span class="o">==</span> <span class="s1">&#39;fahrenheit&#39;</span> <span class="ow">and</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">&lt;=</span> <span class="mi">32</span><span class="p">:</span>
                <span class="n">answer</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="n">answer</span>

        <span class="c1"># Lookup-table for weather icons and weather codes</span>
        <span class="n">weather_icons</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;01d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf00d</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;02d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf002</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;03d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf013</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;04d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf012</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;09d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf01a</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;10d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf019</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;11d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf01e</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;13d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf01b</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;50d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf014</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;01n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf02e</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;02n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf013</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;03n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf013</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;04n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf013</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;09n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf037</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;10n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf036</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;11n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf03b</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;13n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf038</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;50n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf023</span><span class="s1">&#39;</span>
        <span class="p">}</span>

        <span class="c1">#   column1    column2    column3    column4    column5    column6    column7</span>
        <span class="c1"># |----------|----------|----------|----------|----------|----------|----------|</span>
        <span class="c1"># |  time    | temperat.| moonphase| forecast1| forecast2| forecast3| forecast4|</span>
        <span class="c1"># | current  |----------|----------|----------|----------|----------|----------|</span>
        <span class="c1"># | weather  | humidity |  sunrise |  icon1   |  icon2   |  icon3   |  icon4   |</span>
        <span class="c1"># |  icon    |----------|----------|----------|----------|----------|----------|</span>
        <span class="c1"># |          | windspeed|  sunset  | temperat.| temperat.| temperat.| temperat.|</span>
        <span class="c1"># |----------|----------|----------|----------|----------|----------|----------|</span>

        <span class="c1"># Calculate size rows and columns</span>
        <span class="n">col_width</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">//</span> <span class="mi">7</span>

        <span class="c1"># Ratio width height</span>
        <span class="n">image_ratio</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">/</span> <span class="n">im_height</span>

        <span class="k">if</span> <span class="n">image_ratio</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">row_height</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">//</span> <span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Please consider decreasing the height.&#39;</span><span class="p">)</span>
            <span class="n">row_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_height</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">im_height</span> <span class="o">/</span> <span class="n">im_width</span><span class="p">))</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;row_height: </span><span class="si">{</span><span class="n">row_height</span><span class="si">}</span><span class="s2"> | col_width: </span><span class="si">{</span><span class="n">col_width</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate spacings for better centering</span>
        <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_width</span> <span class="o">%</span> <span class="n">col_width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Define sizes for weather icons</span>
        <span class="n">icon_small</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">col_width</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># Calculate the x-axis position of each col</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="n">spacing_top</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">col1</span> <span class="o">+</span> <span class="n">col_width</span>
        <span class="n">col3</span> <span class="o">=</span> <span class="n">col2</span> <span class="o">+</span> <span class="n">col_width</span>
        <span class="n">col4</span> <span class="o">=</span> <span class="n">col3</span> <span class="o">+</span> <span class="n">col_width</span>
        <span class="n">col5</span> <span class="o">=</span> <span class="n">col4</span> <span class="o">+</span> <span class="n">col_width</span>
        <span class="n">col6</span> <span class="o">=</span> <span class="n">col5</span> <span class="o">+</span> <span class="n">col_width</span>
        <span class="n">col7</span> <span class="o">=</span> <span class="n">col6</span> <span class="o">+</span> <span class="n">col_width</span>

        <span class="c1"># Calculate the y-axis position of each row</span>
        <span class="n">line_gap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_height</span> <span class="o">-</span> <span class="n">spacing_top</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">row_height</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">row1</span> <span class="o">=</span> <span class="n">line_gap</span>
        <span class="n">row2</span> <span class="o">=</span> <span class="n">row1</span> <span class="o">+</span> <span class="n">line_gap</span> <span class="o">+</span> <span class="n">row_height</span>
        <span class="n">row3</span> <span class="o">=</span> <span class="n">row2</span> <span class="o">+</span> <span class="n">line_gap</span> <span class="o">+</span> <span class="n">row_height</span>

        <span class="c1"># Draw lines on each row and border</span>
        <span class="c1"># draw = ImageDraw.Draw(canvas.image_black)</span>
        <span class="c1"># draw.line((0, 0, im_width, 0), fill=&#39;red&#39;)</span>
        <span class="c1"># draw.line((0, im_height-1, im_width, im_height-1), fill=&#39;red&#39;)</span>
        <span class="c1"># draw.line((0, row1, im_width, row1), fill=&#39;black&#39;)</span>
        <span class="c1"># draw.line((0, row1+row_height, im_width, row1+row_height), fill=&#39;black&#39;)</span>
        <span class="c1"># draw.line((0, row2, im_width, row2), fill=&#39;black&#39;)</span>
        <span class="c1"># draw.line((0, row2+row_height, im_width, row2+row_height), fill=&#39;black&#39;)</span>
        <span class="c1"># draw.line((0, row3, im_width, row3), fill=&#39;black&#39;)</span>
        <span class="c1"># draw.line((0, row3+row_height, im_width, row3+row_height), fill=&#39;black&#39;)</span>

        <span class="c1"># Positions for current weather details</span>
        <span class="n">weather_icon_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">temperature_icon_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col2</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span>
        <span class="n">temperature_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col2</span> <span class="o">+</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span>
        <span class="n">humidity_icon_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col2</span><span class="p">,</span> <span class="n">row2</span><span class="p">)</span>
        <span class="n">humidity_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col2</span> <span class="o">+</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row2</span><span class="p">)</span>
        <span class="n">windspeed_icon_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col2</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span>
        <span class="n">windspeed_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col2</span> <span class="o">+</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span>

        <span class="c1"># Positions for sunrise, sunset, moonphase</span>
        <span class="n">moonphase_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col3</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span>
        <span class="n">sunrise_icon_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col3</span><span class="p">,</span> <span class="n">row2</span><span class="p">)</span>
        <span class="n">sunrise_time_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col3</span> <span class="o">+</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row2</span><span class="p">)</span>
        <span class="n">sunset_icon_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col3</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span>
        <span class="n">sunset_time_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col3</span> <span class="o">+</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span>

        <span class="c1"># Positions for forecast 1</span>
        <span class="n">stamp_fc1</span> <span class="o">=</span> <span class="p">(</span><span class="n">col4</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span> <span class="c1"># noqa</span>
        <span class="n">icon_fc1</span> <span class="o">=</span> <span class="p">(</span><span class="n">col4</span><span class="p">,</span> <span class="n">row1</span> <span class="o">+</span> <span class="n">row_height</span><span class="p">)</span> <span class="c1"># noqa</span>
        <span class="n">temp_fc1</span> <span class="o">=</span> <span class="p">(</span><span class="n">col4</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span> <span class="c1"># noqa</span>

        <span class="c1"># Positions for forecast 2</span>
        <span class="n">stamp_fc2</span> <span class="o">=</span> <span class="p">(</span><span class="n">col5</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span> <span class="c1"># noqa</span>
        <span class="n">icon_fc2</span> <span class="o">=</span> <span class="p">(</span><span class="n">col5</span><span class="p">,</span> <span class="n">row1</span> <span class="o">+</span> <span class="n">row_height</span><span class="p">)</span> <span class="c1"># noqa</span>
        <span class="n">temp_fc2</span> <span class="o">=</span> <span class="p">(</span><span class="n">col5</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span> <span class="c1"># noqa</span>

        <span class="c1"># Positions for forecast 3</span>
        <span class="n">stamp_fc3</span> <span class="o">=</span> <span class="p">(</span><span class="n">col6</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span> <span class="c1"># noqa</span>
        <span class="n">icon_fc3</span> <span class="o">=</span> <span class="p">(</span><span class="n">col6</span><span class="p">,</span> <span class="n">row1</span> <span class="o">+</span> <span class="n">row_height</span><span class="p">)</span> <span class="c1"># noqa</span>
        <span class="n">temp_fc3</span> <span class="o">=</span> <span class="p">(</span><span class="n">col6</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span> <span class="c1"># noqa</span>

        <span class="c1"># Positions for forecast 4</span>
        <span class="n">stamp_fc4</span> <span class="o">=</span> <span class="p">(</span><span class="n">col7</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span> <span class="c1"># noqa</span>
        <span class="n">icon_fc4</span> <span class="o">=</span> <span class="p">(</span><span class="n">col7</span><span class="p">,</span> <span class="n">row1</span> <span class="o">+</span> <span class="n">row_height</span><span class="p">)</span> <span class="c1"># noqa</span>
        <span class="n">temp_fc4</span> <span class="o">=</span> <span class="p">(</span><span class="n">col7</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span> <span class="c1"># noqa</span>

        <span class="c1"># Create current-weather and weather-forecast objects</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;looking up location by ID&#39;</span><span class="p">)</span>
        <span class="n">current_weather</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">owm</span><span class="o">.</span><span class="n">get_current_weather</span><span class="p">()</span>
        <span class="n">weather_forecasts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">owm</span><span class="o">.</span><span class="n">get_weather_forecast</span><span class="p">()</span>

        <span class="c1"># Set decimals</span>
        <span class="n">dec_temp</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_temperature</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">dec_wind</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_wind_speed</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">else</span> <span class="mi">1</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;temperature unit: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;decimals temperature: </span><span class="si">{</span><span class="n">dec_temp</span><span class="si">}</span><span class="s1"> | decimals wind: </span><span class="si">{</span><span class="n">dec_wind</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Get current time</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>

        <span class="n">fc_data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_interval</span> <span class="o">==</span> <span class="s1">&#39;hourly&#39;</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;getting hourly forecasts&quot;</span><span class="p">)</span>

            <span class="c1"># Add next 4 forecasts to fc_data dictionary, since we only have</span>
            <span class="n">fc_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">forecast</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">weather_forecasts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]):</span>
                <span class="n">fc_data</span><span class="p">[</span><span class="s1">&#39;fc&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;temp&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">dec_temp</span><span class="si">}</span><span class="s2">f</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s1">&#39;icon&#39;</span><span class="p">:</span> <span class="n">forecast</span><span class="p">[</span><span class="s2">&quot;icon&quot;</span><span class="p">],</span>
                    <span class="s1">&#39;stamp&#39;</span><span class="p">:</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;h a&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hour_format</span> <span class="o">==</span> <span class="mi">12</span> <span class="k">else</span> <span class="s2">&quot;H:mm&quot;</span><span class="p">)</span>
                <span class="p">}</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_interval</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;getting daily forecasts&quot;</span><span class="p">)</span>

            <span class="n">daily_forecasts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">owm</span><span class="o">.</span><span class="n">get_forecast_for_day</span><span class="p">(</span><span class="n">days</span><span class="p">)</span> <span class="k">for</span> <span class="n">days</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>

            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">forecast</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">daily_forecasts</span><span class="p">):</span>
                <span class="n">fc_data</span><span class="p">[</span><span class="s1">&#39;fc&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;temp&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">forecast</span><span class="p">[</span><span class="s2">&quot;temp_min&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.</span><span class="si">{</span><span class="n">dec_temp</span><span class="si">}</span><span class="s1">f</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">forecast</span><span class="p">[</span><span class="s2">&quot;temp_max&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.</span><span class="si">{</span><span class="n">dec_temp</span><span class="si">}</span><span class="s1">f</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;icon&#39;</span><span class="p">:</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;icon&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;stamp&#39;</span><span class="p">:</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;ddd&quot;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locale</span><span class="p">)</span>
                <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid forecast interval specified: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">forecast_interval</span><span class="si">}</span><span class="s2">. Check your settings!&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">fc_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>

        <span class="c1"># Get some current weather details</span>

        <span class="n">temperature</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_weather</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">dec_temp</span><span class="si">}</span><span class="s2">f</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">weather_icon</span> <span class="o">=</span> <span class="n">current_weather</span><span class="p">[</span><span class="s2">&quot;weather_icon_name&quot;</span><span class="p">]</span>
        <span class="n">humidity</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_weather</span><span class="p">[</span><span class="s2">&quot;humidity&quot;</span><span class="p">])</span>

        <span class="n">sunrise_raw</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_weather</span><span class="p">[</span><span class="s2">&quot;sunrise&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>
        <span class="n">sunset_raw</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_weather</span><span class="p">[</span><span class="s2">&quot;sunset&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;weather_icon: </span><span class="si">{</span><span class="n">weather_icon</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hour_format</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;using 12 hour format for sunrise/sunset&#39;</span><span class="p">)</span>
            <span class="n">sunrise</span> <span class="o">=</span> <span class="n">sunrise_raw</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;h:mm a&#39;</span><span class="p">)</span>
            <span class="n">sunset</span> <span class="o">=</span> <span class="n">sunset_raw</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;h:mm a&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># 24 hours format</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;using 24 hour format for sunrise/sunset&#39;</span><span class="p">)</span>
            <span class="n">sunrise</span> <span class="o">=</span> <span class="n">sunrise_raw</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;H:mm&#39;</span><span class="p">)</span>
            <span class="n">sunset</span> <span class="o">=</span> <span class="n">sunset_raw</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;H:mm&#39;</span><span class="p">)</span>

        <span class="c1"># Format the wind-speed to user preference</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;getting wind speed in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">windDispUnit</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">wind</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_weather</span><span class="p">[</span><span class="s1">&#39;wind&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">dec_wind</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">windDispUnit</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">moon_phase</span> <span class="o">=</span> <span class="n">get_moon_phase</span><span class="p">()</span>

        <span class="c1"># Fill weather details in col 1 (current weather icon)</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">weather_icon_pos</span><span class="p">,</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">),</span>
            <span class="n">icon</span><span class="o">=</span><span class="n">weather_icons</span><span class="p">[</span><span class="n">weather_icon</span><span class="p">],</span>
            <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
        <span class="p">)</span>

        <span class="c1"># Fill weather details in col 2 (temp, humidity, wind)</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">temperature_icon_pos</span><span class="p">,</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">icon_small</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
            <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\uf053</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
        <span class="p">)</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">temperature_pos</span><span class="p">,</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span> <span class="o">-</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
            <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span> <span class="k">if</span> <span class="n">is_negative</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span>
        <span class="p">)</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">humidity_icon_pos</span><span class="p">,</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">icon_small</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
            <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\uf07a</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
        <span class="p">)</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">humidity_pos</span><span class="p">,</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span> <span class="o">-</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">humidity</span><span class="si">}</span><span class="s2"> %&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">windspeed_icon_pos</span><span class="p">,</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">icon_small</span><span class="p">,</span> <span class="n">icon_small</span><span class="p">),</span>
            <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\uf050</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
        <span class="p">)</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">windspeed_pos</span><span class="p">,</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span> <span class="o">-</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="n">wind</span>
        <span class="p">)</span>

        <span class="c1"># Fill weather details in col 3 (moonphase, sunrise, sunset)</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">moonphase_pos</span><span class="p">,</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
            <span class="n">icon</span><span class="o">=</span><span class="n">moon_phase</span><span class="p">,</span>
            <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
        <span class="p">)</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">sunrise_icon_pos</span><span class="p">,</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">icon_small</span><span class="p">,</span> <span class="n">icon_small</span><span class="p">),</span>
            <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\uf051</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
        <span class="p">)</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">sunrise_time_pos</span><span class="p">,</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span> <span class="o">-</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="n">sunrise</span>
        <span class="p">)</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">sunset_icon_pos</span><span class="p">,</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">icon_small</span><span class="p">,</span> <span class="n">icon_small</span><span class="p">),</span>
            <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\uf052</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
        <span class="p">)</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">sunset_time_pos</span><span class="p">,</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span> <span class="o">-</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="n">sunset</span>
        <span class="p">)</span>
        <span class="c1"># Add the forecast data to the correct places</span>
        <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fc_data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">stamp</span> <span class="o">=</span> <span class="n">fc_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;fc</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;stamp&#39;</span><span class="p">]</span>
            <span class="c1"># check if we&#39;re using daily forecasts</span>
            <span class="k">if</span> <span class="s2">&quot;day&quot;</span> <span class="ow">in</span> <span class="n">stamp</span><span class="p">:</span>
                <span class="n">stamp</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fc_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;fc</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;stamp&#39;</span><span class="p">],</span> <span class="s2">&quot;dddd&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;dddd&quot;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locale</span><span class="p">)</span>

            <span class="n">icon</span> <span class="o">=</span> <span class="n">weather_icons</span><span class="p">[</span><span class="n">fc_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;fc</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;icon&#39;</span><span class="p">]]</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">fc_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;fc</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span>

            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;stamp_fc</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">stamp</span>
            <span class="p">)</span>

            <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;icon_fc</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span><span class="p">,</span> <span class="n">row_height</span> <span class="o">+</span> <span class="n">line_gap</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">icon</span><span class="o">=</span><span class="n">icon</span><span class="p">,</span>
                <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
                <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
            <span class="p">)</span>

            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;temp_fc</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">temp</span>
            <span class="p">)</span>

        <span class="n">border_h</span> <span class="o">=</span> <span class="n">row3</span> <span class="o">+</span> <span class="n">row_height</span>
        <span class="n">border_w</span> <span class="o">=</span> <span class="n">col_width</span> <span class="o">-</span> <span class="mi">3</span>  <span class="c1"># leave 3 pixels gap</span>

        <span class="c1"># Add borders around each subsection</span>
        <span class="n">draw_border</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">row1</span><span class="p">),</span> <span class="p">(</span><span class="n">col_width</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">border_h</span><span class="p">),</span>
                    <span class="n">shrinkage</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
            <span class="n">draw_border</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;col</span><span class="si">{</span><span class="n">_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">row1</span><span class="p">),</span> <span class="p">(</span><span class="n">border_w</span><span class="p">,</span> <span class="n">border_h</span><span class="p">),</span>
                        <span class="n">shrinkage</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1"># return the images ready for the display</span>
        <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_weather.Weather.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#inkycal.modules.inkycal_weather.Weather.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize inkycal_weather module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_weather.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_weather module&quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="n">get_system_tz</span><span class="p">()</span>

    <span class="c1"># Check if all required parameters are present</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;config is missing </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># required parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span>

    <span class="c1"># optional parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">round_temperature</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;round_temperature&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">round_wind_speed</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;round_windspeed&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">forecast_interval</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;forecast_interval&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hour_format</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;hour_format&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;imperial&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span> <span class="o">=</span> <span class="s2">&quot;fahrenheit&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span> <span class="o">=</span> <span class="s2">&quot;celsius&quot;</span>

    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;use_beaufort&#39;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span> <span class="o">=</span> <span class="s2">&quot;beaufort&quot;</span>
    <span class="k">elif</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;imperial&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span> <span class="o">=</span> <span class="s2">&quot;miles_hour&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span> <span class="o">=</span> <span class="s2">&quot;meters_sec&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span>
    <span class="c1"># additional configuration</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">owm</span> <span class="o">=</span> <span class="n">OpenWeatherMap</span><span class="p">(</span>
        <span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
        <span class="n">city_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span>
        <span class="n">wind_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span><span class="p">,</span>
        <span class="n">temp_unit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span><span class="p">,</span>
        <span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locale</span><span class="p">,</span>
        <span class="n">tz_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span><span class="o">=</span> <span class="n">FONTS</span><span class="o">.</span><span class="n">weather_icons</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span> <span class="o">==</span> <span class="s2">&quot;beaufort&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windDispUnit</span> <span class="o">=</span> <span class="s2">&quot;bft&quot;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span> <span class="o">==</span> <span class="s2">&quot;knots&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windDispUnit</span> <span class="o">=</span> <span class="s2">&quot;kn&quot;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span> <span class="o">==</span> <span class="s2">&quot;km_hour&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windDispUnit</span> <span class="o">=</span> <span class="s2">&quot;km/h&quot;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">wind_unit</span> <span class="o">==</span> <span class="s2">&quot;miles_hour&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windDispUnit</span> <span class="o">=</span> <span class="s2">&quot;mph&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windDispUnit</span> <span class="o">=</span> <span class="s2">&quot;m/s&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span> <span class="o">==</span> <span class="s2">&quot;fahrenheit&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span> <span class="o">==</span> <span class="s2">&quot;celsius&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span> <span class="o">=</span> <span class="s2">&quot;Â°&quot;</span>

    <span class="c1"># give an OK message</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> loaded&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_weather.Weather.generate_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate_image</span><span class="p">()</span></code>

<a href="#inkycal.modules.inkycal_weather.Weather.generate_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate image for this module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_weather.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

    <span class="c1"># Define new image size with respect to padding</span>
    <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
    <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Create an image for black pixels and one for coloured pixels</span>
    <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Check if internet is available</span>
    <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Network not reachable. Please check your connection.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">NetworkNotReachableError</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_moon_phase</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate the current (approximate) moon phase</span>

<span class="sd">        Returns:</span>
<span class="sd">            The corresponding moonphase-icon.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dec</span> <span class="o">=</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">days</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">days</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">dec</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span> <span class="o">/</span> <span class="n">dec</span><span class="p">(</span><span class="mi">86400</span><span class="p">))</span>
        <span class="n">lunations</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="s2">&quot;0.20439731&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">days</span> <span class="o">*</span> <span class="n">dec</span><span class="p">(</span><span class="s2">&quot;0.03386319269&quot;</span><span class="p">))</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">lunations</span> <span class="o">%</span> <span class="n">dec</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">position</span> <span class="o">*</span> <span class="n">dec</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span> <span class="o">+</span> <span class="n">dec</span><span class="p">(</span><span class="s2">&quot;0.5&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf095</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf099</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf09c</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf0a0</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf0a3</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf0a7</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="mi">6</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf0aa</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="mi">7</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf0ae</span><span class="s1">&#39;</span>
        <span class="p">}[</span><span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_negative</span><span class="p">(</span><span class="n">temp</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if temp is below freezing point of water (0Â°C/32Â°F)</span>
<span class="sd">        returns True if temp below freezing point, else False&quot;&quot;&quot;</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span> <span class="o">==</span> <span class="s1">&#39;celsius&#39;</span> <span class="ow">and</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span> <span class="o">==</span> <span class="s1">&#39;fahrenheit&#39;</span> <span class="ow">and</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">&lt;=</span> <span class="mi">32</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">answer</span>

    <span class="c1"># Lookup-table for weather icons and weather codes</span>
    <span class="n">weather_icons</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;01d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf00d</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;02d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf002</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;03d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf013</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;04d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf012</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;09d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf01a</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;10d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf019</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;11d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf01e</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;13d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf01b</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;50d&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf014</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;01n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf02e</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;02n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf013</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;03n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf013</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;04n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf013</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;09n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf037</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;10n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf036</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;11n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf03b</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;13n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf038</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39;50n&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\uf023</span><span class="s1">&#39;</span>
    <span class="p">}</span>

    <span class="c1">#   column1    column2    column3    column4    column5    column6    column7</span>
    <span class="c1"># |----------|----------|----------|----------|----------|----------|----------|</span>
    <span class="c1"># |  time    | temperat.| moonphase| forecast1| forecast2| forecast3| forecast4|</span>
    <span class="c1"># | current  |----------|----------|----------|----------|----------|----------|</span>
    <span class="c1"># | weather  | humidity |  sunrise |  icon1   |  icon2   |  icon3   |  icon4   |</span>
    <span class="c1"># |  icon    |----------|----------|----------|----------|----------|----------|</span>
    <span class="c1"># |          | windspeed|  sunset  | temperat.| temperat.| temperat.| temperat.|</span>
    <span class="c1"># |----------|----------|----------|----------|----------|----------|----------|</span>

    <span class="c1"># Calculate size rows and columns</span>
    <span class="n">col_width</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">//</span> <span class="mi">7</span>

    <span class="c1"># Ratio width height</span>
    <span class="n">image_ratio</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">/</span> <span class="n">im_height</span>

    <span class="k">if</span> <span class="n">image_ratio</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">row_height</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">//</span> <span class="mi">3</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Please consider decreasing the height.&#39;</span><span class="p">)</span>
        <span class="n">row_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_height</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">im_height</span> <span class="o">/</span> <span class="n">im_width</span><span class="p">))</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;row_height: </span><span class="si">{</span><span class="n">row_height</span><span class="si">}</span><span class="s2"> | col_width: </span><span class="si">{</span><span class="n">col_width</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate spacings for better centering</span>
    <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_width</span> <span class="o">%</span> <span class="n">col_width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Define sizes for weather icons</span>
    <span class="n">icon_small</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">col_width</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Calculate the x-axis position of each col</span>
    <span class="n">col1</span> <span class="o">=</span> <span class="n">spacing_top</span>
    <span class="n">col2</span> <span class="o">=</span> <span class="n">col1</span> <span class="o">+</span> <span class="n">col_width</span>
    <span class="n">col3</span> <span class="o">=</span> <span class="n">col2</span> <span class="o">+</span> <span class="n">col_width</span>
    <span class="n">col4</span> <span class="o">=</span> <span class="n">col3</span> <span class="o">+</span> <span class="n">col_width</span>
    <span class="n">col5</span> <span class="o">=</span> <span class="n">col4</span> <span class="o">+</span> <span class="n">col_width</span>
    <span class="n">col6</span> <span class="o">=</span> <span class="n">col5</span> <span class="o">+</span> <span class="n">col_width</span>
    <span class="n">col7</span> <span class="o">=</span> <span class="n">col6</span> <span class="o">+</span> <span class="n">col_width</span>

    <span class="c1"># Calculate the y-axis position of each row</span>
    <span class="n">line_gap</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_height</span> <span class="o">-</span> <span class="n">spacing_top</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">row_height</span><span class="p">)</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)</span>

    <span class="n">row1</span> <span class="o">=</span> <span class="n">line_gap</span>
    <span class="n">row2</span> <span class="o">=</span> <span class="n">row1</span> <span class="o">+</span> <span class="n">line_gap</span> <span class="o">+</span> <span class="n">row_height</span>
    <span class="n">row3</span> <span class="o">=</span> <span class="n">row2</span> <span class="o">+</span> <span class="n">line_gap</span> <span class="o">+</span> <span class="n">row_height</span>

    <span class="c1"># Draw lines on each row and border</span>
    <span class="c1"># draw = ImageDraw.Draw(canvas.image_black)</span>
    <span class="c1"># draw.line((0, 0, im_width, 0), fill=&#39;red&#39;)</span>
    <span class="c1"># draw.line((0, im_height-1, im_width, im_height-1), fill=&#39;red&#39;)</span>
    <span class="c1"># draw.line((0, row1, im_width, row1), fill=&#39;black&#39;)</span>
    <span class="c1"># draw.line((0, row1+row_height, im_width, row1+row_height), fill=&#39;black&#39;)</span>
    <span class="c1"># draw.line((0, row2, im_width, row2), fill=&#39;black&#39;)</span>
    <span class="c1"># draw.line((0, row2+row_height, im_width, row2+row_height), fill=&#39;black&#39;)</span>
    <span class="c1"># draw.line((0, row3, im_width, row3), fill=&#39;black&#39;)</span>
    <span class="c1"># draw.line((0, row3+row_height, im_width, row3+row_height), fill=&#39;black&#39;)</span>

    <span class="c1"># Positions for current weather details</span>
    <span class="n">weather_icon_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">temperature_icon_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col2</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span>
    <span class="n">temperature_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col2</span> <span class="o">+</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span>
    <span class="n">humidity_icon_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col2</span><span class="p">,</span> <span class="n">row2</span><span class="p">)</span>
    <span class="n">humidity_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col2</span> <span class="o">+</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row2</span><span class="p">)</span>
    <span class="n">windspeed_icon_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col2</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span>
    <span class="n">windspeed_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col2</span> <span class="o">+</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span>

    <span class="c1"># Positions for sunrise, sunset, moonphase</span>
    <span class="n">moonphase_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col3</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span>
    <span class="n">sunrise_icon_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col3</span><span class="p">,</span> <span class="n">row2</span><span class="p">)</span>
    <span class="n">sunrise_time_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col3</span> <span class="o">+</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row2</span><span class="p">)</span>
    <span class="n">sunset_icon_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col3</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span>
    <span class="n">sunset_time_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">col3</span> <span class="o">+</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span>

    <span class="c1"># Positions for forecast 1</span>
    <span class="n">stamp_fc1</span> <span class="o">=</span> <span class="p">(</span><span class="n">col4</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span> <span class="c1"># noqa</span>
    <span class="n">icon_fc1</span> <span class="o">=</span> <span class="p">(</span><span class="n">col4</span><span class="p">,</span> <span class="n">row1</span> <span class="o">+</span> <span class="n">row_height</span><span class="p">)</span> <span class="c1"># noqa</span>
    <span class="n">temp_fc1</span> <span class="o">=</span> <span class="p">(</span><span class="n">col4</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span> <span class="c1"># noqa</span>

    <span class="c1"># Positions for forecast 2</span>
    <span class="n">stamp_fc2</span> <span class="o">=</span> <span class="p">(</span><span class="n">col5</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span> <span class="c1"># noqa</span>
    <span class="n">icon_fc2</span> <span class="o">=</span> <span class="p">(</span><span class="n">col5</span><span class="p">,</span> <span class="n">row1</span> <span class="o">+</span> <span class="n">row_height</span><span class="p">)</span> <span class="c1"># noqa</span>
    <span class="n">temp_fc2</span> <span class="o">=</span> <span class="p">(</span><span class="n">col5</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span> <span class="c1"># noqa</span>

    <span class="c1"># Positions for forecast 3</span>
    <span class="n">stamp_fc3</span> <span class="o">=</span> <span class="p">(</span><span class="n">col6</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span> <span class="c1"># noqa</span>
    <span class="n">icon_fc3</span> <span class="o">=</span> <span class="p">(</span><span class="n">col6</span><span class="p">,</span> <span class="n">row1</span> <span class="o">+</span> <span class="n">row_height</span><span class="p">)</span> <span class="c1"># noqa</span>
    <span class="n">temp_fc3</span> <span class="o">=</span> <span class="p">(</span><span class="n">col6</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span> <span class="c1"># noqa</span>

    <span class="c1"># Positions for forecast 4</span>
    <span class="n">stamp_fc4</span> <span class="o">=</span> <span class="p">(</span><span class="n">col7</span><span class="p">,</span> <span class="n">row1</span><span class="p">)</span> <span class="c1"># noqa</span>
    <span class="n">icon_fc4</span> <span class="o">=</span> <span class="p">(</span><span class="n">col7</span><span class="p">,</span> <span class="n">row1</span> <span class="o">+</span> <span class="n">row_height</span><span class="p">)</span> <span class="c1"># noqa</span>
    <span class="n">temp_fc4</span> <span class="o">=</span> <span class="p">(</span><span class="n">col7</span><span class="p">,</span> <span class="n">row3</span><span class="p">)</span> <span class="c1"># noqa</span>

    <span class="c1"># Create current-weather and weather-forecast objects</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;looking up location by ID&#39;</span><span class="p">)</span>
    <span class="n">current_weather</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">owm</span><span class="o">.</span><span class="n">get_current_weather</span><span class="p">()</span>
    <span class="n">weather_forecasts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">owm</span><span class="o">.</span><span class="n">get_weather_forecast</span><span class="p">()</span>

    <span class="c1"># Set decimals</span>
    <span class="n">dec_temp</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_temperature</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">dec_wind</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_wind_speed</span> <span class="o">==</span> <span class="kc">True</span> <span class="k">else</span> <span class="mi">1</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;temperature unit: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">temp_unit</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;decimals temperature: </span><span class="si">{</span><span class="n">dec_temp</span><span class="si">}</span><span class="s1"> | decimals wind: </span><span class="si">{</span><span class="n">dec_wind</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Get current time</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>

    <span class="n">fc_data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_interval</span> <span class="o">==</span> <span class="s1">&#39;hourly&#39;</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;getting hourly forecasts&quot;</span><span class="p">)</span>

        <span class="c1"># Add next 4 forecasts to fc_data dictionary, since we only have</span>
        <span class="n">fc_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">forecast</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">weather_forecasts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]):</span>
            <span class="n">fc_data</span><span class="p">[</span><span class="s1">&#39;fc&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;temp&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">dec_temp</span><span class="si">}</span><span class="s2">f</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s1">&#39;icon&#39;</span><span class="p">:</span> <span class="n">forecast</span><span class="p">[</span><span class="s2">&quot;icon&quot;</span><span class="p">],</span>
                <span class="s1">&#39;stamp&#39;</span><span class="p">:</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;h a&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hour_format</span> <span class="o">==</span> <span class="mi">12</span> <span class="k">else</span> <span class="s2">&quot;H:mm&quot;</span><span class="p">)</span>
            <span class="p">}</span>

    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_interval</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;getting daily forecasts&quot;</span><span class="p">)</span>

        <span class="n">daily_forecasts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">owm</span><span class="o">.</span><span class="n">get_forecast_for_day</span><span class="p">(</span><span class="n">days</span><span class="p">)</span> <span class="k">for</span> <span class="n">days</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">forecast</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">daily_forecasts</span><span class="p">):</span>
            <span class="n">fc_data</span><span class="p">[</span><span class="s1">&#39;fc&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;temp&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">forecast</span><span class="p">[</span><span class="s2">&quot;temp_min&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.</span><span class="si">{</span><span class="n">dec_temp</span><span class="si">}</span><span class="s1">f</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">forecast</span><span class="p">[</span><span class="s2">&quot;temp_max&quot;</span><span class="p">]</span><span class="si">:</span><span class="s1">.</span><span class="si">{</span><span class="n">dec_temp</span><span class="si">}</span><span class="s1">f</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;icon&#39;</span><span class="p">:</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;icon&#39;</span><span class="p">],</span>
                <span class="s1">&#39;stamp&#39;</span><span class="p">:</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;ddd&quot;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locale</span><span class="p">)</span>
            <span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid forecast interval specified: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">forecast_interval</span><span class="si">}</span><span class="s2">. Check your settings!&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">fc_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>

    <span class="c1"># Get some current weather details</span>

    <span class="n">temperature</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_weather</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">dec_temp</span><span class="si">}</span><span class="s2">f</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">tempDispUnit</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">weather_icon</span> <span class="o">=</span> <span class="n">current_weather</span><span class="p">[</span><span class="s2">&quot;weather_icon_name&quot;</span><span class="p">]</span>
    <span class="n">humidity</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_weather</span><span class="p">[</span><span class="s2">&quot;humidity&quot;</span><span class="p">])</span>

    <span class="n">sunrise_raw</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_weather</span><span class="p">[</span><span class="s2">&quot;sunrise&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>
    <span class="n">sunset_raw</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_weather</span><span class="p">[</span><span class="s2">&quot;sunset&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;weather_icon: </span><span class="si">{</span><span class="n">weather_icon</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hour_format</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;using 12 hour format for sunrise/sunset&#39;</span><span class="p">)</span>
        <span class="n">sunrise</span> <span class="o">=</span> <span class="n">sunrise_raw</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;h:mm a&#39;</span><span class="p">)</span>
        <span class="n">sunset</span> <span class="o">=</span> <span class="n">sunset_raw</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;h:mm a&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 24 hours format</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;using 24 hour format for sunrise/sunset&#39;</span><span class="p">)</span>
        <span class="n">sunrise</span> <span class="o">=</span> <span class="n">sunrise_raw</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;H:mm&#39;</span><span class="p">)</span>
        <span class="n">sunset</span> <span class="o">=</span> <span class="n">sunset_raw</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;H:mm&#39;</span><span class="p">)</span>

    <span class="c1"># Format the wind-speed to user preference</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;getting wind speed in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">windDispUnit</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">wind</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">current_weather</span><span class="p">[</span><span class="s1">&#39;wind&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.</span><span class="si">{</span><span class="n">dec_wind</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">windDispUnit</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">moon_phase</span> <span class="o">=</span> <span class="n">get_moon_phase</span><span class="p">()</span>

    <span class="c1"># Fill weather details in col 1 (current weather icon)</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="n">weather_icon_pos</span><span class="p">,</span>
        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">),</span>
        <span class="n">icon</span><span class="o">=</span><span class="n">weather_icons</span><span class="p">[</span><span class="n">weather_icon</span><span class="p">],</span>
        <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
    <span class="p">)</span>

    <span class="c1"># Fill weather details in col 2 (temp, humidity, wind)</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="n">temperature_icon_pos</span><span class="p">,</span>
        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">icon_small</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
        <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\uf053</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
    <span class="p">)</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="n">temperature_pos</span><span class="p">,</span>
        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span> <span class="o">-</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
        <span class="n">text</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span>
        <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span> <span class="k">if</span> <span class="n">is_negative</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span>
    <span class="p">)</span>

    <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="n">humidity_icon_pos</span><span class="p">,</span>
        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">icon_small</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
        <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\uf07a</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
    <span class="p">)</span>

    <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="n">humidity_pos</span><span class="p">,</span>
        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span> <span class="o">-</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
        <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">humidity</span><span class="si">}</span><span class="s2"> %&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="n">windspeed_icon_pos</span><span class="p">,</span>
        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">icon_small</span><span class="p">,</span> <span class="n">icon_small</span><span class="p">),</span>
        <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\uf050</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
    <span class="p">)</span>

    <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="n">windspeed_pos</span><span class="p">,</span>
        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span> <span class="o">-</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
        <span class="n">text</span><span class="o">=</span><span class="n">wind</span>
    <span class="p">)</span>

    <span class="c1"># Fill weather details in col 3 (moonphase, sunrise, sunset)</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="n">moonphase_pos</span><span class="p">,</span>
        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
        <span class="n">icon</span><span class="o">=</span><span class="n">moon_phase</span><span class="p">,</span>
        <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
    <span class="p">)</span>

    <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="n">sunrise_icon_pos</span><span class="p">,</span>
        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">icon_small</span><span class="p">,</span> <span class="n">icon_small</span><span class="p">),</span>
        <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\uf051</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
    <span class="p">)</span>

    <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="n">sunrise_time_pos</span><span class="p">,</span>
        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span> <span class="o">-</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
        <span class="n">text</span><span class="o">=</span><span class="n">sunrise</span>
    <span class="p">)</span>

    <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="n">sunset_icon_pos</span><span class="p">,</span>
        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">icon_small</span><span class="p">,</span> <span class="n">icon_small</span><span class="p">),</span>
        <span class="n">icon</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\uf052</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
        <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
    <span class="p">)</span>

    <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="n">sunset_time_pos</span><span class="p">,</span>
        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span> <span class="o">-</span> <span class="n">icon_small</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
        <span class="n">text</span><span class="o">=</span><span class="n">sunset</span>
    <span class="p">)</span>
    <span class="c1"># Add the forecast data to the correct places</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fc_data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">stamp</span> <span class="o">=</span> <span class="n">fc_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;fc</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;stamp&#39;</span><span class="p">]</span>
        <span class="c1"># check if we&#39;re using daily forecasts</span>
        <span class="k">if</span> <span class="s2">&quot;day&quot;</span> <span class="ow">in</span> <span class="n">stamp</span><span class="p">:</span>
            <span class="n">stamp</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fc_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;fc</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;stamp&#39;</span><span class="p">],</span> <span class="s2">&quot;dddd&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;dddd&quot;</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locale</span><span class="p">)</span>

        <span class="n">icon</span> <span class="o">=</span> <span class="n">weather_icons</span><span class="p">[</span><span class="n">fc_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;fc</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;icon&#39;</span><span class="p">]]</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">fc_data</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;fc</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">][</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;stamp_fc</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="n">stamp</span>
        <span class="p">)</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">draw_icon</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;icon_fc</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span><span class="p">,</span> <span class="n">row_height</span> <span class="o">+</span> <span class="n">line_gap</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span>
            <span class="n">icon</span><span class="o">=</span><span class="n">icon</span><span class="p">,</span>
            <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
            <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weatherfont</span>
        <span class="p">)</span>

        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;temp_fc</span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">col_width</span><span class="p">,</span> <span class="n">row_height</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="n">temp</span>
        <span class="p">)</span>

    <span class="n">border_h</span> <span class="o">=</span> <span class="n">row3</span> <span class="o">+</span> <span class="n">row_height</span>
    <span class="n">border_w</span> <span class="o">=</span> <span class="n">col_width</span> <span class="o">-</span> <span class="mi">3</span>  <span class="c1"># leave 3 pixels gap</span>

    <span class="c1"># Add borders around each subsection</span>
    <span class="n">draw_border</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">row1</span><span class="p">),</span> <span class="p">(</span><span class="n">col_width</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">border_h</span><span class="p">),</span>
                <span class="n">shrinkage</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
        <span class="n">draw_border</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;col</span><span class="si">{</span><span class="n">_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span> <span class="n">row1</span><span class="p">),</span> <span class="p">(</span><span class="n">border_w</span><span class="p">,</span> <span class="n">border_h</span><span class="p">),</span>
                    <span class="n">shrinkage</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="c1"># return the images ready for the display</span>
    <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="feeds">Feeds<a class="headerlink" href="#feeds" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.modules.inkycal_feeds"></a>
    <div class="doc doc-contents first">

        <p>Feeds module for InkyCal Project
Copyright by aceinnolab</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.modules.inkycal_feeds.Feeds" class="doc doc-heading">
            <code>Feeds</code>


<a href="#inkycal.modules.inkycal_feeds.Feeds" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="inkycal.modules.template.InkycalModule">InkycalModule</span></code></p>



        <p>RSS class
parses rss/atom feeds from given urls</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/modules/inkycal_feeds.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Feeds</span><span class="p">(</span><span class="n">InkycalModule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;RSS class</span>
<span class="sd">    parses rss/atom feeds from given urls</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;RSS / Atom - Display feeds from given RSS/ATOM feeds&quot;</span>

    <span class="n">requires</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;feed_urls&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Please enter ATOM or RSS feed URL/s, separated by a comma&quot;</span><span class="p">,</span>
        <span class="p">},</span>

    <span class="p">}</span>

    <span class="n">optional</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s2">&quot;shuffle_feeds&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Should the parsed RSS feeds be shuffled? (default=True)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>

    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_feeds module&quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

        <span class="c1"># Check if all required parameters are present</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;config is missing </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># required parameters</span>
        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;feed_urls&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;feed_urls&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feed_urls</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;feed_urls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feed_urls</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;feed_urls&quot;</span><span class="p">]</span>

        <span class="c1"># optional parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_feeds</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;shuffle_feeds&quot;</span><span class="p">]</span>

        <span class="c1"># give an OK message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate module-specific parameters&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shuffle_feeds</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;shuffle_feeds has to be a boolean: True/False&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

        <span class="c1"># Define new image size with respect to padding</span>
        <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
        <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
        <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="c1"># Check if internet is available</span>
        <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Network not reachable. Please check your connection.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">NetworkNotReachableError</span>

        <span class="c1"># Set some parameters for formatting feeds</span>
        <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">line_width</span> <span class="o">=</span> <span class="n">im_width</span>
        <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>
        <span class="n">max_lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">im_height</span> <span class="o">//</span> <span class="p">(</span><span class="n">line_height</span> <span class="o">+</span> <span class="n">line_spacing</span><span class="p">))</span>

        <span class="c1"># Calculate padding from top so the lines look centralised</span>
        <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Calculate line_positions</span>
        <span class="n">line_positions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing_top</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

        <span class="c1"># Create list containing all feeds from all urls</span>
        <span class="n">parsed_feeds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">feeds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed_urls</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">feeds</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">posts</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;summary&quot;</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">:</span>
                    <span class="n">summary</span> <span class="o">=</span> <span class="n">posts</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">]</span>
                    <span class="n">parsed_feeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;â€¢</span><span class="si">{</span><span class="n">posts</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&lt;[^&lt;]+?&gt;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">posts</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># if &quot;description&quot; in posts:</span>

        <span class="k">if</span> <span class="n">parsed_feeds</span><span class="p">:</span>
            <span class="n">parsed_feeds</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">parsed_feeds</span><span class="p">]</span>
            <span class="n">parsed_feeds</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">parsed_feeds</span> <span class="k">if</span> <span class="n">i</span><span class="p">]</span>

        <span class="c1"># Shuffle the list to prevent showing the same content</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_feeds</span><span class="p">:</span>
            <span class="n">shuffle</span><span class="p">(</span><span class="n">parsed_feeds</span><span class="p">)</span>

        <span class="c1"># Trim down the list to the max number of lines</span>
        <span class="k">del</span> <span class="n">parsed_feeds</span><span class="p">[</span><span class="n">max_lines</span><span class="p">:]</span>

        <span class="c1"># Wrap long text from feeds (line-breaking)</span>
        <span class="n">flatten</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">z</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
        <span class="n">filtered_feeds</span><span class="p">,</span> <span class="n">counter</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">posts</span> <span class="ow">in</span> <span class="n">parsed_feeds</span><span class="p">:</span>
            <span class="n">wrapped</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">text_wrap</span><span class="p">(</span><span class="n">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">max_width</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wrapped</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="n">max_lines</span><span class="p">:</span>
                <span class="n">filtered_feeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wrapped</span><span class="p">)</span>
        <span class="n">filtered_feeds</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">filtered_feeds</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;filtered feeds -&gt; </span><span class="si">{</span><span class="n">filtered_feeds</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Check if feeds could be parsed and can be displayed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_feeds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">parsed_feeds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Feeds could be parsed, but the text is too long to be displayed:/&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_feeds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">parsed_feeds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No feeds could be parsed :/&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Write feeds on image</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_feeds</span><span class="p">)):</span>
                <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
                    <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">filtered_feeds</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
                    <span class="n">alignment</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
                <span class="p">)</span>
        <span class="c1"># return images</span>
        <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_feeds.Feeds.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#inkycal.modules.inkycal_feeds.Feeds.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize inkycal_feeds module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_feeds.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_feeds module&quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

    <span class="c1"># Check if all required parameters are present</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;config is missing </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># required parameters</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;feed_urls&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;feed_urls&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed_urls</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;feed_urls&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feed_urls</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;feed_urls&quot;</span><span class="p">]</span>

    <span class="c1"># optional parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_feeds</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;shuffle_feeds&quot;</span><span class="p">]</span>

    <span class="c1"># give an OK message</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_feeds.Feeds.generate_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate_image</span><span class="p">()</span></code>

<a href="#inkycal.modules.inkycal_feeds.Feeds.generate_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate image for this module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_feeds.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

    <span class="c1"># Define new image size with respect to padding</span>
    <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
    <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Check if internet is available</span>
    <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Network not reachable. Please check your connection.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">NetworkNotReachableError</span>

    <span class="c1"># Set some parameters for formatting feeds</span>
    <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">line_width</span> <span class="o">=</span> <span class="n">im_width</span>
    <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>
    <span class="n">max_lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">im_height</span> <span class="o">//</span> <span class="p">(</span><span class="n">line_height</span> <span class="o">+</span> <span class="n">line_spacing</span><span class="p">))</span>

    <span class="c1"># Calculate padding from top so the lines look centralised</span>
    <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Calculate line_positions</span>
    <span class="n">line_positions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing_top</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

    <span class="c1"># Create list containing all feeds from all urls</span>
    <span class="n">parsed_feeds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">feeds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feed_urls</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">feedparser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">feeds</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">posts</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;summary&quot;</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">:</span>
                <span class="n">summary</span> <span class="o">=</span> <span class="n">posts</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">]</span>
                <span class="n">parsed_feeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;â€¢</span><span class="si">{</span><span class="n">posts</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&lt;[^&lt;]+?&gt;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">posts</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># if &quot;description&quot; in posts:</span>

    <span class="k">if</span> <span class="n">parsed_feeds</span><span class="p">:</span>
        <span class="n">parsed_feeds</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">parsed_feeds</span><span class="p">]</span>
        <span class="n">parsed_feeds</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">parsed_feeds</span> <span class="k">if</span> <span class="n">i</span><span class="p">]</span>

    <span class="c1"># Shuffle the list to prevent showing the same content</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shuffle_feeds</span><span class="p">:</span>
        <span class="n">shuffle</span><span class="p">(</span><span class="n">parsed_feeds</span><span class="p">)</span>

    <span class="c1"># Trim down the list to the max number of lines</span>
    <span class="k">del</span> <span class="n">parsed_feeds</span><span class="p">[</span><span class="n">max_lines</span><span class="p">:]</span>

    <span class="c1"># Wrap long text from feeds (line-breaking)</span>
    <span class="n">flatten</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">z</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">z</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">y</span><span class="p">]</span>
    <span class="n">filtered_feeds</span><span class="p">,</span> <span class="n">counter</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">posts</span> <span class="ow">in</span> <span class="n">parsed_feeds</span><span class="p">:</span>
        <span class="n">wrapped</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">text_wrap</span><span class="p">(</span><span class="n">posts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">max_width</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wrapped</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">counter</span> <span class="o">&lt;</span> <span class="n">max_lines</span><span class="p">:</span>
            <span class="n">filtered_feeds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wrapped</span><span class="p">)</span>
    <span class="n">filtered_feeds</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">filtered_feeds</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;filtered feeds -&gt; </span><span class="si">{</span><span class="n">filtered_feeds</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Check if feeds could be parsed and can be displayed</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_feeds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">parsed_feeds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Feeds could be parsed, but the text is too long to be displayed:/&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_feeds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">parsed_feeds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No feeds could be parsed :/&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Write feeds on image</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_feeds</span><span class="p">)):</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">filtered_feeds</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
                <span class="n">alignment</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
            <span class="p">)</span>
    <span class="c1"># return images</span>
    <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="stocks">Stocks<a class="headerlink" href="#stocks" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.modules.inkycal_stocks"></a>
    <div class="doc doc-contents first">

        <p>Stocks Module for Inkycal Project</p>
<p>Version 0.6: Dropped matplotlib dependency in favour of render_line_chart function
Version 0.5: Added improved precision by using new priceHint parameter of yfinance
Version 0.4: Added charts
Version 0.3: Added support for web-UI of Inkycal 2.0.0
Version 0.2: Migration to Inkycal 2.0.0
Version 0.1: Migration to Inkycal 2.0.0b</p>
<p>by https://github.com/worstface</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.modules.inkycal_stocks.Stocks" class="doc doc-heading">
            <code>Stocks</code>


<a href="#inkycal.modules.inkycal_stocks.Stocks" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="inkycal.modules.template.InkycalModule">InkycalModule</span></code></p>










              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/modules/inkycal_stocks.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Stocks</span><span class="p">(</span><span class="n">InkycalModule</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Stocks - Displays stock market infos from Yahoo finance&quot;</span>

    <span class="c1"># required parameters</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s2">&quot;tickers&quot;</span><span class="p">:</span> <span class="p">{</span>

            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;You can display any information by using &quot;</span>
                     <span class="s2">&quot;the respective symbols that are used by Yahoo! Finance. &quot;</span>
                     <span class="s2">&quot;Separate multiple symbols with a comma sign e.g. &quot;</span>
                     <span class="s2">&quot;TSLA, U, NVDA, EURUSD=X&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

        <span class="c1"># If tickers is a string from web-ui, convert to a list, else use</span>
        <span class="c1"># tickers as-is i.e. for tests</span>
        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;tickers&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;tickers&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tickers</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;tickers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>  <span class="c1"># returns list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tickers</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;tickers&#39;</span><span class="p">]</span>

        <span class="c1"># give an OK message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

        <span class="c1"># Define new image size with respect to padding</span>
        <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
        <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
        <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;image size: </span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">im_height</span><span class="si">}</span><span class="s1"> px&#39;</span><span class="p">)</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="c1"># Create tmp path</span>
        <span class="n">tmpPath</span> <span class="o">=</span> <span class="s1">&#39;temp/&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmpPath</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating tmp directory </span><span class="si">{</span><span class="n">tmpPath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">tmpPath</span><span class="p">)</span>

        <span class="c1"># Check if internet is available</span>
        <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Network could not be reached :/&#39;</span><span class="p">)</span>

        <span class="c1"># Set some parameters for formatting feeds</span>
        <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span>
        <span class="n">line_width</span> <span class="o">=</span> <span class="n">im_width</span>
        <span class="n">max_lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">im_height</span> <span class="o">//</span> <span class="p">(</span><span class="n">line_height</span> <span class="o">+</span> <span class="n">line_spacing</span><span class="p">))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max_lines: </span><span class="si">{</span><span class="n">max_lines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate padding from top so the lines look centralised</span>
        <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Calculate line_positions</span>
        <span class="n">line_positions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing_top</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;line positions: </span><span class="si">{</span><span class="n">line_positions</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">parsed_tickers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">parsed_tickers_colour</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">chartSpace</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">),</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
        <span class="n">chartSpace_colour</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">),</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>

        <span class="n">tickerCount</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tickers</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tickerCount</span><span class="p">:</span>
            <span class="n">ticker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickers</span><span class="p">[</span><span class="n">_</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;preparing data for </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>

            <span class="n">yfTicker</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">Ticker</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">stockInfo</span> <span class="o">=</span> <span class="n">yfTicker</span><span class="o">.</span><span class="n">info</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exceptionMessage</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get &#39;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">&#39; ticker info: </span><span class="si">{</span><span class="n">exceptionMessage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">stockName</span> <span class="o">=</span> <span class="n">stockInfo</span><span class="p">[</span><span class="s1">&#39;shortName&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">stockName</span> <span class="o">=</span> <span class="n">ticker</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get &#39;</span><span class="si">{</span><span class="n">stockName</span><span class="si">}</span><span class="s2">&#39; ticker name! Using &quot;</span>
                               <span class="s2">&quot;the ticker symbol as name instead.&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">stockCurrency</span> <span class="o">=</span> <span class="n">stockInfo</span><span class="p">[</span><span class="s1">&#39;currency&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">stockCurrency</span> <span class="o">==</span> <span class="s1">&#39;USD&#39;</span><span class="p">:</span>
                    <span class="n">stockCurrency</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span>
                <span class="k">elif</span> <span class="n">stockCurrency</span> <span class="o">==</span> <span class="s1">&#39;EUR&#39;</span><span class="p">:</span>
                    <span class="n">stockCurrency</span> <span class="o">=</span> <span class="s1">&#39;â‚¬&#39;</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">stockCurrency</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get ticker currency!&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">precision</span> <span class="o">=</span> <span class="n">stockInfo</span><span class="p">[</span><span class="s1">&#39;priceHint&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">precision</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get &#39;</span><span class="si">{</span><span class="n">stockName</span><span class="si">}</span><span class="s2">&#39; ticker price hint! Using &quot;</span>
                               <span class="s2">&quot;default precision of 2 instead.&quot;</span><span class="p">)</span>

            <span class="n">stockHistory</span> <span class="o">=</span> <span class="n">yfTicker</span><span class="o">.</span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;1mo&quot;</span><span class="p">)</span>
            <span class="n">stockHistoryLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stockHistory</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;fetched </span><span class="si">{</span><span class="n">stockHistoryLen</span><span class="si">}</span><span class="s1"> datapoints ...&#39;</span><span class="p">)</span>
            <span class="n">previousQuote</span> <span class="o">=</span> <span class="p">(</span><span class="n">stockHistory</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">currentQuote</span> <span class="o">=</span> <span class="p">(</span><span class="n">stockHistory</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">currentHigh</span> <span class="o">=</span> <span class="p">(</span><span class="n">stockHistory</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;High&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">currentLow</span> <span class="o">=</span> <span class="p">(</span><span class="n">stockHistory</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;Low&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">currentOpen</span> <span class="o">=</span> <span class="p">(</span><span class="n">stockHistory</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;Open&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">currentGain</span> <span class="o">=</span> <span class="n">currentQuote</span> <span class="o">-</span> <span class="n">previousQuote</span>
            <span class="n">currentGainPercentage</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">currentQuote</span> <span class="o">/</span> <span class="n">previousQuote</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">100</span>
            <span class="n">firstQuote</span> <span class="o">=</span> <span class="n">stockHistory</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">stockHistoryLen</span><span class="p">)[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;firstQuote </span><span class="si">{</span><span class="n">firstQuote</span><span class="si">}</span><span class="s1"> ...&#39;</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%0.*f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">percentageStr</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
                <span class="k">return</span> <span class="s1">&#39;(</span><span class="si">{:+.2f}</span><span class="s1">%)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">gainStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
                <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%+.*f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

            <span class="n">stockNameLine</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stockName</span><span class="p">,</span> <span class="n">stockCurrency</span><span class="p">)</span>
            <span class="n">stockCurrentValueLine</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">currentQuote</span><span class="p">),</span> <span class="n">gainStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">currentGain</span><span class="p">),</span>
                <span class="n">percentageStr</span><span class="p">(</span><span class="n">currentGainPercentage</span><span class="p">))</span>
            <span class="n">stockDayValueLine</span> <span class="o">=</span> <span class="s1">&#39;1d OHL: </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">currentOpen</span><span class="p">),</span> <span class="n">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">currentHigh</span><span class="p">),</span> <span class="n">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">currentLow</span><span class="p">))</span>
            <span class="n">maxQuote</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">stockHistory</span><span class="o">.</span><span class="n">High</span><span class="p">)</span>
            <span class="n">minQuote</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">stockHistory</span><span class="o">.</span><span class="n">Low</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;high </span><span class="si">{</span><span class="n">maxQuote</span><span class="si">}</span><span class="s1"> low </span><span class="si">{</span><span class="n">minQuote</span><span class="si">}</span><span class="s1"> ...&#39;</span><span class="p">)</span>
            <span class="n">stockMonthValueLine</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">d OHL: </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">stockHistoryLen</span><span class="p">,</span> <span class="n">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">firstQuote</span><span class="p">),</span> <span class="n">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">maxQuote</span><span class="p">),</span>
                <span class="n">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">minQuote</span><span class="p">))</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">stockNameLine</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">stockCurrentValueLine</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">stockDayValueLine</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">stockMonthValueLine</span><span class="p">)</span>
            <span class="n">parsed_tickers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stockNameLine</span><span class="p">)</span>
            <span class="n">parsed_tickers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stockCurrentValueLine</span><span class="p">)</span>
            <span class="n">parsed_tickers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stockDayValueLine</span><span class="p">)</span>
            <span class="n">parsed_tickers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stockMonthValueLine</span><span class="p">)</span>

            <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">currentGain</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stockCurrentValueLine</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">currentOpen</span> <span class="o">&gt;</span> <span class="n">currentQuote</span><span class="p">:</span>
                <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stockDayValueLine</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">firstQuote</span> <span class="o">&gt;</span> <span class="n">currentQuote</span><span class="p">:</span>
                <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stockMonthValueLine</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">_</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tickerCount</span><span class="p">):</span>
                <span class="n">parsed_tickers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;creating chart data...&#39;</span><span class="p">)</span>
            <span class="n">chartData</span> <span class="o">=</span> <span class="n">stockHistory</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">chartCloseData</span> <span class="o">=</span> <span class="n">chartData</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Close&#39;</span><span class="p">]</span>
            <span class="n">chartTimeData</span> <span class="o">=</span> <span class="n">chartData</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Date&#39;</span><span class="p">]</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;creating chart plot with Pillow...&#39;</span><span class="p">)</span>
            <span class="c1"># We only need the Close series; time axis is implicit (index)</span>
            <span class="n">close_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chartCloseData</span><span class="p">)</span>

            <span class="c1"># Decide chart size â€” similar to your thumbnail size</span>
            <span class="n">chart_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_width</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
            <span class="n">chart_h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_height</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>

            <span class="n">chartImage</span> <span class="o">=</span> <span class="n">render_line_chart</span><span class="p">(</span>
                <span class="n">values</span><span class="o">=</span><span class="n">close_values</span><span class="p">,</span>
                <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">chart_w</span><span class="p">,</span> <span class="n">chart_h</span><span class="p">),</span>
                <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                <span class="n">bg_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
                <span class="n">padding</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;chartSpace is...</span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">im_height</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">chartPasteX</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">-</span> <span class="n">chartImage</span><span class="o">.</span><span class="n">width</span>
            <span class="n">chartPasteY</span> <span class="o">=</span> <span class="n">line_height</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">_</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pasting chart image with index </span><span class="si">{</span><span class="n">_</span><span class="si">}</span><span class="s1"> to...</span><span class="si">{</span><span class="n">chartPasteX</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">chartPasteY</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">firstQuote</span> <span class="o">&gt;</span> <span class="n">currentQuote</span><span class="p">:</span>
                <span class="n">chartSpace_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">chartImage</span><span class="p">,</span> <span class="p">(</span><span class="n">chartPasteX</span><span class="p">,</span> <span class="n">chartPasteY</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">chartSpace</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">chartImage</span><span class="p">,</span> <span class="p">(</span><span class="n">chartPasteX</span><span class="p">,</span> <span class="n">chartPasteY</span><span class="p">))</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">chartSpace</span><span class="p">)</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">chartSpace_colour</span><span class="p">)</span>

        <span class="c1"># Write/Draw something on the black image</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parsed_tickers</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">_</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">max_lines</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Ran out of lines for parsed_ticker_colour&#39;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
                <span class="n">box_size</span><span class="o">=</span> <span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">parsed_tickers</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
            <span class="p">)</span>

        <span class="c1"># Write/Draw something on the colour image</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parsed_tickers_colour</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">_</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">max_lines</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Ran out of lines for parsed_tickers_colour&#39;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
                <span class="n">box_size</span><span class="o">=</span> <span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">parsed_tickers</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
            <span class="p">)</span>

        <span class="c1"># Save image of black and colour channel in image-folder</span>
        <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_stocks.Stocks.generate_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate_image</span><span class="p">()</span></code>

<a href="#inkycal.modules.inkycal_stocks.Stocks.generate_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate image for this module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_stocks.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

    <span class="c1"># Define new image size with respect to padding</span>
    <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
    <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;image size: </span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">im_height</span><span class="si">}</span><span class="s1"> px&#39;</span><span class="p">)</span>

    <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Create tmp path</span>
    <span class="n">tmpPath</span> <span class="o">=</span> <span class="s1">&#39;temp/&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmpPath</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating tmp directory </span><span class="si">{</span><span class="n">tmpPath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">tmpPath</span><span class="p">)</span>

    <span class="c1"># Check if internet is available</span>
    <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Network could not be reached :/&#39;</span><span class="p">)</span>

    <span class="c1"># Set some parameters for formatting feeds</span>
    <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span>
    <span class="n">line_width</span> <span class="o">=</span> <span class="n">im_width</span>
    <span class="n">max_lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">im_height</span> <span class="o">//</span> <span class="p">(</span><span class="n">line_height</span> <span class="o">+</span> <span class="n">line_spacing</span><span class="p">))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max_lines: </span><span class="si">{</span><span class="n">max_lines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate padding from top so the lines look centralised</span>
    <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Calculate line_positions</span>
    <span class="n">line_positions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing_top</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;line positions: </span><span class="si">{</span><span class="n">line_positions</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">parsed_tickers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">parsed_tickers_colour</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">chartSpace</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">),</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="n">chartSpace_colour</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">),</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>

    <span class="n">tickerCount</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tickers</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tickerCount</span><span class="p">:</span>
        <span class="n">ticker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tickers</span><span class="p">[</span><span class="n">_</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;preparing data for </span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>

        <span class="n">yfTicker</span> <span class="o">=</span> <span class="n">yf</span><span class="o">.</span><span class="n">Ticker</span><span class="p">(</span><span class="n">ticker</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">stockInfo</span> <span class="o">=</span> <span class="n">yfTicker</span><span class="o">.</span><span class="n">info</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exceptionMessage</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get &#39;</span><span class="si">{</span><span class="n">ticker</span><span class="si">}</span><span class="s2">&#39; ticker info: </span><span class="si">{</span><span class="n">exceptionMessage</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">stockName</span> <span class="o">=</span> <span class="n">stockInfo</span><span class="p">[</span><span class="s1">&#39;shortName&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">stockName</span> <span class="o">=</span> <span class="n">ticker</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get &#39;</span><span class="si">{</span><span class="n">stockName</span><span class="si">}</span><span class="s2">&#39; ticker name! Using &quot;</span>
                           <span class="s2">&quot;the ticker symbol as name instead.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">stockCurrency</span> <span class="o">=</span> <span class="n">stockInfo</span><span class="p">[</span><span class="s1">&#39;currency&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">stockCurrency</span> <span class="o">==</span> <span class="s1">&#39;USD&#39;</span><span class="p">:</span>
                <span class="n">stockCurrency</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span>
            <span class="k">elif</span> <span class="n">stockCurrency</span> <span class="o">==</span> <span class="s1">&#39;EUR&#39;</span><span class="p">:</span>
                <span class="n">stockCurrency</span> <span class="o">=</span> <span class="s1">&#39;â‚¬&#39;</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">stockCurrency</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get ticker currency!&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="n">stockInfo</span><span class="p">[</span><span class="s1">&#39;priceHint&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get &#39;</span><span class="si">{</span><span class="n">stockName</span><span class="si">}</span><span class="s2">&#39; ticker price hint! Using &quot;</span>
                           <span class="s2">&quot;default precision of 2 instead.&quot;</span><span class="p">)</span>

        <span class="n">stockHistory</span> <span class="o">=</span> <span class="n">yfTicker</span><span class="o">.</span><span class="n">history</span><span class="p">(</span><span class="s2">&quot;1mo&quot;</span><span class="p">)</span>
        <span class="n">stockHistoryLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stockHistory</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;fetched </span><span class="si">{</span><span class="n">stockHistoryLen</span><span class="si">}</span><span class="s1"> datapoints ...&#39;</span><span class="p">)</span>
        <span class="n">previousQuote</span> <span class="o">=</span> <span class="p">(</span><span class="n">stockHistory</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">currentQuote</span> <span class="o">=</span> <span class="p">(</span><span class="n">stockHistory</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">currentHigh</span> <span class="o">=</span> <span class="p">(</span><span class="n">stockHistory</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;High&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">currentLow</span> <span class="o">=</span> <span class="p">(</span><span class="n">stockHistory</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;Low&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">currentOpen</span> <span class="o">=</span> <span class="p">(</span><span class="n">stockHistory</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;Open&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">currentGain</span> <span class="o">=</span> <span class="n">currentQuote</span> <span class="o">-</span> <span class="n">previousQuote</span>
        <span class="n">currentGainPercentage</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">currentQuote</span> <span class="o">/</span> <span class="n">previousQuote</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">100</span>
        <span class="n">firstQuote</span> <span class="o">=</span> <span class="n">stockHistory</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">stockHistoryLen</span><span class="p">)[</span><span class="s1">&#39;Close&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;firstQuote </span><span class="si">{</span><span class="n">firstQuote</span><span class="si">}</span><span class="s1"> ...&#39;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%0.*f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">percentageStr</span><span class="p">(</span><span class="n">number</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;(</span><span class="si">{:+.2f}</span><span class="s1">%)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">gainStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%+.*f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

        <span class="n">stockNameLine</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stockName</span><span class="p">,</span> <span class="n">stockCurrency</span><span class="p">)</span>
        <span class="n">stockCurrentValueLine</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">currentQuote</span><span class="p">),</span> <span class="n">gainStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">currentGain</span><span class="p">),</span>
            <span class="n">percentageStr</span><span class="p">(</span><span class="n">currentGainPercentage</span><span class="p">))</span>
        <span class="n">stockDayValueLine</span> <span class="o">=</span> <span class="s1">&#39;1d OHL: </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">currentOpen</span><span class="p">),</span> <span class="n">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">currentHigh</span><span class="p">),</span> <span class="n">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">currentLow</span><span class="p">))</span>
        <span class="n">maxQuote</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">stockHistory</span><span class="o">.</span><span class="n">High</span><span class="p">)</span>
        <span class="n">minQuote</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">stockHistory</span><span class="o">.</span><span class="n">Low</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;high </span><span class="si">{</span><span class="n">maxQuote</span><span class="si">}</span><span class="s1"> low </span><span class="si">{</span><span class="n">minQuote</span><span class="si">}</span><span class="s1"> ...&#39;</span><span class="p">)</span>
        <span class="n">stockMonthValueLine</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">d OHL: </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">stockHistoryLen</span><span class="p">,</span> <span class="n">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">firstQuote</span><span class="p">),</span> <span class="n">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">maxQuote</span><span class="p">),</span>
            <span class="n">floatStr</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">minQuote</span><span class="p">))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">stockNameLine</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">stockCurrentValueLine</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">stockDayValueLine</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">stockMonthValueLine</span><span class="p">)</span>
        <span class="n">parsed_tickers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stockNameLine</span><span class="p">)</span>
        <span class="n">parsed_tickers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stockCurrentValueLine</span><span class="p">)</span>
        <span class="n">parsed_tickers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stockDayValueLine</span><span class="p">)</span>
        <span class="n">parsed_tickers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stockMonthValueLine</span><span class="p">)</span>

        <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">currentGain</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stockCurrentValueLine</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">currentOpen</span> <span class="o">&gt;</span> <span class="n">currentQuote</span><span class="p">:</span>
            <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stockDayValueLine</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">firstQuote</span> <span class="o">&gt;</span> <span class="n">currentQuote</span><span class="p">:</span>
            <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stockMonthValueLine</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tickerCount</span><span class="p">):</span>
            <span class="n">parsed_tickers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">parsed_tickers_colour</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;creating chart data...&#39;</span><span class="p">)</span>
        <span class="n">chartData</span> <span class="o">=</span> <span class="n">stockHistory</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">chartCloseData</span> <span class="o">=</span> <span class="n">chartData</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Close&#39;</span><span class="p">]</span>
        <span class="n">chartTimeData</span> <span class="o">=</span> <span class="n">chartData</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Date&#39;</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;creating chart plot with Pillow...&#39;</span><span class="p">)</span>
        <span class="c1"># We only need the Close series; time axis is implicit (index)</span>
        <span class="n">close_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chartCloseData</span><span class="p">)</span>

        <span class="c1"># Decide chart size â€” similar to your thumbnail size</span>
        <span class="n">chart_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_width</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">chart_h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_height</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">chartImage</span> <span class="o">=</span> <span class="n">render_line_chart</span><span class="p">(</span>
            <span class="n">values</span><span class="o">=</span><span class="n">close_values</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">chart_w</span><span class="p">,</span> <span class="n">chart_h</span><span class="p">),</span>
            <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">bg_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;chartSpace is...</span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">im_height</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">chartPasteX</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">-</span> <span class="n">chartImage</span><span class="o">.</span><span class="n">width</span>
        <span class="n">chartPasteY</span> <span class="o">=</span> <span class="n">line_height</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">_</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pasting chart image with index </span><span class="si">{</span><span class="n">_</span><span class="si">}</span><span class="s1"> to...</span><span class="si">{</span><span class="n">chartPasteX</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">chartPasteY</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">firstQuote</span> <span class="o">&gt;</span> <span class="n">currentQuote</span><span class="p">:</span>
            <span class="n">chartSpace_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">chartImage</span><span class="p">,</span> <span class="p">(</span><span class="n">chartPasteX</span><span class="p">,</span> <span class="n">chartPasteY</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">chartSpace</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">chartImage</span><span class="p">,</span> <span class="p">(</span><span class="n">chartPasteX</span><span class="p">,</span> <span class="n">chartPasteY</span><span class="p">))</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">chartSpace</span><span class="p">)</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">chartSpace_colour</span><span class="p">)</span>

    <span class="c1"># Write/Draw something on the black image</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parsed_tickers</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">_</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">max_lines</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Ran out of lines for parsed_ticker_colour&#39;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
            <span class="n">box_size</span><span class="o">=</span> <span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="n">parsed_tickers</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
            <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
        <span class="p">)</span>

    <span class="c1"># Write/Draw something on the colour image</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parsed_tickers_colour</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">_</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">max_lines</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Ran out of lines for parsed_tickers_colour&#39;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
            <span class="n">box_size</span><span class="o">=</span> <span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="n">parsed_tickers</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
            <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
        <span class="p">)</span>

    <span class="c1"># Save image of black and colour channel in image-folder</span>
    <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="image-module">Image Module<a class="headerlink" href="#image-module" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.modules.inkycal_image"></a>
    <div class="doc doc-contents first">

        <p>Inkycal Image Module
Copyright by aceinnolab</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.modules.inkycal_image.Inkyimage" class="doc doc-heading">
            <code>Inkyimage</code>


<a href="#inkycal.modules.inkycal_image.Inkyimage" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="inkycal.modules.template.InkycalModule">InkycalModule</span></code></p>



        <p>Displays an image from URL or local path</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/modules/inkycal_image.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Inkyimage</span><span class="p">(</span><span class="n">InkycalModule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Displays an image from URL or local path&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Inkycal Image - show an image from a URL or local path&quot;</span>

    <span class="n">requires</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Path to a local folder, e.g. /home/pi/Desktop/images. &quot;</span>
            <span class="s2">&quot;Only PNG and JPG/JPEG images are used for the slideshow.&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;palette&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Which palette should be used for converting images?&quot;</span><span class="p">,</span> <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bw&quot;</span><span class="p">,</span> <span class="s2">&quot;bwr&quot;</span><span class="p">,</span> <span class="s2">&quot;bwy&quot;</span><span class="p">]},</span>
    <span class="p">}</span>

    <span class="n">optional</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;autoflip&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Should the image be flipped automatically?&quot;</span><span class="p">,</span> <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]},</span>
        <span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Please select the desired orientation&quot;</span><span class="p">,</span> <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">]},</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize module&quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span>

        <span class="c1"># required parameters</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;config is missing </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># optional parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">palette</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;palette&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoflip</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;autoflip&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;orientation&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dither</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s2">&quot;dither&quot;</span> <span class="ow">in</span> <span class="n">config</span> <span class="ow">and</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;dither&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dither</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># give an OK message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> loaded&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

        <span class="c1"># Define new image size with respect to padding</span>
        <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
        <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
        <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># initialize custom image class</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">Images</span><span class="p">()</span>

        <span class="c1"># use the image at the first index</span>
        <span class="n">im</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># Remove background if present</span>
        <span class="n">im</span><span class="o">.</span><span class="n">remove_alpha</span><span class="p">()</span>

        <span class="c1"># if auto-flip was enabled, flip the image</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoflip</span><span class="p">:</span>
            <span class="n">im</span><span class="o">.</span><span class="n">autoflip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span>

        <span class="c1"># resize the image so it can fit on the epaper</span>
        <span class="n">im</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">im_width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">im_height</span><span class="p">)</span>

        <span class="c1"># convert images according to specified palette</span>
        <span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span> <span class="o">=</span> <span class="n">image_to_palette</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">),</span> <span class="n">palette</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">,</span> <span class="n">dither</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dither</span><span class="p">)</span>

        <span class="c1"># with the images now send, clear the current image</span>
        <span class="n">im</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># return images</span>
        <span class="k">return</span> <span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_image.Inkyimage.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#inkycal.modules.inkycal_image.Inkyimage.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_image.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize module&quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span>

    <span class="c1"># required parameters</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;config is missing </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># optional parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">palette</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;palette&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">autoflip</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;autoflip&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;orientation&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dither</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="s2">&quot;dither&quot;</span> <span class="ow">in</span> <span class="n">config</span> <span class="ow">and</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;dither&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dither</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># give an OK message</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> loaded&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_image.Inkyimage.generate_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate_image</span><span class="p">()</span></code>

<a href="#inkycal.modules.inkycal_image.Inkyimage.generate_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate image for this module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_image.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

    <span class="c1"># Define new image size with respect to padding</span>
    <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
    <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># initialize custom image class</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">Images</span><span class="p">()</span>

    <span class="c1"># use the image at the first index</span>
    <span class="n">im</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="c1"># Remove background if present</span>
    <span class="n">im</span><span class="o">.</span><span class="n">remove_alpha</span><span class="p">()</span>

    <span class="c1"># if auto-flip was enabled, flip the image</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoflip</span><span class="p">:</span>
        <span class="n">im</span><span class="o">.</span><span class="n">autoflip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span>

    <span class="c1"># resize the image so it can fit on the epaper</span>
    <span class="n">im</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">im_width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">im_height</span><span class="p">)</span>

    <span class="c1"># convert images according to specified palette</span>
    <span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span> <span class="o">=</span> <span class="n">image_to_palette</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">),</span> <span class="n">palette</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">,</span> <span class="n">dither</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dither</span><span class="p">)</span>

    <span class="c1"># with the images now send, clear the current image</span>
    <span class="n">im</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># return images</span>
    <span class="k">return</span> <span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="agenda">Agenda<a class="headerlink" href="#agenda" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.modules.inkycal_agenda"></a>
    <div class="doc doc-contents first">

        <p>Inkycal Agenda Module
Copyright by aceinnolab</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.modules.inkycal_agenda.Agenda" class="doc doc-heading">
            <code>Agenda</code>


<a href="#inkycal.modules.inkycal_agenda.Agenda" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="inkycal.modules.template.InkycalModule">InkycalModule</span></code></p>



        <p>Agenda class
Create agenda and show events from given icalendars</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/modules/inkycal_agenda.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Agenda</span><span class="p">(</span><span class="n">InkycalModule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Agenda class</span>
<span class="sd">    Create agenda and show events from given icalendars</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Agenda - Display upcoming events from given iCalendars&quot;</span>

    <span class="n">requires</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;ical_urls&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;iCalendar URL/s, separate multiple ones with a comma&quot;</span><span class="p">,</span>
        <span class="p">},</span>

    <span class="p">}</span>

    <span class="n">optional</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;ical_files&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;iCalendar filepaths, separated with a comma&quot;</span><span class="p">,</span>
        <span class="p">},</span>

        <span class="s2">&quot;date_format&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Use an arrow-supported token for custom date formatting &quot;</span> <span class="o">+</span>
                     <span class="s2">&quot;see https://arrow.readthedocs.io/en/stable/#supported-tokens, e.g. ddd D MMM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;ddd D MMM&quot;</span><span class="p">,</span>
        <span class="p">},</span>

        <span class="s2">&quot;time_format&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Use an arrow-supported token for custom time formatting &quot;</span> <span class="o">+</span>
                     <span class="s2">&quot;see https://arrow.readthedocs.io/en/stable/#supported-tokens, e.g. HH:mm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;HH:mm&quot;</span><span class="p">,</span>
        <span class="p">},</span>

    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_agenda module&quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

        <span class="c1"># Check if all required parameters are present</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;config is missing </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># module specific parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_format</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;date_format&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_format</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;time_format&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span>

        <span class="c1"># Check if ical_files is an empty string</span>
        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">]</span>

        <span class="c1"># Check if ical_files is an empty string</span>
        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">]</span>

        <span class="c1"># Additional config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="n">get_system_tz</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">icon_font</span> <span class="o">=</span> <span class="n">FONTS</span><span class="o">.</span><span class="n">material_icons</span>

        <span class="c1"># give an OK message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

        <span class="c1"># Define new image size with respect to padding</span>
        <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
        <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
        <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="c1"># Calculate the max number of lines that can fit on the image</span>
        <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>
        <span class="n">max_lines</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">//</span> <span class="n">line_height</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;max lines: </span><span class="si">{</span><span class="n">max_lines</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Create timeline for agenda</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">today</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">)</span>

        <span class="c1"># Create a list of dates for the next days</span>
        <span class="n">agenda_events</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;begin&#39;</span><span class="p">:</span> <span class="n">today</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=+</span><span class="n">_</span><span class="p">),</span>
                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">today</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=+</span><span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">date_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

        <span class="c1"># Load icalendar from config</span>
        <span class="n">ical</span> <span class="o">=</span> <span class="n">iCalendar</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span><span class="p">:</span>
            <span class="n">ical</span><span class="o">.</span><span class="n">load_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span><span class="p">:</span>
            <span class="n">ical</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span><span class="p">)</span>

        <span class="c1"># Load events from all icalendar in timerange</span>
        <span class="n">upcoming_events</span> <span class="o">=</span> <span class="n">ical</span><span class="o">.</span><span class="n">get_events</span><span class="p">(</span><span class="n">today</span><span class="p">,</span> <span class="n">agenda_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;begin&#39;</span><span class="p">],</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>

        <span class="c1"># Sort events by beginning time</span>
        <span class="n">ical</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="c1"># parser.show_events()</span>

        <span class="c1"># Set the width for date, time and event titles</span>
        <span class="n">date_strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">date</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">agenda_events</span><span class="p">]</span>
        <span class="n">longest_date</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">date_strings</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>

        <span class="n">date_width</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">longest_date</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;date_width: </span><span class="si">{</span><span class="n">date_width</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Calculate positions for each line</span>
        <span class="n">line_pos</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">))</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;line_pos: </span><span class="si">{</span><span class="n">line_pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Check if any events were filtered</span>
        <span class="k">if</span> <span class="n">upcoming_events</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Managed to parse events from urls&#39;</span><span class="p">)</span>

            <span class="c1"># Find out how much space the event times take</span>
            <span class="n">time_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span>
                <span class="n">events</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">events</span> <span class="ow">in</span> <span class="n">upcoming_events</span><span class="p">])</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;time_width: </span><span class="si">{</span><span class="n">time_width</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Calculate x-pos for time</span>
            <span class="n">x_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">date_width</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x-time: </span><span class="si">{</span><span class="n">x_time</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Find out how much space is left for event titles</span>
            <span class="n">event_width</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">-</span> <span class="n">time_width</span> 
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;width for events: </span><span class="si">{</span><span class="n">event_width</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Calculate x-pos for event titles</span>
            <span class="n">x_event</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">date_width</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">time_width</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x-event: </span><span class="si">{</span><span class="n">x_event</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># Merge list of dates and list of events</span>
            <span class="n">agenda_events</span> <span class="o">+=</span> <span class="n">upcoming_events</span>

            <span class="c1"># Sort the combined list in chronological order of dates</span>
            <span class="n">by_date</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span>
            <span class="n">agenda_events</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">by_date</span><span class="p">)</span>

            <span class="c1"># Delete more entries than can be displayed (max lines)</span>
            <span class="k">del</span> <span class="n">agenda_events</span><span class="p">[</span><span class="n">max_lines</span><span class="p">:]</span>

            <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">agenda_events</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">_</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>

                <span class="c1"># Check if item is a date</span>
                <span class="k">if</span> <span class="s1">&#39;end&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_</span><span class="p">:</span>
                    <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span><span class="p">)</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
                        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

                    <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="n">xy</span><span class="o">=</span><span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">],</span>
                        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">date_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                        <span class="n">text</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                        <span class="n">alignment</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

                    <span class="n">cursor</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Check if item is an event</span>
                <span class="k">if</span> <span class="s1">&#39;end&#39;</span> <span class="ow">in</span> <span class="n">_</span><span class="p">:</span>
                    <span class="n">time</span> <span class="o">=</span> <span class="n">_</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>

                    <span class="c1"># Check if event is all day, if not, add the time</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ical</span><span class="o">.</span><span class="n">all_day</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
                        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_time</span><span class="p">,</span> <span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">time_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                            <span class="n">text</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                            <span class="n">alignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">canvas</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">icon_font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

                        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_time</span><span class="p">,</span> <span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">time_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\ue878</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">alignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>

                    <span class="n">canvas</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
                    <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_event</span><span class="p">,</span> <span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">event_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                        <span class="n">text</span><span class="o">=</span><span class="s1">&#39; â€¢ &#39;</span> <span class="o">+</span> <span class="n">title</span><span class="p">,</span>
                        <span class="n">alignment</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
                    <span class="n">cursor</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># If no events were found, write only dates and lines</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;no events found&#39;</span><span class="p">)</span>

            <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">agenda_events</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">_</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
                <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span><span class="p">)</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
                    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

                <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">xy</span><span class="o">=</span><span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">],</span>
                    <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">date_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                    <span class="n">alignment</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
                <span class="n">cursor</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># return the images ready for the display</span>
        <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_agenda.Agenda.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#inkycal.modules.inkycal_agenda.Agenda.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize inkycal_agenda module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_agenda.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_agenda module&quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

    <span class="c1"># Check if all required parameters are present</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;config is missing </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># module specific parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">date_format</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;date_format&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time_format</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;time_format&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span>

    <span class="c1"># Check if ical_files is an empty string</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_urls&#39;</span><span class="p">]</span>

    <span class="c1"># Check if ical_files is an empty string</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;ical_files&#39;</span><span class="p">]</span>

    <span class="c1"># Additional config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="n">get_system_tz</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">icon_font</span> <span class="o">=</span> <span class="n">FONTS</span><span class="o">.</span><span class="n">material_icons</span>

    <span class="c1"># give an OK message</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_agenda.Agenda.generate_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate_image</span><span class="p">()</span></code>

<a href="#inkycal.modules.inkycal_agenda.Agenda.generate_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate image for this module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_agenda.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

    <span class="c1"># Define new image size with respect to padding</span>
    <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
    <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Calculate the max number of lines that can fit on the image</span>
    <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>
    <span class="n">max_lines</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">//</span> <span class="n">line_height</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;max lines: </span><span class="si">{</span><span class="n">max_lines</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Create timeline for agenda</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">today</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">)</span>

    <span class="c1"># Create a list of dates for the next days</span>
    <span class="n">agenda_events</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;begin&#39;</span><span class="p">:</span> <span class="n">today</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=+</span><span class="n">_</span><span class="p">),</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">today</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=+</span><span class="n">_</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">date_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

    <span class="c1"># Load icalendar from config</span>
    <span class="n">ical</span> <span class="o">=</span> <span class="n">iCalendar</span><span class="p">()</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span><span class="p">:</span>
        <span class="n">ical</span><span class="o">.</span><span class="n">load_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ical_urls</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span><span class="p">:</span>
        <span class="n">ical</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ical_files</span><span class="p">)</span>

    <span class="c1"># Load events from all icalendar in timerange</span>
    <span class="n">upcoming_events</span> <span class="o">=</span> <span class="n">ical</span><span class="o">.</span><span class="n">get_events</span><span class="p">(</span><span class="n">today</span><span class="p">,</span> <span class="n">agenda_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;begin&#39;</span><span class="p">],</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">timezone</span><span class="p">)</span>

    <span class="c1"># Sort events by beginning time</span>
    <span class="n">ical</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="c1"># parser.show_events()</span>

    <span class="c1"># Set the width for date, time and event titles</span>
    <span class="n">date_strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">date</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">date_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span> <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">agenda_events</span><span class="p">]</span>
    <span class="n">longest_date</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">date_strings</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>

    <span class="n">date_width</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">longest_date</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;date_width: </span><span class="si">{</span><span class="n">date_width</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Calculate positions for each line</span>
    <span class="n">line_pos</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">))</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;line_pos: </span><span class="si">{</span><span class="n">line_pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Check if any events were filtered</span>
    <span class="k">if</span> <span class="n">upcoming_events</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Managed to parse events from urls&#39;</span><span class="p">)</span>

        <span class="c1"># Find out how much space the event times take</span>
        <span class="n">time_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span>
            <span class="n">events</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">events</span> <span class="ow">in</span> <span class="n">upcoming_events</span><span class="p">])</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;time_width: </span><span class="si">{</span><span class="n">time_width</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Calculate x-pos for time</span>
        <span class="n">x_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">date_width</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x-time: </span><span class="si">{</span><span class="n">x_time</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Find out how much space is left for event titles</span>
        <span class="n">event_width</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">-</span> <span class="n">time_width</span> 
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;width for events: </span><span class="si">{</span><span class="n">event_width</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Calculate x-pos for event titles</span>
        <span class="n">x_event</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">date_width</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">time_width</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x-event: </span><span class="si">{</span><span class="n">x_event</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Merge list of dates and list of events</span>
        <span class="n">agenda_events</span> <span class="o">+=</span> <span class="n">upcoming_events</span>

        <span class="c1"># Sort the combined list in chronological order of dates</span>
        <span class="n">by_date</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span>
        <span class="n">agenda_events</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">by_date</span><span class="p">)</span>

        <span class="c1"># Delete more entries than can be displayed (max lines)</span>
        <span class="k">del</span> <span class="n">agenda_events</span><span class="p">[</span><span class="n">max_lines</span><span class="p">:]</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">agenda_events</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">_</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>

            <span class="c1"># Check if item is a date</span>
            <span class="k">if</span> <span class="s1">&#39;end&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_</span><span class="p">:</span>
                <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span><span class="p">)</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
                    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

                <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">xy</span><span class="o">=</span><span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">],</span>
                    <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">date_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                    <span class="n">alignment</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

                <span class="n">cursor</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Check if item is an event</span>
            <span class="k">if</span> <span class="s1">&#39;end&#39;</span> <span class="ow">in</span> <span class="n">_</span><span class="p">:</span>
                <span class="n">time</span> <span class="o">=</span> <span class="n">_</span><span class="p">[</span><span class="s1">&#39;begin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_format</span><span class="p">,</span> <span class="n">locale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>

                <span class="c1"># Check if event is all day, if not, add the time</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ical</span><span class="o">.</span><span class="n">all_day</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
                    <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_time</span><span class="p">,</span> <span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">time_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                        <span class="n">text</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                        <span class="n">alignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">canvas</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">icon_font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

                    <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_time</span><span class="p">,</span> <span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">time_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                        <span class="n">text</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\ue878</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">alignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>

                <span class="n">canvas</span><span class="o">.</span><span class="n">set_font</span><span class="p">(</span><span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>
                <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_event</span><span class="p">,</span> <span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">event_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span><span class="s1">&#39; â€¢ &#39;</span> <span class="o">+</span> <span class="n">title</span><span class="p">,</span>
                    <span class="n">alignment</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
                <span class="n">cursor</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># If no events were found, write only dates and lines</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;no events found&#39;</span><span class="p">)</span>

        <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">agenda_events</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">_</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
            <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span><span class="p">)</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="n">line_pos</span><span class="p">[</span><span class="n">cursor</span><span class="p">],</span>
                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">date_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">alignment</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
            <span class="n">cursor</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># return the images ready for the display</span>
    <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="todoist">Todoist<a class="headerlink" href="#todoist" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.modules.inkycal_todoist"></a>
    <div class="doc doc-contents first">

        <p>Inkycal Todoist Module
Copyright by aceinnolab</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.modules.inkycal_todoist.Todoist" class="doc doc-heading">
            <code>Todoist</code>


<a href="#inkycal.modules.inkycal_todoist.Todoist" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="inkycal.modules.template.InkycalModule">InkycalModule</span></code></p>



        <p>Todoist api class
parses todos from the todoist api.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/modules/inkycal_todoist.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Todoist</span><span class="p">(</span><span class="n">InkycalModule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Todoist api class</span>
<span class="sd">    parses todos from the todoist api.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Todoist API - show your todos from todoist&quot;</span>

    <span class="n">requires</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;api_key&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Please enter your Todoist API-key&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="n">optional</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;project_filter&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Show Todos only from following project (separated by a comma). Leave empty to show &quot;</span> <span class="o">+</span>
                     <span class="s2">&quot;todos from all projects&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;show_priority&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Show priority indicators for tasks (P1, P2, P3)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_rss module&quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

        <span class="c1"># Check if all required parameters are present</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;config is missing </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># module specific parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">]</span>

        <span class="c1"># if project filter is set, initialize it</span>
        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;project_filter&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;project_filter&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project_filter</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;project_filter&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project_filter</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;project_filter&#39;</span><span class="p">]</span>

        <span class="c1"># Priority display option</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_priority</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;show_priority&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_api</span> <span class="o">=</span> <span class="n">TodoistAPI</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">])</span>

        <span class="c1"># Cache file path for storing last successful response</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;todoist_cache.json&#39;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_file</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># give an OK message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate module-specific parameters&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;api_key has to be a string: &quot;Yourtopsecretkey123&quot; &#39;</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">_fetch_with_retry</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">fetch_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T</span><span class="p">]],</span>
            <span class="o">*</span><span class="p">,</span>
            <span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
            <span class="n">retry_statuses</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">},</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch data with retry logic and exponential backoff.</span>

<span class="sd">        Retries on:</span>
<span class="sd">        - Connection errors</span>
<span class="sd">        - HTTP errors with retryable status codes</span>

<span class="sd">        Args:</span>
<span class="sd">            fetch_func: Callable returning an iterable of results.</span>
<span class="sd">            max_retries: Maximum number of attempts.</span>
<span class="sd">            retry_statuses: HTTP status codes that should trigger a retry.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of fetched items.</span>

<span class="sd">        Raises:</span>
<span class="sd">            requests.exceptions.RequestException</span>
<span class="sd">            RuntimeError: If all retries are exhausted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_retries</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">fetch_func</span><span class="p">())</span>

            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="n">exc</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="k">if</span> <span class="n">exc</span><span class="o">.</span><span class="n">response</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">retry_statuses</span> <span class="ow">or</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_retries</span><span class="p">:</span>
                    <span class="k">raise</span>

            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="n">max_retries</span><span class="p">:</span>
                    <span class="k">raise</span>

            <span class="n">delay</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">attempt</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;API request failed (attempt </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">), retrying in </span><span class="si">%d</span><span class="s2">s...&quot;</span><span class="p">,</span>
                <span class="n">attempt</span><span class="p">,</span>
                <span class="n">max_retries</span><span class="p">,</span>
                <span class="n">delay</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Max retries exceeded&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">projects</span><span class="p">,</span> <span class="n">tasks</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save API response to cache file&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cache_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="s1">&#39;projects&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">}</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">projects</span><span class="p">],</span>
                <span class="s1">&#39;tasks&#39;</span><span class="p">:</span> <span class="p">[{</span>
                    <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
                    <span class="s1">&#39;project_id&#39;</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">project_id</span><span class="p">,</span>
                    <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">priority</span><span class="p">,</span>
                    <span class="s1">&#39;due&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">due</span><span class="o">.</span><span class="n">date</span><span class="p">)}</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">due</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">}</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">]</span>
            <span class="p">}</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">cache_data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Saved Todoist data to cache&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to save cache: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_load_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load cached API response&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_file</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load cache: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_error_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">im_size</span><span class="p">,</span> <span class="n">error_msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cached_data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an error message image when API fails&quot;&quot;&quot;</span>
        <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span> <span class="o">=</span> <span class="n">im_size</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="c1"># Display error message</span>
        <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>

        <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">error_msg</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Todoist temporarily unavailable&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cached_data</span> <span class="ow">and</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">cached_data</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cached_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;D-MMM-YY HH:mm&#39;</span><span class="p">)</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Showing cached data from:&quot;</span><span class="p">)</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;No cached data available&quot;</span><span class="p">)</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Please check your connection&quot;</span><span class="p">)</span>

        <span class="c1"># Center the messages vertically</span>
        <span class="n">total_height</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span> <span class="o">*</span> <span class="n">line_height</span>
        <span class="n">start_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">im_height</span> <span class="o">-</span> <span class="n">total_height</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">start_y</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span>
            <span class="c1"># First line in red (colour image), rest in black</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">),</span>
                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span>
                <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

        <span class="c1"># Define new image size with respect to padding</span>
        <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
        <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
        <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="c1"># Check if internet is available</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">internet_available</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Network not reachable. Trying to use cached data.&quot;</span><span class="p">)</span>
            <span class="n">cached_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_cache</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cached_data</span><span class="p">:</span>
                <span class="c1"># Process cached data below</span>
                <span class="n">all_projects</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Project&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cached_data</span><span class="p">[</span><span class="s1">&#39;projects&#39;</span><span class="p">]]</span>
                <span class="n">all_active_tasks</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span>
                    <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;project_id&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;project_id&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;due&#39;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Due&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;due&#39;</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]})</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;due&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">})</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cached_data</span><span class="p">[</span><span class="s1">&#39;tasks&#39;</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_error_image</span><span class="p">(</span><span class="n">im_size</span><span class="p">,</span> <span class="s2">&quot;Network error&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>

            <span class="c1"># Try to fetch fresh data from API</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">all_projects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_with_retry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_api</span><span class="o">.</span><span class="n">get_projects</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="p">[]</span>
                <span class="n">all_tasks_api</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_with_retry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_api</span><span class="o">.</span><span class="n">get_tasks</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
                <span class="n">all_active_tasks</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">task_list</span> <span class="ow">in</span> <span class="n">all_tasks_api</span><span class="p">:</span>
                    <span class="n">all_active_tasks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">task_list</span><span class="p">)</span>
                 <span class="c1"># Save to cache on successful fetch</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_save_cache</span><span class="p">(</span><span class="n">all_projects</span><span class="p">,</span> <span class="n">all_active_tasks</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch Todoist data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="c1"># Try to use cached data</span>
                <span class="n">cached_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_cache</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">cached_data</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using cached Todoist data&quot;</span><span class="p">)</span>
                    <span class="n">all_projects</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Project&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cached_data</span><span class="p">[</span><span class="s1">&#39;projects&#39;</span><span class="p">]]</span>
                    <span class="n">all_active_tasks</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span>
                        <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;project_id&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;project_id&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;due&#39;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Due&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;due&#39;</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]})</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;due&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="p">})</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cached_data</span><span class="p">[</span><span class="s1">&#39;tasks&#39;</span><span class="p">]]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># No cached data available, show error</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_error_image</span><span class="p">(</span><span class="n">im_size</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Set some parameters for formatting todos</span>
        <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>
        <span class="n">max_lines</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">//</span> <span class="n">line_height</span>

        <span class="c1"># Calculate padding from top so the lines look centralised</span>
        <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Calculate line_positions</span>
        <span class="n">line_positions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing_top</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

        <span class="c1"># Process the fetched or cached data</span>
        <span class="n">filtered_project_ids_and_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">project</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">project</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">all_projects</span><span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;all_projects: </span><span class="si">{</span><span class="n">all_projects</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Filter entries in all_projects if filter was given</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_filter</span><span class="p">:</span>
            <span class="n">filtered_projects</span> <span class="o">=</span> <span class="p">[</span><span class="n">project</span> <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">all_projects</span> <span class="k">if</span> <span class="n">project</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_filter</span><span class="p">]</span>
            <span class="n">filtered_project_ids_and_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">project</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">project</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">filtered_projects</span><span class="p">}</span>
            <span class="n">filtered_project_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">project</span> <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">filtered_project_ids_and_names</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;filtered projects: </span><span class="si">{</span><span class="n">filtered_projects</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># If filter was activated and no project was found with that name,</span>
            <span class="c1"># raise an exception to avoid showing a blank image</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filtered_projects</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No project found from project filter!&#39;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please double check spellings in project_filter&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No matching project found in filter. Please &#39;</span>
                                <span class="s1">&#39;double check spellings in project_filter or leave&#39;</span>
                                <span class="s1">&#39;empty&#39;</span><span class="p">)</span>
            <span class="c1"># filtered version of all active tasks</span>
            <span class="n">all_active_tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">all_active_tasks</span> <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">project_id</span> <span class="ow">in</span> <span class="n">filtered_project_ids</span><span class="p">]</span>

        <span class="c1"># Simplify the tasks for faster processing</span>
        <span class="n">simplified</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">all_active_tasks</span><span class="p">:</span>
            <span class="c1"># Format priority indicator using circle symbols</span>
            <span class="n">priority_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_priority</span> <span class="ow">and</span> <span class="n">task</span><span class="o">.</span><span class="n">priority</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Todoist uses reversed priority (4 = highest, 1 = lowest)</span>
                <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">priority</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># P1 - filled circle (red)</span>
                    <span class="n">priority_text</span> <span class="o">=</span> <span class="s2">&quot;â— &quot;</span>  <span class="c1"># Filled circle for highest priority</span>
                <span class="k">elif</span> <span class="n">task</span><span class="o">.</span><span class="n">priority</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># P2 - filled circle (black)</span>
                    <span class="n">priority_text</span> <span class="o">=</span> <span class="s2">&quot;â— &quot;</span>  <span class="c1"># Filled circle for high priority</span>
                <span class="k">elif</span> <span class="n">task</span><span class="o">.</span><span class="n">priority</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># P3 - empty circle (black)</span>
                    <span class="n">priority_text</span> <span class="o">=</span> <span class="s2">&quot;â—‹ &quot;</span>  <span class="c1"># Empty circle for medium priority</span>

            <span class="c1"># Check if task is overdue</span>
            <span class="c1"># Parse date in local timezone to ensure correct comparison</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">due_date</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">due</span><span class="o">.</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">due</span>
                    <span class="k">else</span> <span class="kc">None</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Could not parse due date of task </span><span class="si">%r</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">task</span><span class="p">,</span>
                    <span class="n">e</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">today</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">)</span>
            <span class="n">is_overdue</span> <span class="o">=</span> <span class="n">due_date</span> <span class="ow">and</span> <span class="n">due_date</span> <span class="o">&lt;</span> <span class="n">today</span> <span class="k">if</span> <span class="n">due_date</span> <span class="k">else</span> <span class="kc">False</span>

            <span class="c1"># Format due date display</span>
            <span class="k">if</span> <span class="n">due_date</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">due_date</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">today</span><span class="p">:</span>
                    <span class="n">due_display</span> <span class="o">=</span> <span class="s2">&quot;TODAY&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">due_display</span> <span class="o">=</span> <span class="n">due_date</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;D-MMM-YY&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">due_display</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="n">simplified</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
                <span class="s1">&#39;due&#39;</span><span class="p">:</span> <span class="n">due_display</span><span class="p">,</span>
                <span class="s1">&#39;due_date&#39;</span><span class="p">:</span> <span class="n">due_date</span><span class="p">,</span>
                <span class="s1">&#39;is_overdue&#39;</span><span class="p">:</span> <span class="n">is_overdue</span><span class="p">,</span>
                <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">priority</span><span class="p">,</span>
                <span class="s1">&#39;priority_text&#39;</span><span class="p">:</span> <span class="n">priority_text</span><span class="p">,</span>
                <span class="s1">&#39;project&#39;</span><span class="p">:</span> <span class="n">filtered_project_ids_and_names</span><span class="p">[</span><span class="n">task</span><span class="o">.</span><span class="n">project_id</span><span class="p">]</span> <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">project_id</span> <span class="ow">in</span> <span class="n">filtered_project_ids_and_names</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">})</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;simplified: </span><span class="si">{</span><span class="n">simplified</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">project_lengths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">due_lengths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">priority_lengths</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">simplified</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]:</span>
                <span class="n">project_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;due&quot;</span><span class="p">]:</span>
                <span class="n">due_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s1">&#39;due&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;priority_text&quot;</span><span class="p">]:</span>
                <span class="n">priority_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s1">&#39;priority_text&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">))</span>

        <span class="c1"># Get maximum width of project names for selected font</span>
        <span class="n">project_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">project_lengths</span><span class="p">))</span> <span class="k">if</span> <span class="n">project_lengths</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># Get maximum width of project dues for selected font</span>
        <span class="n">due_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">due_lengths</span><span class="p">))</span> <span class="k">if</span> <span class="n">due_lengths</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># Get maximum width of priority indicators</span>
        <span class="n">priority_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">priority_lengths</span><span class="p">))</span> <span class="k">if</span> <span class="n">priority_lengths</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># create a dict with names of filtered groups</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="p">{</span><span class="n">group_name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">filtered_project_ids_and_names</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">simplified</span><span class="p">:</span>
            <span class="n">group_of_current_task</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">group_of_current_task</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
                <span class="n">groups</span><span class="p">[</span><span class="n">group_of_current_task</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

        <span class="c1"># Sort tasks within each project group by due date first, then priority</span>
        <span class="k">for</span> <span class="n">project_name</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
            <span class="n">groups</span><span class="p">[</span><span class="n">project_name</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">task</span><span class="p">:</span> <span class="p">(</span>
                    <span class="n">task</span><span class="p">[</span><span class="s1">&#39;due_date&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Tasks with dates come first</span>
                    <span class="n">task</span><span class="p">[</span><span class="s1">&#39;due_date&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s1">&#39;due_date&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;9999-12-31&#39;</span><span class="p">),</span>  <span class="c1"># Sort by date</span>
                    <span class="o">-</span><span class="n">task</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">]</span>  <span class="c1"># Then by priority (higher priority first)</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;grouped: </span><span class="si">{</span><span class="n">groups</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Add the parsed todos on the image</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">todos</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">todos</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">todo</span> <span class="ow">in</span> <span class="n">todos</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cursor</span> <span class="o">&lt;</span> <span class="n">max_lines</span><span class="p">:</span>
                        <span class="n">line_x</span><span class="p">,</span> <span class="n">line_y</span> <span class="o">=</span> <span class="n">line_positions</span><span class="p">[</span><span class="n">cursor</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">todo</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">]:</span>
                            <span class="c1"># Add todos project name</span>
                            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">cursor</span><span class="p">],</span>
                                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">project_offset</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                                <span class="n">text</span><span class="o">=</span> <span class="n">todo</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">],</span>
                                <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
                                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
                            <span class="p">)</span>

                        <span class="c1"># Add todos due if not empty</span>
                        <span class="k">if</span> <span class="n">todo</span><span class="p">[</span><span class="s1">&#39;due&#39;</span><span class="p">]:</span>
                            <span class="c1"># Show overdue dates in red, normal dates in black</span>
                            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">line_x</span> <span class="o">+</span> <span class="n">project_offset</span><span class="p">,</span> <span class="n">line_y</span><span class="p">),</span>
                                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">due_offset</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                                <span class="n">text</span><span class="o">=</span> <span class="n">todo</span><span class="p">[</span><span class="s1">&#39;due&#39;</span><span class="p">],</span>
                                <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span> <span class="k">if</span> <span class="n">todo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;is_overdue&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
                            <span class="p">)</span>

                        <span class="c1"># Add priority indicator if present</span>
                        <span class="k">if</span> <span class="n">todo</span><span class="p">[</span><span class="s1">&#39;priority_text&#39;</span><span class="p">]:</span>
                            <span class="c1"># P1 (priority 4) in red, P2 and P3 in black</span>
                            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">line_x</span> <span class="o">+</span> <span class="n">project_offset</span> <span class="o">+</span> <span class="n">due_offset</span><span class="p">,</span> <span class="n">line_y</span><span class="p">),</span>
                                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">priority_offset</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                                <span class="n">text</span><span class="o">=</span><span class="n">todo</span><span class="p">[</span><span class="s1">&#39;priority_text&#39;</span><span class="p">],</span>
                                <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span> <span class="k">if</span> <span class="n">todo</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
                                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
                            <span class="p">)</span>
                        <span class="k">if</span> <span class="n">todo</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                            <span class="c1"># Add todos name</span>
                            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">line_x</span> <span class="o">+</span> <span class="n">project_offset</span> <span class="o">+</span> <span class="n">due_offset</span> <span class="o">+</span> <span class="n">priority_offset</span><span class="p">,</span> <span class="n">line_y</span><span class="p">),</span>
                                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">im_width</span> <span class="o">-</span> <span class="n">project_offset</span> <span class="o">-</span> <span class="n">due_offset</span> <span class="o">-</span> <span class="n">priority_offset</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                                <span class="n">text</span><span class="o">=</span><span class="n">todo</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
                            <span class="p">)</span>
                        <span class="n">cursor</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;More todos than available lines&#39;</span><span class="p">)</span>
                        <span class="k">break</span>

        <span class="c1"># return the images ready for the display</span>
        <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_todoist.Todoist.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#inkycal.modules.inkycal_todoist.Todoist.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize inkycal_rss module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_todoist.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_rss module&quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

    <span class="c1"># Check if all required parameters are present</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;config is missing </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># module specific parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">]</span>

    <span class="c1"># if project filter is set, initialize it</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;project_filter&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;project_filter&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_filter</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;project_filter&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_filter</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;project_filter&#39;</span><span class="p">]</span>

    <span class="c1"># Priority display option</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">show_priority</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;show_priority&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_api</span> <span class="o">=</span> <span class="n">TodoistAPI</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">])</span>

    <span class="c1"># Cache file path for storing last successful response</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cache_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;todoist_cache.json&#39;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_file</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># give an OK message</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_todoist.Todoist.generate_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate_image</span><span class="p">()</span></code>

<a href="#inkycal.modules.inkycal_todoist.Todoist.generate_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate image for this module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_todoist.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

    <span class="c1"># Define new image size with respect to padding</span>
    <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
    <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Check if internet is available</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">internet_available</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Network not reachable. Trying to use cached data.&quot;</span><span class="p">)</span>
        <span class="n">cached_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_cache</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cached_data</span><span class="p">:</span>
            <span class="c1"># Process cached data below</span>
            <span class="n">all_projects</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Project&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cached_data</span><span class="p">[</span><span class="s1">&#39;projects&#39;</span><span class="p">]]</span>
            <span class="n">all_active_tasks</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span>
                <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">],</span>
                <span class="s1">&#39;project_id&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;project_id&#39;</span><span class="p">],</span>
                <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">],</span>
                <span class="s1">&#39;due&#39;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Due&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;due&#39;</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]})</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;due&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">})</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cached_data</span><span class="p">[</span><span class="s1">&#39;tasks&#39;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_error_image</span><span class="p">(</span><span class="n">im_size</span><span class="p">,</span> <span class="s2">&quot;Network error&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>

        <span class="c1"># Try to fetch fresh data from API</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">all_projects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_with_retry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_api</span><span class="o">.</span><span class="n">get_projects</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="p">[]</span>
            <span class="n">all_tasks_api</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_with_retry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_api</span><span class="o">.</span><span class="n">get_tasks</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span>
            <span class="n">all_active_tasks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">task_list</span> <span class="ow">in</span> <span class="n">all_tasks_api</span><span class="p">:</span>
                <span class="n">all_active_tasks</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">task_list</span><span class="p">)</span>
             <span class="c1"># Save to cache on successful fetch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_cache</span><span class="p">(</span><span class="n">all_projects</span><span class="p">,</span> <span class="n">all_active_tasks</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch Todoist data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Try to use cached data</span>
            <span class="n">cached_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_cache</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cached_data</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using cached Todoist data&quot;</span><span class="p">)</span>
                <span class="n">all_projects</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Project&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">cached_data</span><span class="p">[</span><span class="s1">&#39;projects&#39;</span><span class="p">]]</span>
                <span class="n">all_active_tasks</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Task&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span>
                    <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;project_id&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;project_id&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;due&#39;</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;Due&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;due&#39;</span><span class="p">][</span><span class="s1">&#39;date&#39;</span><span class="p">]})</span> <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;due&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">})</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cached_data</span><span class="p">[</span><span class="s1">&#39;tasks&#39;</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># No cached data available, show error</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_error_image</span><span class="p">(</span><span class="n">im_size</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Set some parameters for formatting todos</span>
    <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>
    <span class="n">max_lines</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">//</span> <span class="n">line_height</span>

    <span class="c1"># Calculate padding from top so the lines look centralised</span>
    <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Calculate line_positions</span>
    <span class="n">line_positions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing_top</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

    <span class="c1"># Process the fetched or cached data</span>
    <span class="n">filtered_project_ids_and_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">project</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">project</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">all_projects</span><span class="p">}</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;all_projects: </span><span class="si">{</span><span class="n">all_projects</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Filter entries in all_projects if filter was given</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_filter</span><span class="p">:</span>
        <span class="n">filtered_projects</span> <span class="o">=</span> <span class="p">[</span><span class="n">project</span> <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">all_projects</span> <span class="k">if</span> <span class="n">project</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_filter</span><span class="p">]</span>
        <span class="n">filtered_project_ids_and_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">project</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">project</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">filtered_projects</span><span class="p">}</span>
        <span class="n">filtered_project_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">project</span> <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">filtered_project_ids_and_names</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;filtered projects: </span><span class="si">{</span><span class="n">filtered_projects</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If filter was activated and no project was found with that name,</span>
        <span class="c1"># raise an exception to avoid showing a blank image</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filtered_projects</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No project found from project filter!&#39;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Please double check spellings in project_filter&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No matching project found in filter. Please &#39;</span>
                            <span class="s1">&#39;double check spellings in project_filter or leave&#39;</span>
                            <span class="s1">&#39;empty&#39;</span><span class="p">)</span>
        <span class="c1"># filtered version of all active tasks</span>
        <span class="n">all_active_tasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">task</span> <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">all_active_tasks</span> <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">project_id</span> <span class="ow">in</span> <span class="n">filtered_project_ids</span><span class="p">]</span>

    <span class="c1"># Simplify the tasks for faster processing</span>
    <span class="n">simplified</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">all_active_tasks</span><span class="p">:</span>
        <span class="c1"># Format priority indicator using circle symbols</span>
        <span class="n">priority_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_priority</span> <span class="ow">and</span> <span class="n">task</span><span class="o">.</span><span class="n">priority</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Todoist uses reversed priority (4 = highest, 1 = lowest)</span>
            <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">priority</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># P1 - filled circle (red)</span>
                <span class="n">priority_text</span> <span class="o">=</span> <span class="s2">&quot;â— &quot;</span>  <span class="c1"># Filled circle for highest priority</span>
            <span class="k">elif</span> <span class="n">task</span><span class="o">.</span><span class="n">priority</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># P2 - filled circle (black)</span>
                <span class="n">priority_text</span> <span class="o">=</span> <span class="s2">&quot;â— &quot;</span>  <span class="c1"># Filled circle for high priority</span>
            <span class="k">elif</span> <span class="n">task</span><span class="o">.</span><span class="n">priority</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># P3 - empty circle (black)</span>
                <span class="n">priority_text</span> <span class="o">=</span> <span class="s2">&quot;â—‹ &quot;</span>  <span class="c1"># Empty circle for medium priority</span>

        <span class="c1"># Check if task is overdue</span>
        <span class="c1"># Parse date in local timezone to ensure correct comparison</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">due_date</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">due</span><span class="o">.</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">due</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Could not parse due date of task </span><span class="si">%r</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">task</span><span class="p">,</span>
                <span class="n">e</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">today</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="s1">&#39;local&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">)</span>
        <span class="n">is_overdue</span> <span class="o">=</span> <span class="n">due_date</span> <span class="ow">and</span> <span class="n">due_date</span> <span class="o">&lt;</span> <span class="n">today</span> <span class="k">if</span> <span class="n">due_date</span> <span class="k">else</span> <span class="kc">False</span>

        <span class="c1"># Format due date display</span>
        <span class="k">if</span> <span class="n">due_date</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">due_date</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">today</span><span class="p">:</span>
                <span class="n">due_display</span> <span class="o">=</span> <span class="s2">&quot;TODAY&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">due_display</span> <span class="o">=</span> <span class="n">due_date</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;D-MMM-YY&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">due_display</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="n">simplified</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
            <span class="s1">&#39;due&#39;</span><span class="p">:</span> <span class="n">due_display</span><span class="p">,</span>
            <span class="s1">&#39;due_date&#39;</span><span class="p">:</span> <span class="n">due_date</span><span class="p">,</span>
            <span class="s1">&#39;is_overdue&#39;</span><span class="p">:</span> <span class="n">is_overdue</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">priority</span><span class="p">,</span>
            <span class="s1">&#39;priority_text&#39;</span><span class="p">:</span> <span class="n">priority_text</span><span class="p">,</span>
            <span class="s1">&#39;project&#39;</span><span class="p">:</span> <span class="n">filtered_project_ids_and_names</span><span class="p">[</span><span class="n">task</span><span class="o">.</span><span class="n">project_id</span><span class="p">]</span> <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">project_id</span> <span class="ow">in</span> <span class="n">filtered_project_ids_and_names</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">})</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;simplified: </span><span class="si">{</span><span class="n">simplified</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">project_lengths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">due_lengths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">priority_lengths</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">simplified</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]:</span>
            <span class="n">project_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;due&quot;</span><span class="p">]:</span>
            <span class="n">due_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s1">&#39;due&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;priority_text&quot;</span><span class="p">]:</span>
            <span class="n">priority_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s1">&#39;priority_text&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">))</span>

    <span class="c1"># Get maximum width of project names for selected font</span>
    <span class="n">project_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">project_lengths</span><span class="p">))</span> <span class="k">if</span> <span class="n">project_lengths</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="c1"># Get maximum width of project dues for selected font</span>
    <span class="n">due_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">due_lengths</span><span class="p">))</span> <span class="k">if</span> <span class="n">due_lengths</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="c1"># Get maximum width of priority indicators</span>
    <span class="n">priority_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">priority_lengths</span><span class="p">))</span> <span class="k">if</span> <span class="n">priority_lengths</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="c1"># create a dict with names of filtered groups</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="p">{</span><span class="n">group_name</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">group_name</span> <span class="ow">in</span> <span class="n">filtered_project_ids_and_names</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>
    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">simplified</span><span class="p">:</span>
        <span class="n">group_of_current_task</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">group_of_current_task</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
            <span class="n">groups</span><span class="p">[</span><span class="n">group_of_current_task</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

    <span class="c1"># Sort tasks within each project group by due date first, then priority</span>
    <span class="k">for</span> <span class="n">project_name</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
        <span class="n">groups</span><span class="p">[</span><span class="n">project_name</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">task</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">task</span><span class="p">[</span><span class="s1">&#39;due_date&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Tasks with dates come first</span>
                <span class="n">task</span><span class="p">[</span><span class="s1">&#39;due_date&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s1">&#39;due_date&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;9999-12-31&#39;</span><span class="p">),</span>  <span class="c1"># Sort by date</span>
                <span class="o">-</span><span class="n">task</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">]</span>  <span class="c1"># Then by priority (higher priority first)</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;grouped: </span><span class="si">{</span><span class="n">groups</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Add the parsed todos on the image</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">todos</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">todos</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">todo</span> <span class="ow">in</span> <span class="n">todos</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cursor</span> <span class="o">&lt;</span> <span class="n">max_lines</span><span class="p">:</span>
                    <span class="n">line_x</span><span class="p">,</span> <span class="n">line_y</span> <span class="o">=</span> <span class="n">line_positions</span><span class="p">[</span><span class="n">cursor</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">todo</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">]:</span>
                        <span class="c1"># Add todos project name</span>
                        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">cursor</span><span class="p">],</span>
                            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">project_offset</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                            <span class="n">text</span><span class="o">=</span> <span class="n">todo</span><span class="p">[</span><span class="s1">&#39;project&#39;</span><span class="p">],</span>
                            <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span><span class="p">,</span>
                            <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
                        <span class="p">)</span>

                    <span class="c1"># Add todos due if not empty</span>
                    <span class="k">if</span> <span class="n">todo</span><span class="p">[</span><span class="s1">&#39;due&#39;</span><span class="p">]:</span>
                        <span class="c1"># Show overdue dates in red, normal dates in black</span>
                        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">line_x</span> <span class="o">+</span> <span class="n">project_offset</span><span class="p">,</span> <span class="n">line_y</span><span class="p">),</span>
                            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">due_offset</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                            <span class="n">text</span><span class="o">=</span> <span class="n">todo</span><span class="p">[</span><span class="s1">&#39;due&#39;</span><span class="p">],</span>
                            <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span> <span class="k">if</span> <span class="n">todo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;is_overdue&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
                            <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
                        <span class="p">)</span>

                    <span class="c1"># Add priority indicator if present</span>
                    <span class="k">if</span> <span class="n">todo</span><span class="p">[</span><span class="s1">&#39;priority_text&#39;</span><span class="p">]:</span>
                        <span class="c1"># P1 (priority 4) in red, P2 and P3 in black</span>
                        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">line_x</span> <span class="o">+</span> <span class="n">project_offset</span> <span class="o">+</span> <span class="n">due_offset</span><span class="p">,</span> <span class="n">line_y</span><span class="p">),</span>
                            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">priority_offset</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                            <span class="n">text</span><span class="o">=</span><span class="n">todo</span><span class="p">[</span><span class="s1">&#39;priority_text&#39;</span><span class="p">],</span>
                            <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span> <span class="k">if</span> <span class="n">todo</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
                            <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="n">todo</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                        <span class="c1"># Add todos name</span>
                        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">line_x</span> <span class="o">+</span> <span class="n">project_offset</span> <span class="o">+</span> <span class="n">due_offset</span> <span class="o">+</span> <span class="n">priority_offset</span><span class="p">,</span> <span class="n">line_y</span><span class="p">),</span>
                            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">im_width</span> <span class="o">-</span> <span class="n">project_offset</span> <span class="o">-</span> <span class="n">due_offset</span> <span class="o">-</span> <span class="n">priority_offset</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                            <span class="n">text</span><span class="o">=</span><span class="n">todo</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                            <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
                        <span class="p">)</span>
                    <span class="n">cursor</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;More todos than available lines&#39;</span><span class="p">)</span>
                    <span class="k">break</span>

    <span class="c1"># return the images ready for the display</span>
    <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="webshot">Webshot<a class="headerlink" href="#webshot" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.modules.inkycal_webshot"></a>
    <div class="doc doc-contents first">

        <p>Webshot module for Inkycal
by https://github.com/worstface</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.modules.inkycal_webshot.Webshot" class="doc doc-heading">
            <code>Webshot</code>


<a href="#inkycal.modules.inkycal_webshot.Webshot" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="inkycal.modules.template.InkycalModule">InkycalModule</span></code></p>










              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/modules/inkycal_webshot.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Webshot</span><span class="p">(</span><span class="n">InkycalModule</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Webshot - Displays screenshots of webpages&quot;</span>

    <span class="c1"># required parameters</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Please enter the url&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;palette&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Which color palette should be used for the webshots?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bw&quot;</span><span class="p">,</span> <span class="s2">&quot;bwr&quot;</span><span class="p">,</span> <span class="s2">&quot;bwy&quot;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">optional</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s2">&quot;crop_x&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Please enter the crop x-position&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;crop_y&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Please enter the crop y-position&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;crop_w&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Please enter the crop width&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;crop_h&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Please enter the crop height&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;rotation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Please enter the rotation. Must be either 0, 90, 180 or 270&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">palette</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;palette&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;crop_h&quot;</span> <span class="ow">in</span> <span class="n">config</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;crop_h&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crop_h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;crop_h&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crop_h</span> <span class="o">=</span> <span class="mi">2000</span>

        <span class="k">if</span> <span class="s2">&quot;crop_w&quot;</span> <span class="ow">in</span> <span class="n">config</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;crop_w&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crop_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;crop_w&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crop_w</span> <span class="o">=</span> <span class="mi">2000</span>

        <span class="k">if</span> <span class="s2">&quot;crop_x&quot;</span> <span class="ow">in</span> <span class="n">config</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;crop_x&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crop_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;crop_x&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crop_x</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="s2">&quot;crop_y&quot;</span> <span class="ow">in</span> <span class="n">config</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;crop_y&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crop_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;crop_y&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crop_y</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s2">&quot;rotation&quot;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;rotation&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Rotation must be either 0, 90, 180 or 270&quot;</span><span class="p">)</span>

        <span class="c1"># give an OK message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Inkycal webshot loaded&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

        <span class="c1"># Create tmp path</span>
        <span class="n">tmpFolder</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">TEMPORARY_FOLDER</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmpFolder</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating tmp directory </span><span class="si">{</span><span class="n">tmpFolder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">tmpFolder</span><span class="p">)</span>

        <span class="c1"># Define new image size with respect to padding</span>
        <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
        <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">270</span><span class="p">):</span>
            <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span> <span class="o">=</span> <span class="n">im_height</span><span class="p">,</span> <span class="n">im_width</span>
        <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;image size: </span><span class="si">{}</span><span class="s1"> x </span><span class="si">{}</span><span class="s1"> px&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">))</span>

        <span class="c1"># Create an image for black pixels and one for coloured pixels (required)</span>
        <span class="n">im_black</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="n">im_colour</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

        <span class="c1"># Check if internet is available</span>
        <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Network not reachable. Please check your connection.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Network could not be reached :/&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;preparing webshot from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s1">... cropH</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crop_h</span><span class="si">}</span><span class="s1"> cropW</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crop_w</span><span class="si">}</span><span class="s1"> cropX</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crop_x</span><span class="si">}</span><span class="s1"> cropY</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crop_y</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">shot</span> <span class="o">=</span> <span class="n">WebShot</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">im_height</span><span class="p">,</span> <span class="n">im_width</span><span class="p">))</span>

        <span class="n">shot</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;--crop-x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_x</span><span class="p">,</span>
            <span class="s2">&quot;--crop-y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_y</span><span class="p">,</span>
            <span class="s2">&quot;--crop-w&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_w</span><span class="p">,</span>
            <span class="s2">&quot;--crop-h&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_h</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;getting webshot from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">shot</span><span class="o">.</span><span class="n">create_pic</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpFolder</span><span class="si">}</span><span class="s2">/webshot.png&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;If you have not already installed wkhtmltopdf, please use: sudo apt-get install wkhtmltopdf. See here for more details: https://github.com/1Danish-00/htmlwebshot/&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not get webshot :/&#39;</span><span class="p">)</span>


        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;got webshot...&#39;</span><span class="p">)</span>

        <span class="n">webshotSpaceBlack</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
        <span class="n">webshotSpaceColour</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>

        <span class="n">im</span> <span class="o">=</span> <span class="n">Images</span><span class="p">()</span>
        <span class="n">im</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">tmpFolder</span><span class="si">}</span><span class="s1">/webshot.png&#39;</span><span class="p">)</span>
        <span class="n">im</span><span class="o">.</span><span class="n">remove_alpha</span><span class="p">()</span>

        <span class="n">imageAspectRatio</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">/</span> <span class="n">im_height</span>
        <span class="n">webshotAspectRatio</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span>

        <span class="k">if</span> <span class="n">webshotAspectRatio</span> <span class="o">&gt;</span> <span class="n">imageAspectRatio</span><span class="p">:</span>
            <span class="n">imageScale</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">/</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">imageScale</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">/</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span>

        <span class="n">webshotHeight</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">imageScale</span><span class="p">)</span>

        <span class="n">im</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">imageScale</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">webshotHeight</span><span class="p">)</span>

        <span class="n">im_webshot_black</span><span class="p">,</span> <span class="n">im_webshot_colour</span> <span class="o">=</span> <span class="n">image_to_palette</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">)</span>

        <span class="n">webshotCenterPosY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

        <span class="n">centerPosX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">webshotSpaceBlack</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im_webshot_black</span><span class="p">,</span> <span class="p">(</span><span class="n">centerPosX</span><span class="p">,</span> <span class="n">webshotCenterPosY</span><span class="p">))</span>
            <span class="n">im_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">webshotSpaceBlack</span><span class="p">)</span>
            <span class="n">im_black</span> <span class="o">=</span> <span class="n">im_black</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">webshotSpaceColour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im_webshot_colour</span><span class="p">,</span> <span class="p">(</span><span class="n">centerPosX</span><span class="p">,</span> <span class="n">webshotCenterPosY</span><span class="p">))</span>
            <span class="n">im_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">webshotSpaceColour</span><span class="p">)</span>
            <span class="n">im_colour</span> <span class="o">=</span> <span class="n">im_colour</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">webshotSpaceBlack</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im_webshot_black</span><span class="p">,</span> <span class="p">(</span><span class="n">centerPosX</span><span class="p">,</span> <span class="n">webshotCenterPosY</span><span class="p">))</span>
            <span class="n">im_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">webshotSpaceBlack</span><span class="p">)</span>

            <span class="n">webshotSpaceColour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im_webshot_colour</span><span class="p">,</span> <span class="p">(</span><span class="n">centerPosX</span><span class="p">,</span> <span class="n">webshotCenterPosY</span><span class="p">))</span>
            <span class="n">im_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">webshotSpaceColour</span><span class="p">)</span>

        <span class="n">im</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;added webshot image&#39;</span><span class="p">)</span>

        <span class="c1"># Save image of black and colour channel in image-folder</span>
        <span class="k">return</span> <span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_webshot.Webshot.generate_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate_image</span><span class="p">()</span></code>

<a href="#inkycal.modules.inkycal_webshot.Webshot.generate_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate image for this module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_webshot.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

    <span class="c1"># Create tmp path</span>
    <span class="n">tmpFolder</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">TEMPORARY_FOLDER</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmpFolder</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating tmp directory </span><span class="si">{</span><span class="n">tmpFolder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">tmpFolder</span><span class="p">)</span>

    <span class="c1"># Define new image size with respect to padding</span>
    <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
    <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">270</span><span class="p">):</span>
        <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span> <span class="o">=</span> <span class="n">im_height</span><span class="p">,</span> <span class="n">im_width</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;image size: </span><span class="si">{}</span><span class="s1"> x </span><span class="si">{}</span><span class="s1"> px&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">))</span>

    <span class="c1"># Create an image for black pixels and one for coloured pixels (required)</span>
    <span class="n">im_black</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="n">im_colour</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

    <span class="c1"># Check if internet is available</span>
    <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Network not reachable. Please check your connection.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Network could not be reached :/&#39;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;preparing webshot from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s1">... cropH</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crop_h</span><span class="si">}</span><span class="s1"> cropW</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crop_w</span><span class="si">}</span><span class="s1"> cropX</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crop_x</span><span class="si">}</span><span class="s1"> cropY</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">crop_y</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">shot</span> <span class="o">=</span> <span class="n">WebShot</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">im_height</span><span class="p">,</span> <span class="n">im_width</span><span class="p">))</span>

    <span class="n">shot</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;--crop-x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_x</span><span class="p">,</span>
        <span class="s2">&quot;--crop-y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_y</span><span class="p">,</span>
        <span class="s2">&quot;--crop-w&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_w</span><span class="p">,</span>
        <span class="s2">&quot;--crop-h&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_h</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;getting webshot from </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">shot</span><span class="o">.</span><span class="n">create_pic</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpFolder</span><span class="si">}</span><span class="s2">/webshot.png&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;If you have not already installed wkhtmltopdf, please use: sudo apt-get install wkhtmltopdf. See here for more details: https://github.com/1Danish-00/htmlwebshot/&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not get webshot :/&#39;</span><span class="p">)</span>


    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;got webshot...&#39;</span><span class="p">)</span>

    <span class="n">webshotSpaceBlack</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
    <span class="n">webshotSpaceColour</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>

    <span class="n">im</span> <span class="o">=</span> <span class="n">Images</span><span class="p">()</span>
    <span class="n">im</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">tmpFolder</span><span class="si">}</span><span class="s1">/webshot.png&#39;</span><span class="p">)</span>
    <span class="n">im</span><span class="o">.</span><span class="n">remove_alpha</span><span class="p">()</span>

    <span class="n">imageAspectRatio</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">/</span> <span class="n">im_height</span>
    <span class="n">webshotAspectRatio</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span>

    <span class="k">if</span> <span class="n">webshotAspectRatio</span> <span class="o">&gt;</span> <span class="n">imageAspectRatio</span><span class="p">:</span>
        <span class="n">imageScale</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">/</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">imageScale</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">/</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span>

    <span class="n">webshotHeight</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">imageScale</span><span class="p">)</span>

    <span class="n">im</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">imageScale</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">webshotHeight</span><span class="p">)</span>

    <span class="n">im_webshot_black</span><span class="p">,</span> <span class="n">im_webshot_colour</span> <span class="o">=</span> <span class="n">image_to_palette</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">)</span>

    <span class="n">webshotCenterPosY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

    <span class="n">centerPosX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>


    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">webshotSpaceBlack</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im_webshot_black</span><span class="p">,</span> <span class="p">(</span><span class="n">centerPosX</span><span class="p">,</span> <span class="n">webshotCenterPosY</span><span class="p">))</span>
        <span class="n">im_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">webshotSpaceBlack</span><span class="p">)</span>
        <span class="n">im_black</span> <span class="o">=</span> <span class="n">im_black</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">webshotSpaceColour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im_webshot_colour</span><span class="p">,</span> <span class="p">(</span><span class="n">centerPosX</span><span class="p">,</span> <span class="n">webshotCenterPosY</span><span class="p">))</span>
        <span class="n">im_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">webshotSpaceColour</span><span class="p">)</span>
        <span class="n">im_colour</span> <span class="o">=</span> <span class="n">im_colour</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">webshotSpaceBlack</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im_webshot_black</span><span class="p">,</span> <span class="p">(</span><span class="n">centerPosX</span><span class="p">,</span> <span class="n">webshotCenterPosY</span><span class="p">))</span>
        <span class="n">im_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">webshotSpaceBlack</span><span class="p">)</span>

        <span class="n">webshotSpaceColour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im_webshot_colour</span><span class="p">,</span> <span class="p">(</span><span class="n">centerPosX</span><span class="p">,</span> <span class="n">webshotCenterPosY</span><span class="p">))</span>
        <span class="n">im_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">webshotSpaceColour</span><span class="p">)</span>

    <span class="n">im</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;added webshot image&#39;</span><span class="p">)</span>

    <span class="c1"># Save image of black and colour channel in image-folder</span>
    <span class="k">return</span> <span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="slideshow">Slideshow<a class="headerlink" href="#slideshow" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.modules.inkycal_slideshow"></a>
    <div class="doc doc-contents first">

        <p>Inkycal Slideshow Module
Copyright by aceinnolab</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.modules.inkycal_slideshow.Slideshow" class="doc doc-heading">
            <code>Slideshow</code>


<a href="#inkycal.modules.inkycal_slideshow.Slideshow" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="inkycal.modules.template.InkycalModule">InkycalModule</span></code></p>



        <p>Cycles through images in a local image folder</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/modules/inkycal_slideshow.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Slideshow</span><span class="p">(</span><span class="n">InkycalModule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cycles through images in a local image folder&quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Slideshow - cycle through images from a local folder&quot;</span>

    <span class="n">requires</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Path to a local folder, e.g. /home/pi/Desktop/images. &quot;</span>
                     <span class="s2">&quot;Only PNG and JPG/JPEG images are used for the slideshow.&quot;</span>
        <span class="p">},</span>

        <span class="s2">&quot;palette&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Which palette should be used for converting images?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bw&quot;</span><span class="p">,</span> <span class="s2">&quot;bwr&quot;</span><span class="p">,</span> <span class="s2">&quot;bwy&quot;</span><span class="p">]</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="n">optional</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s2">&quot;autoflip&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Should the image be flipped automatically? Default is False&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>
        <span class="p">},</span>

        <span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Please select the desired orientation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize module&quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

        <span class="c1"># required parameters</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;config is missing </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># optional parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">palette</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;palette&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoflip</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;autoflip&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;orientation&#39;</span><span class="p">]</span>

        <span class="c1"># Get the full path of all png/jpg/jpeg images in the given folder</span>
        <span class="n">all_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s1">/*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_files</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">)]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No images found in the given folder, please double check your path!&#39;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No images found in the given folder path :/&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">JSONCache</span><span class="p">(</span><span class="s1">&#39;inkycal_slideshow&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="c1"># set a &#39;first run&#39; signal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_first_run</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># give an OK message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

        <span class="c1"># Define new image size with respect to padding</span>
        <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
        <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
        <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># rotates list items by 1 index</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">rotate</span><span class="p">(</span><span class="nb">list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Switch to the next image if this is not the first run</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_first_run</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_first_run</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache_data</span><span class="p">[</span><span class="s2">&quot;current_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cache_data</span><span class="p">[</span><span class="s2">&quot;current_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_data</span><span class="p">[</span><span class="s2">&quot;current_index&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>

        <span class="c1"># initialize custom image class</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">Images</span><span class="p">()</span>

        <span class="c1"># temporary print method, prints current filename</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;slideshow - current image name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># use the image at the first index</span>
        <span class="n">im</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Remove background if present</span>
        <span class="n">im</span><span class="o">.</span><span class="n">remove_alpha</span><span class="p">()</span>

        <span class="c1"># if auto-flip was enabled, flip the image</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoflip</span><span class="p">:</span>
            <span class="n">im</span><span class="o">.</span><span class="n">autoflip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span>

        <span class="c1"># resize the image so it can fit on the epaper</span>
        <span class="n">im</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">im_width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">im_height</span><span class="p">)</span>

        <span class="c1"># convert images according to specified palette</span>
        <span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span> <span class="o">=</span> <span class="n">image_to_palette</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">)</span>

        <span class="c1"># with the images now send, clear the current image</span>
        <span class="n">im</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_data</span><span class="p">)</span>

        <span class="c1"># return images</span>
        <span class="k">return</span> <span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_slideshow.Slideshow.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#inkycal.modules.inkycal_slideshow.Slideshow.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_slideshow.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize module&quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

    <span class="c1"># required parameters</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;config is missing </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># optional parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">palette</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;palette&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">autoflip</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;autoflip&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;orientation&#39;</span><span class="p">]</span>

    <span class="c1"># Get the full path of all png/jpg/jpeg images in the given folder</span>
    <span class="n">all_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s1">/*&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_files</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">)]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No images found in the given folder, please double check your path!&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;No images found in the given folder path :/&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="n">JSONCache</span><span class="p">(</span><span class="s1">&#39;inkycal_slideshow&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cache_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="c1"># set a &#39;first run&#39; signal</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_first_run</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># give an OK message</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_slideshow.Slideshow.generate_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate_image</span><span class="p">()</span></code>

<a href="#inkycal.modules.inkycal_slideshow.Slideshow.generate_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate image for this module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_slideshow.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

    <span class="c1"># Define new image size with respect to padding</span>
    <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
    <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># rotates list items by 1 index</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rotate</span><span class="p">(</span><span class="nb">list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Switch to the next image if this is not the first run</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_first_run</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_first_run</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_data</span><span class="p">[</span><span class="s2">&quot;current_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_data</span><span class="p">[</span><span class="s2">&quot;current_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_data</span><span class="p">[</span><span class="s2">&quot;current_index&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>

    <span class="c1"># initialize custom image class</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">Images</span><span class="p">()</span>

    <span class="c1"># temporary print method, prints current filename</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;slideshow - current image name: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># use the image at the first index</span>
    <span class="n">im</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Remove background if present</span>
    <span class="n">im</span><span class="o">.</span><span class="n">remove_alpha</span><span class="p">()</span>

    <span class="c1"># if auto-flip was enabled, flip the image</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoflip</span><span class="p">:</span>
        <span class="n">im</span><span class="o">.</span><span class="n">autoflip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span>

    <span class="c1"># resize the image so it can fit on the epaper</span>
    <span class="n">im</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">im_width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">im_height</span><span class="p">)</span>

    <span class="c1"># convert images according to specified palette</span>
    <span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span> <span class="o">=</span> <span class="n">image_to_palette</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">)</span>

    <span class="c1"># with the images now send, clear the current image</span>
    <span class="n">im</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_data</span><span class="p">)</span>

    <span class="c1"># return images</span>
    <span class="k">return</span> <span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="server-module">Server Module<a class="headerlink" href="#server-module" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.modules.inkycal_server"></a>
    <div class="doc doc-contents first">

        <p>Inkycal-server module for Inkycal Project
by Aterju (https://inkycal.robertsirre.nl/)
Copyright by aceinnolab</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.modules.inkycal_server.Inkyserver" class="doc doc-heading">
            <code>Inkyserver</code>


<a href="#inkycal.modules.inkycal_server.Inkyserver" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="inkycal.modules.template.InkycalModule">InkycalModule</span></code></p>



        <p>Displays an image from URL or local path</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/modules/inkycal_server.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Inkyserver</span><span class="p">(</span><span class="n">InkycalModule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Displays an image from URL or local path</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Inykcal Server - fetches an image from Inkycal-server - (https://inkycal.robertsirre.nl/)&quot;</span>

    <span class="n">requires</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Which URL should be used to get the image?&quot;</span>
        <span class="p">},</span>

        <span class="s2">&quot;palette&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Which palette should be used to convert the images?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;bw&#39;</span><span class="p">,</span> <span class="s1">&#39;bwr&#39;</span><span class="p">,</span> <span class="s1">&#39;bwy&#39;</span><span class="p">]</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="n">optional</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s2">&quot;path_body&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Send this data to the server via POST. Use a comma to &quot;</span>
                     <span class="s2">&quot;separate multiple items&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;dither&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Dither images before sending to E-Paper? Default is False.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize module&quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

        <span class="c1"># required parameters</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;config is missing </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># optional parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">palette</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;palette&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dither</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;dither&#39;</span><span class="p">]</span>

        <span class="c1"># convert path_body to list, if not already</span>
        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path_body&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;path_body&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path_body</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path_body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path_body</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path_body&#39;</span><span class="p">]</span>

        <span class="c1"># give an OK message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

        <span class="c1"># Define new image size with respect to padding</span>
        <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
        <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
        <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># replace width and height of url</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">im_width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">im_height</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;modified path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># initialize custom image class</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">Images</span><span class="p">()</span>

        <span class="c1"># when no path_body is provided, use plain GET</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_body</span><span class="p">:</span>

            <span class="c1"># use the image at the first index</span>
            <span class="n">im</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># else use POST request</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Get the response image</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path_body</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">raw</span><span class="p">)</span>

            <span class="c1"># initialize custom image class with response</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">Images</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="c1"># resize the image to respect padding</span>
        <span class="n">im</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">im_width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">im_height</span><span class="p">)</span>

        <span class="c1"># convert image to given palette</span>
        <span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">to_palette</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">,</span> <span class="n">dither</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dither</span><span class="p">)</span>

        <span class="c1"># with the images now send, clear the current image</span>
        <span class="n">im</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># return images</span>
        <span class="k">return</span> <span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_server.Inkyserver.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#inkycal.modules.inkycal_server.Inkyserver.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_server.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize module&quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

    <span class="c1"># required parameters</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">requires</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">param</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;config is missing </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># optional parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">palette</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;palette&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dither</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;dither&#39;</span><span class="p">]</span>

    <span class="c1"># convert path_body to list, if not already</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path_body&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;path_body&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_body</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path_body&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_body</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;path_body&#39;</span><span class="p">]</span>

    <span class="c1"># give an OK message</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_server.Inkyserver.generate_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate_image</span><span class="p">()</span></code>

<a href="#inkycal.modules.inkycal_server.Inkyserver.generate_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate image for this module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_server.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

    <span class="c1"># Define new image size with respect to padding</span>
    <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
    <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># replace width and height of url</span>
    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">im_width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">im_height</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;modified path: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># initialize custom image class</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">Images</span><span class="p">()</span>

    <span class="c1"># when no path_body is provided, use plain GET</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_body</span><span class="p">:</span>

        <span class="c1"># use the image at the first index</span>
        <span class="n">im</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="c1"># else use POST request</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Get the response image</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path_body</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">raw</span><span class="p">)</span>

        <span class="c1"># initialize custom image class with response</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">Images</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="c1"># resize the image to respect padding</span>
    <span class="n">im</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">im_width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">im_height</span><span class="p">)</span>

    <span class="c1"># convert image to given palette</span>
    <span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">to_palette</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">,</span> <span class="n">dither</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dither</span><span class="p">)</span>

    <span class="c1"># with the images now send, clear the current image</span>
    <span class="n">im</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="c1"># return images</span>
    <span class="k">return</span> <span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="xkcd">XKCD<a class="headerlink" href="#xkcd" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.modules.inkycal_xkcd"></a>
    <div class="doc doc-contents first">

        <p>Inkycal XKCD module
by https://github.com/worstface</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.modules.inkycal_xkcd.Xkcd" class="doc doc-heading">
            <code>Xkcd</code>


<a href="#inkycal.modules.inkycal_xkcd.Xkcd" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="inkycal.modules.template.InkycalModule">InkycalModule</span></code></p>










              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/modules/inkycal_xkcd.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Xkcd</span><span class="p">(</span><span class="n">InkycalModule</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;xkcd - Displays comics from xkcd.com by Randall Munroe&quot;</span>

    <span class="c1"># required parameters</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">{</span>

        <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Please select the mode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;latest&quot;</span><span class="p">,</span> <span class="s2">&quot;random&quot;</span><span class="p">],</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;latest&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;palette&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Which color palette should be used for the comic Image2?&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bw&quot;</span><span class="p">,</span> <span class="s2">&quot;bwr&quot;</span><span class="p">,</span> <span class="s2">&quot;bwy&quot;</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">&quot;alt&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Would you like to add the alt text below the comic? If XKCD is not the only module you are showing, I recommend setting this to &#39;no&#39;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">],</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;no&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;filter&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Would you like to add a scaling filter? If the is far too big to be shown in the space you&#39;ve allotted for it, the module will try to find another image for you. This only applies in random mode. If XKCD is not the only module you are showing, I recommend setting this to &#39;no&#39;.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="s2">&quot;no&quot;</span><span class="p">],</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="s2">&quot;no&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">palette</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;palette&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;alt&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scale_filter</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;filter&#39;</span><span class="p">]</span>

        <span class="c1"># give an OK message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Inkycal XKCD loaded&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

        <span class="c1"># Create tmp path</span>
        <span class="n">tmpPath</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">TEMPORARY_FOLDER</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmpPath</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">tmpPath</span><span class="p">)</span>

        <span class="c1"># Define new image size with respect to padding</span>
        <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
        <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
        <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;image size: </span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">im_height</span><span class="si">}</span><span class="s1"> px&#39;</span><span class="p">)</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="c1"># Check if internet is available</span>
        <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Network not reachable. Please check your connection.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Network could not be reached :/&#39;</span><span class="p">)</span>

        <span class="c1"># Set some parameters for formatting feeds</span>
        <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>
        <span class="n">line_width</span> <span class="o">=</span> <span class="n">im_width</span>
        <span class="n">max_lines</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">//</span> <span class="p">(</span><span class="n">line_height</span> <span class="o">+</span> <span class="n">line_spacing</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max_lines: </span><span class="si">{</span><span class="n">max_lines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate padding from top so the lines look centralised</span>
        <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Calculate line_positions</span>
        <span class="n">line_positions</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing_top</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;line positions: </span><span class="si">{</span><span class="n">line_positions</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;getting xkcd comic...&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;random&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_filter</span> <span class="o">==</span> <span class="s1">&#39;no&#39;</span><span class="p">:</span>
                <span class="n">xkcdComic</span> <span class="o">=</span> <span class="n">xkcd</span><span class="o">.</span><span class="n">getRandomComic</span><span class="p">()</span>
                <span class="n">xkcdComic</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">tmpPath</span><span class="p">,</span> <span class="n">outputFile</span><span class="o">=</span><span class="s1">&#39;xkcdComic.png&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">perc</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
                <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;test variable, not a real comic&quot;</span>
                <span class="k">while</span> <span class="nb">max</span><span class="p">(</span><span class="n">perc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.75</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;looking for another comic, old comic was: &quot;</span><span class="p">,</span> <span class="n">perc</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
                    <span class="n">xkcdComic</span> <span class="o">=</span> <span class="n">xkcd</span><span class="o">.</span><span class="n">getRandomComic</span><span class="p">()</span>
                    <span class="n">xkcdComic</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">tmpPath</span><span class="p">,</span> <span class="n">outputFile</span><span class="o">=</span><span class="s1">&#39;xkcdComic.png&#39;</span><span class="p">)</span>
                    <span class="n">actual_size</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpPath</span> <span class="o">+</span> <span class="s1">&#39;/xkcdComic.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
                    <span class="n">perc</span> <span class="o">=</span> <span class="p">(</span><span class="n">actual_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">actual_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">im_height</span><span class="p">)</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="n">xkcdComic</span><span class="o">.</span><span class="n">getImageLink</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found one! perc: &quot;</span><span class="p">,</span> <span class="n">perc</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xkcdComic</span> <span class="o">=</span> <span class="n">xkcd</span><span class="o">.</span><span class="n">getLatestComic</span><span class="p">()</span>
            <span class="n">xkcdComic</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">tmpPath</span><span class="p">,</span> <span class="n">outputFile</span><span class="o">=</span><span class="s1">&#39;xkcdComic.png&#39;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;got xkcd comic...&#39;</span><span class="p">)</span>
        <span class="n">title_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">title_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xkcdComic</span><span class="o">.</span><span class="n">getTitle</span><span class="p">())</span>

        <span class="n">altOffset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_height</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="n">alt_text</span> <span class="o">=</span> <span class="n">xkcdComic</span><span class="o">.</span><span class="n">getAltText</span><span class="p">()</span>  <span class="c1"># get the alt text, too (I break it up into multiple lines later on)</span>

            <span class="c1"># break up the alt text into lines</span>
            <span class="n">alt_lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">alt_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
                <span class="c1"># this breaks up the alt_text into words and creates each line by adding</span>
                <span class="c1"># one word at a time until the line is longer than the width of the module</span>
                <span class="c1"># then it appends the line to the alt_lines array and starts testing a new line</span>
                <span class="c1"># with the next word</span>
                <span class="k">if</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">current_line</span> <span class="o">+</span> <span class="n">_</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">im_width</span><span class="p">:</span>
                    <span class="n">current_line</span> <span class="o">=</span> <span class="n">current_line</span> <span class="o">+</span> <span class="n">_</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">alt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_line</span><span class="p">)</span>
                    <span class="n">current_line</span> <span class="o">=</span> <span class="n">_</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
            <span class="n">alt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">current_line</span><span class="p">)</span>  <span class="c1"># this adds the last line to the array (or the only line, if the alt text is really short)</span>
            <span class="n">altHeight</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_height</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">alt_lines</span><span class="p">))</span> <span class="o">+</span> <span class="n">altOffset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">altHeight</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># this is added so that I don&#39;t need to add more &quot;if alt is yes&quot; conditionals when centering below. Now the centering code will work regardless of whether they want alttext or not</span>

        <span class="n">comicSpaceBlack</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
        <span class="n">comicSpaceColour</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>

        <span class="n">im</span> <span class="o">=</span> <span class="n">Image2</span><span class="p">()</span>
        <span class="n">im</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpPath</span><span class="si">}</span><span class="s2">/xkcdComic.png&quot;</span><span class="p">)</span>
        <span class="n">im</span><span class="o">.</span><span class="n">remove_alpha</span><span class="p">()</span>

        <span class="n">imageAspectRatio</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">/</span> <span class="n">im_height</span>
        <span class="n">comicAspectRatio</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span>

        <span class="k">if</span> <span class="n">comicAspectRatio</span> <span class="o">&gt;</span> <span class="n">imageAspectRatio</span><span class="p">:</span>
            <span class="n">imageScale</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">/</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">imageScale</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">/</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span>

        <span class="n">comicHeight</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">imageScale</span><span class="p">)</span>

        <span class="n">headerHeight</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_height</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">comicHeight</span> <span class="o">+</span> <span class="p">(</span><span class="n">headerHeight</span> <span class="o">+</span> <span class="n">altHeight</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">im_height</span><span class="p">:</span>
            <span class="n">comicHeight</span> <span class="o">-=</span> <span class="p">(</span><span class="n">headerHeight</span> <span class="o">+</span> <span class="n">altHeight</span><span class="p">)</span>

        <span class="n">im</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">imageScale</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">comicHeight</span><span class="p">)</span>

        <span class="n">im_comic_black</span><span class="p">,</span> <span class="n">im_comic_colour</span> <span class="o">=</span> <span class="n">image_to_palette</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">)</span>

        <span class="n">headerCenterPosY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">headerHeight</span> <span class="o">+</span> <span class="n">altHeight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">comicCenterPosY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">headerHeight</span> <span class="o">+</span> <span class="n">altHeight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">headerHeight</span><span class="p">)</span>
        <span class="n">altCenterPosY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
            <span class="p">(</span><span class="n">im_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">headerHeight</span> <span class="o">+</span> <span class="n">altHeight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">headerHeight</span> <span class="o">+</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

        <span class="n">centerPosX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

        <span class="n">comicSpaceBlack</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im_comic_black</span><span class="p">,</span> <span class="p">(</span><span class="n">centerPosX</span><span class="p">,</span> <span class="n">comicCenterPosY</span><span class="p">))</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">comicSpaceBlack</span><span class="p">)</span>

        <span class="n">comicSpaceColour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im_comic_colour</span><span class="p">,</span> <span class="p">(</span><span class="n">centerPosX</span><span class="p">,</span> <span class="n">comicCenterPosY</span><span class="p">))</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">comicSpaceColour</span><span class="p">)</span>

        <span class="n">im</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;added comic image&#39;</span><span class="p">)</span>

        <span class="c1"># Write the title on the black image</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">headerCenterPosY</span><span class="p">),</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="n">title_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
            <span class="c1"># write alt_text</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alt_lines</span><span class="p">)):</span>
                <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">altCenterPosY</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span> <span class="o">+</span> <span class="n">altOffset</span><span class="p">),</span>
                    <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">alt_lines</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
                    <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
                <span class="p">)</span>
        <span class="c1"># Save image of black and colour channel in image-folder</span>
        <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_xkcd.Xkcd.generate_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate_image</span><span class="p">()</span></code>

<a href="#inkycal.modules.inkycal_xkcd.Xkcd.generate_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate image for this module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_xkcd.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

    <span class="c1"># Create tmp path</span>
    <span class="n">tmpPath</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">TEMPORARY_FOLDER</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmpPath</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">tmpPath</span><span class="p">)</span>

    <span class="c1"># Define new image size with respect to padding</span>
    <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
    <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;image size: </span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">im_height</span><span class="si">}</span><span class="s1"> px&#39;</span><span class="p">)</span>

    <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Check if internet is available</span>
    <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Network not reachable. Please check your connection.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Network could not be reached :/&#39;</span><span class="p">)</span>

    <span class="c1"># Set some parameters for formatting feeds</span>
    <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>
    <span class="n">line_width</span> <span class="o">=</span> <span class="n">im_width</span>
    <span class="n">max_lines</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">//</span> <span class="p">(</span><span class="n">line_height</span> <span class="o">+</span> <span class="n">line_spacing</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max_lines: </span><span class="si">{</span><span class="n">max_lines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate padding from top so the lines look centralised</span>
    <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Calculate line_positions</span>
    <span class="n">line_positions</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing_top</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;line positions: </span><span class="si">{</span><span class="n">line_positions</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;getting xkcd comic...&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;random&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_filter</span> <span class="o">==</span> <span class="s1">&#39;no&#39;</span><span class="p">:</span>
            <span class="n">xkcdComic</span> <span class="o">=</span> <span class="n">xkcd</span><span class="o">.</span><span class="n">getRandomComic</span><span class="p">()</span>
            <span class="n">xkcdComic</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">tmpPath</span><span class="p">,</span> <span class="n">outputFile</span><span class="o">=</span><span class="s1">&#39;xkcdComic.png&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">perc</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;test variable, not a real comic&quot;</span>
            <span class="k">while</span> <span class="nb">max</span><span class="p">(</span><span class="n">perc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.75</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;looking for another comic, old comic was: &quot;</span><span class="p">,</span> <span class="n">perc</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
                <span class="n">xkcdComic</span> <span class="o">=</span> <span class="n">xkcd</span><span class="o">.</span><span class="n">getRandomComic</span><span class="p">()</span>
                <span class="n">xkcdComic</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">tmpPath</span><span class="p">,</span> <span class="n">outputFile</span><span class="o">=</span><span class="s1">&#39;xkcdComic.png&#39;</span><span class="p">)</span>
                <span class="n">actual_size</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmpPath</span> <span class="o">+</span> <span class="s1">&#39;/xkcdComic.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span>
                <span class="n">perc</span> <span class="o">=</span> <span class="p">(</span><span class="n">actual_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">actual_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">im_height</span><span class="p">)</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">xkcdComic</span><span class="o">.</span><span class="n">getImageLink</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;found one! perc: &quot;</span><span class="p">,</span> <span class="n">perc</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xkcdComic</span> <span class="o">=</span> <span class="n">xkcd</span><span class="o">.</span><span class="n">getLatestComic</span><span class="p">()</span>
        <span class="n">xkcdComic</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="n">tmpPath</span><span class="p">,</span> <span class="n">outputFile</span><span class="o">=</span><span class="s1">&#39;xkcdComic.png&#39;</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;got xkcd comic...&#39;</span><span class="p">)</span>
    <span class="n">title_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">title_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xkcdComic</span><span class="o">.</span><span class="n">getTitle</span><span class="p">())</span>

    <span class="n">altOffset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_height</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
        <span class="n">alt_text</span> <span class="o">=</span> <span class="n">xkcdComic</span><span class="o">.</span><span class="n">getAltText</span><span class="p">()</span>  <span class="c1"># get the alt text, too (I break it up into multiple lines later on)</span>

        <span class="c1"># break up the alt text into lines</span>
        <span class="n">alt_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">alt_text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
            <span class="c1"># this breaks up the alt_text into words and creates each line by adding</span>
            <span class="c1"># one word at a time until the line is longer than the width of the module</span>
            <span class="c1"># then it appends the line to the alt_lines array and starts testing a new line</span>
            <span class="c1"># with the next word</span>
            <span class="k">if</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_text_width</span><span class="p">(</span><span class="n">current_line</span> <span class="o">+</span> <span class="n">_</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">im_width</span><span class="p">:</span>
                <span class="n">current_line</span> <span class="o">=</span> <span class="n">current_line</span> <span class="o">+</span> <span class="n">_</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">alt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_line</span><span class="p">)</span>
                <span class="n">current_line</span> <span class="o">=</span> <span class="n">_</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
        <span class="n">alt_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">current_line</span><span class="p">)</span>  <span class="c1"># this adds the last line to the array (or the only line, if the alt text is really short)</span>
        <span class="n">altHeight</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_height</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">alt_lines</span><span class="p">))</span> <span class="o">+</span> <span class="n">altOffset</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">altHeight</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># this is added so that I don&#39;t need to add more &quot;if alt is yes&quot; conditionals when centering below. Now the centering code will work regardless of whether they want alttext or not</span>

    <span class="n">comicSpaceBlack</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
    <span class="n">comicSpaceColour</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>

    <span class="n">im</span> <span class="o">=</span> <span class="n">Image2</span><span class="p">()</span>
    <span class="n">im</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpPath</span><span class="si">}</span><span class="s2">/xkcdComic.png&quot;</span><span class="p">)</span>
    <span class="n">im</span><span class="o">.</span><span class="n">remove_alpha</span><span class="p">()</span>

    <span class="n">imageAspectRatio</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">/</span> <span class="n">im_height</span>
    <span class="n">comicAspectRatio</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span>

    <span class="k">if</span> <span class="n">comicAspectRatio</span> <span class="o">&gt;</span> <span class="n">imageAspectRatio</span><span class="p">:</span>
        <span class="n">imageScale</span> <span class="o">=</span> <span class="n">im_width</span> <span class="o">/</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">imageScale</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">/</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span>

    <span class="n">comicHeight</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">imageScale</span><span class="p">)</span>

    <span class="n">headerHeight</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_height</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">comicHeight</span> <span class="o">+</span> <span class="p">(</span><span class="n">headerHeight</span> <span class="o">+</span> <span class="n">altHeight</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">im_height</span><span class="p">:</span>
        <span class="n">comicHeight</span> <span class="o">-=</span> <span class="p">(</span><span class="n">headerHeight</span> <span class="o">+</span> <span class="n">altHeight</span><span class="p">)</span>

    <span class="n">im</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">imageScale</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">comicHeight</span><span class="p">)</span>

    <span class="n">im_comic_black</span><span class="p">,</span> <span class="n">im_comic_colour</span> <span class="o">=</span> <span class="n">image_to_palette</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">palette</span><span class="p">)</span>

    <span class="n">headerCenterPosY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">headerHeight</span> <span class="o">+</span> <span class="n">altHeight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">comicCenterPosY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">headerHeight</span> <span class="o">+</span> <span class="n">altHeight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">headerHeight</span><span class="p">)</span>
    <span class="n">altCenterPosY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
        <span class="p">(</span><span class="n">im_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">headerHeight</span> <span class="o">+</span> <span class="n">altHeight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">headerHeight</span> <span class="o">+</span> <span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

    <span class="n">centerPosX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">im_width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

    <span class="n">comicSpaceBlack</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im_comic_black</span><span class="p">,</span> <span class="p">(</span><span class="n">centerPosX</span><span class="p">,</span> <span class="n">comicCenterPosY</span><span class="p">))</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">comicSpaceBlack</span><span class="p">)</span>

    <span class="n">comicSpaceColour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">im_comic_colour</span><span class="p">,</span> <span class="p">(</span><span class="n">centerPosX</span><span class="p">,</span> <span class="n">comicCenterPosY</span><span class="p">))</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">comicSpaceColour</span><span class="p">)</span>

    <span class="n">im</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;added comic image&#39;</span><span class="p">)</span>

    <span class="c1"># Write the title on the black image</span>
    <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">headerCenterPosY</span><span class="p">),</span>
        <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
        <span class="n">text</span><span class="o">=</span><span class="n">title_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">alt</span> <span class="o">==</span> <span class="s2">&quot;yes&quot;</span><span class="p">:</span>
        <span class="c1"># write alt_text</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">alt_lines</span><span class="p">)):</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">altCenterPosY</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span> <span class="o">+</span> <span class="n">altOffset</span><span class="p">),</span>
                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">alt_lines</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
            <span class="p">)</span>
    <span class="c1"># Save image of black and colour channel in image-folder</span>
    <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="jokes">Jokes<a class="headerlink" href="#jokes" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.modules.inkycal_jokes"></a>
    <div class="doc doc-contents first">

        <p>iCanHazDadJoke module for InkyCal Project
Special thanks to Erik Fredericks (@efredericks) for the template!</p>
<p>Copyright by aceinnolab</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.modules.inkycal_jokes.Jokes" class="doc doc-heading">
            <code>Jokes</code>


<a href="#inkycal.modules.inkycal_jokes.Jokes" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="inkycal.modules.template.InkycalModule">InkycalModule</span></code></p>



        <p>Icanhazdad-api class
parses rss/atom feeds from given urls</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/modules/inkycal_jokes.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Jokes</span><span class="p">(</span><span class="n">InkycalModule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Icanhazdad-api class</span>
<span class="sd">    parses rss/atom feeds from given urls</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;iCanHazDad API - grab a random joke from icanhazdad api&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_feeds module&quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

        <span class="c1"># give an OK message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

        <span class="c1"># Define new image size with respect to padding</span>
        <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
        <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
        <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;image size: </span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">im_height</span><span class="si">}</span><span class="s1"> px&#39;</span><span class="p">)</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="c1"># Check if internet is available</span>
        <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Network not reachable. Please check your connection.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">NetworkNotReachableError</span>

        <span class="c1"># Set some parameters for formatting feeds</span>
        <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span>
        <span class="n">line_width</span> <span class="o">=</span> <span class="n">im_width</span>
        <span class="n">max_lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">im_height</span> <span class="o">//</span> <span class="p">(</span><span class="n">line_height</span> <span class="o">+</span> <span class="n">line_spacing</span><span class="p">))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max_lines: </span><span class="si">{</span><span class="n">max_lines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate padding from top so the lines look centralised</span>
        <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Calculate line_positions</span>
        <span class="n">line_positions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing_top</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;line positions: </span><span class="si">{</span><span class="n">line_positions</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Get the actual joke</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://icanhazdadjoke.com&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>  <span class="c1"># Change encoding to UTF-8</span>
        <span class="n">joke</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>  <span class="c1"># use to remove newlines</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;joke: </span><span class="si">{</span><span class="n">joke</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># wrap text in case joke is too large</span>
        <span class="n">wrapped</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">text_wrap</span><span class="p">(</span><span class="n">joke</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;wrapped: </span><span class="si">{</span><span class="n">wrapped</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Check if joke can actually fit on the provided space</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wrapped</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_lines</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Ohoh, Joke is too large for given space, please consider &quot;</span>
                         <span class="s2">&quot;increasing the size for this module&quot;</span><span class="p">)</span>

        <span class="c1"># Write the joke on the image</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wrapped</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">_</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">max_lines</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Ran out of lines for this joke :/&#39;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">wrapped</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
            <span class="p">)</span>

        <span class="c1"># Return images for black and colour channels</span>
        <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_jokes.Jokes.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#inkycal.modules.inkycal_jokes.Jokes.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize inkycal_feeds module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_jokes.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_feeds module&quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>

    <span class="c1"># give an OK message</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_jokes.Jokes.generate_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate_image</span><span class="p">()</span></code>

<a href="#inkycal.modules.inkycal_jokes.Jokes.generate_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate image for this module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_jokes.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

    <span class="c1"># Define new image size with respect to padding</span>
    <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
    <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;image size: </span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">im_height</span><span class="si">}</span><span class="s1"> px&#39;</span><span class="p">)</span>

    <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Check if internet is available</span>
    <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Network not reachable. Please check your connection.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">NetworkNotReachableError</span>

    <span class="c1"># Set some parameters for formatting feeds</span>
    <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span>
    <span class="n">line_width</span> <span class="o">=</span> <span class="n">im_width</span>
    <span class="n">max_lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">im_height</span> <span class="o">//</span> <span class="p">(</span><span class="n">line_height</span> <span class="o">+</span> <span class="n">line_spacing</span><span class="p">))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max_lines: </span><span class="si">{</span><span class="n">max_lines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate padding from top so the lines look centralised</span>
    <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Calculate line_positions</span>
    <span class="n">line_positions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing_top</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;line positions: </span><span class="si">{</span><span class="n">line_positions</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Get the actual joke</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://icanhazdadjoke.com&quot;</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>  <span class="c1"># Change encoding to UTF-8</span>
    <span class="n">joke</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>  <span class="c1"># use to remove newlines</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;joke: </span><span class="si">{</span><span class="n">joke</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># wrap text in case joke is too large</span>
    <span class="n">wrapped</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">text_wrap</span><span class="p">(</span><span class="n">joke</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;wrapped: </span><span class="si">{</span><span class="n">wrapped</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check if joke can actually fit on the provided space</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wrapped</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_lines</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Ohoh, Joke is too large for given space, please consider &quot;</span>
                     <span class="s2">&quot;increasing the size for this module&quot;</span><span class="p">)</span>

    <span class="c1"># Write the joke on the image</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wrapped</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">_</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">max_lines</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Ran out of lines for this joke :/&#39;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="n">wrapped</span><span class="p">[</span><span class="n">_</span><span class="p">],</span>
            <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
        <span class="p">)</span>

    <span class="c1"># Return images for black and colour channels</span>
    <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="tindie">Tindie<a class="headerlink" href="#tindie" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.modules.inkycal_tindie"></a>
    <div class="doc doc-contents first">

        <p>Tindie module for Inkycal Project
Shows unshipped orders from your Tindie store</p>
<p>Copyright by aceinnolab</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.modules.inkycal_tindie.Tindie" class="doc doc-heading">
            <code>Tindie</code>


<a href="#inkycal.modules.inkycal_tindie.Tindie" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="inkycal.modules.template.InkycalModule">InkycalModule</span></code></p>



        <p>Tindie - show latest orders from your store</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/modules/inkycal_tindie.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Tindie</span><span class="p">(</span><span class="n">InkycalModule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tindie - show latest orders from your store&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_feeds module&quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
        <span class="c1"># todo implement mode</span>
        <span class="c1"># self.mode = config[&#39;mode&#39;]  # unshipped_orders, shipped_orders, all_orders</span>

        <span class="c1"># give an OK message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>
        <span class="c1"># Define new image size with respect to padding</span>
        <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
        <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
        <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;image size: </span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">im_height</span><span class="si">}</span><span class="s1"> px&#39;</span><span class="p">)</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="c1"># Check if internet is available</span>
        <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Network not reachable. Please check your connection.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">NetworkNotReachableError</span>

        <span class="c1"># Set some parameters for formatting feeds</span>
        <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>
        <span class="n">line_width</span> <span class="o">=</span> <span class="n">im_width</span>
        <span class="n">max_lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">im_height</span> <span class="o">//</span> <span class="p">(</span><span class="n">line_height</span> <span class="o">+</span> <span class="n">line_spacing</span><span class="p">))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max_lines: </span><span class="si">{</span><span class="n">max_lines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Calculate padding from top so the lines look centralised</span>
        <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Calculate line_positions</span>
        <span class="n">line_positions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing_top</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;line positions: </span><span class="si">{</span><span class="n">line_positions</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Make the API call</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://www.tindie.com/api/v1/order/?format=json&amp;username=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">&amp;api_key=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/json&quot;</span><span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shipped&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="s2">&quot;50&quot;</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get orders, status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;response: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Failed to get orders&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Orders received&quot;</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">orders</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="s2">&quot;orders&quot;</span><span class="p">]</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You have </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span><span class="si">}</span><span class="s2"> unshipped orders&quot;</span><span class="p">)</span>
        <span class="n">previous_date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">order</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">orders</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">order</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;local&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;YY/MM/DD&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">previous_date</span> <span class="ow">or</span> <span class="n">previous_date</span> <span class="o">!=</span> <span class="n">date</span><span class="p">:</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
                <span class="n">previous_date</span> <span class="o">=</span> <span class="n">date</span>
            <span class="n">user_name</span> <span class="o">=</span> <span class="n">order</span><span class="p">[</span><span class="s2">&quot;shipping_name&quot;</span><span class="p">]</span>
            <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">user_name</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">order</span><span class="p">[</span><span class="s1">&#39;shipping_country_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> ordered </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="si">}</span><span class="s2"> items!&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="n">max_lines</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ran out of lines! Required </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s1"> lines but only </span><span class="si">{</span><span class="n">max_lines</span><span class="si">}</span><span class="s1"> available&#39;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span>
                    <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">line</span><span class="p">,</span>
                    <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                    <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span>
                    <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">line</span><span class="p">,</span>
                    <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="p">)</span>


        <span class="c1"># Return images for black and colour channels</span>
        <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_tindie.Tindie.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#inkycal.modules.inkycal_tindie.Tindie.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize inkycal_feeds module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_tindie.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_feeds module&quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;api_key&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
    <span class="c1"># todo implement mode</span>
    <span class="c1"># self.mode = config[&#39;mode&#39;]  # unshipped_orders, shipped_orders, all_orders</span>

    <span class="c1"># give an OK message</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_tindie.Tindie.generate_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate_image</span><span class="p">()</span></code>

<a href="#inkycal.modules.inkycal_tindie.Tindie.generate_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate image for this module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_tindie.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>
    <span class="c1"># Define new image size with respect to padding</span>
    <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
    <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;image size: </span><span class="si">{</span><span class="n">im_width</span><span class="si">}</span><span class="s1"> x </span><span class="si">{</span><span class="n">im_height</span><span class="si">}</span><span class="s1"> px&#39;</span><span class="p">)</span>

    <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Check if internet is available</span>
    <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Network not reachable. Please check your connection.&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">NetworkNotReachableError</span>

    <span class="c1"># Set some parameters for formatting feeds</span>
    <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>
    <span class="n">line_width</span> <span class="o">=</span> <span class="n">im_width</span>
    <span class="n">max_lines</span> <span class="o">=</span> <span class="p">(</span><span class="n">im_height</span> <span class="o">//</span> <span class="p">(</span><span class="n">line_height</span> <span class="o">+</span> <span class="n">line_spacing</span><span class="p">))</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;max_lines: </span><span class="si">{</span><span class="n">max_lines</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate padding from top so the lines look centralised</span>
    <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Calculate line_positions</span>
    <span class="n">line_positions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing_top</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;line positions: </span><span class="si">{</span><span class="n">line_positions</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Make the API call</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://www.tindie.com/api/v1/order/?format=json&amp;username=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">&amp;api_key=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/json&quot;</span><span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shipped&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;limit&quot;</span><span class="p">:</span> <span class="s2">&quot;50&quot;</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to get orders, status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;response: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">&quot;Failed to get orders&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Orders received&quot;</span><span class="p">)</span>

    <span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">orders</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)[</span><span class="s2">&quot;orders&quot;</span><span class="p">]</span>
    <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You have </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span><span class="si">}</span><span class="s2"> unshipped orders&quot;</span><span class="p">)</span>
    <span class="n">previous_date</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">order</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">orders</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">order</span><span class="p">[</span><span class="s2">&quot;items&quot;</span><span class="p">]</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">order</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;local&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;YY/MM/DD&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">previous_date</span> <span class="ow">or</span> <span class="n">previous_date</span> <span class="o">!=</span> <span class="n">date</span><span class="p">:</span>
            <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
            <span class="n">previous_date</span> <span class="o">=</span> <span class="n">date</span>
        <span class="n">user_name</span> <span class="o">=</span> <span class="n">order</span><span class="p">[</span><span class="s2">&quot;shipping_name&quot;</span><span class="p">]</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="n">user_name</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">order</span><span class="p">[</span><span class="s1">&#39;shipping_country_code&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> ordered </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="si">}</span><span class="s2"> items!&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="n">max_lines</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ran out of lines! Required </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s1"> lines but only </span><span class="si">{</span><span class="n">max_lines</span><span class="si">}</span><span class="s1"> available&#39;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span>
                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">line</span><span class="p">,</span>
                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="n">colour</span><span class="o">=</span><span class="s2">&quot;colour&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span>
                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">line</span><span class="p">,</span>
                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
            <span class="p">)</span>


    <span class="c1"># Return images for black and colour channels</span>
    <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h3 id="text-file-renderer">Text File Renderer<a class="headerlink" href="#text-file-renderer" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.modules.inkycal_textfile_to_display"></a>
    <div class="doc doc-contents first">

        <p>Textfile module for InkyCal Project</p>
<p>Reads data from a plain .txt file and renders it on the display.
If the content is too long, it will be truncated from the back until it fits</p>
<p>Copyright by aceinnolab</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.modules.inkycal_textfile_to_display.TextToDisplay" class="doc doc-heading">
            <code>TextToDisplay</code>


<a href="#inkycal.modules.inkycal_textfile_to_display.TextToDisplay" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="inkycal.modules.template.InkycalModule">InkycalModule</span></code></p>



        <p>TextToDisplay module - Display text from a local file on the display</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/modules/inkycal_textfile_to_display.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TextToDisplay</span><span class="p">(</span><span class="n">InkycalModule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;TextToDisplay module - Display text from a local file on the display</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;TextToDisplay - Display text from a local file on the display&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_textfile_to_display module&quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

        <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>
        <span class="c1"># required parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;filepath&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">make_request</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

        <span class="c1"># give an OK message</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate module-specific parameters&quot;&quot;&quot;</span>
        <span class="c1"># ensure we only use a single file</span>
        <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

        <span class="c1"># Define new image size with respect to padding</span>
        <span class="n">file_content</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
        <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
        <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="c1"># Set some parameters for formatting feeds</span>
        <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>
        <span class="n">line_width</span> <span class="o">=</span> <span class="n">im_width</span>
        <span class="n">max_lines</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">//</span> <span class="n">line_height</span>

        <span class="c1"># Calculate padding from top so the lines look centralised</span>
        <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Calculate line_positions</span>
        <span class="n">line_positions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing_top</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_request</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Detected http path, making request&quot;</span><span class="p">)</span>
            <span class="c1"># Check if internet is available</span>
            <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NetworkNotReachableError</span>
            <span class="n">file_content</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Create list containing all lines</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file_content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="c1"># Split content by lines if not making a request</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_request</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">file_content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">text_wrap</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">im_width</span><span class="p">)</span>

        <span class="c1"># Trim down the list to the max number of lines</span>
        <span class="k">del</span> <span class="n">lines</span><span class="p">[</span><span class="n">max_lines</span><span class="p">:]</span>

        <span class="c1"># Write feeds on image</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">line</span><span class="p">,</span>
                <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
            <span class="p">)</span>

        <span class="c1"># return images</span>
        <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_textfile_to_display.TextToDisplay.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

<a href="#inkycal.modules.inkycal_textfile_to_display.TextToDisplay.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize inkycal_textfile_to_display module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_textfile_to_display.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize inkycal_textfile_to_display module&quot;&quot;&quot;</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;config&#39;</span><span class="p">]</span>
    <span class="c1"># required parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;filepath&quot;</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">make_request</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;https://&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="c1"># give an OK message</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> loaded&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.modules.inkycal_textfile_to_display.TextToDisplay.generate_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate_image</span><span class="p">()</span></code>

<a href="#inkycal.modules.inkycal_textfile_to_display.TextToDisplay.generate_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate image for this module</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/modules/inkycal_textfile_to_display.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate image for this module&quot;&quot;&quot;</span>

    <span class="c1"># Define new image size with respect to padding</span>
    <span class="n">file_content</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">im_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_left</span><span class="p">))</span>
    <span class="n">im_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_top</span><span class="p">))</span>
    <span class="n">im_size</span> <span class="o">=</span> <span class="n">im_width</span><span class="p">,</span> <span class="n">im_height</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Image size: </span><span class="si">{</span><span class="n">im_size</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">canvas</span> <span class="o">=</span> <span class="n">Canvas</span><span class="p">(</span><span class="n">im_size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">)</span>

    <span class="c1"># Set some parameters for formatting feeds</span>
    <span class="n">line_spacing</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">line_height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_line_height</span><span class="p">()</span> <span class="o">+</span> <span class="n">line_spacing</span>
    <span class="n">line_width</span> <span class="o">=</span> <span class="n">im_width</span>
    <span class="n">max_lines</span> <span class="o">=</span> <span class="n">im_height</span> <span class="o">//</span> <span class="n">line_height</span>

    <span class="c1"># Calculate padding from top so the lines look centralised</span>
    <span class="n">spacing_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_height</span> <span class="o">%</span> <span class="n">line_height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Calculate line_positions</span>
    <span class="n">line_positions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">spacing_top</span> <span class="o">+</span> <span class="n">_</span> <span class="o">*</span> <span class="n">line_height</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_lines</span><span class="p">)]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_request</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Detected http path, making request&quot;</span><span class="p">)</span>
        <span class="c1"># Check if internet is available</span>
        <span class="k">if</span> <span class="n">internet_available</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Connection test passed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NetworkNotReachableError</span>
        <span class="n">file_content</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Create list containing all lines</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file_content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="c1"># Split content by lines if not making a request</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_request</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">file_content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">text_wrap</span><span class="p">(</span><span class="n">file_content</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">im_width</span><span class="p">)</span>

    <span class="c1"># Trim down the list to the max number of lines</span>
    <span class="k">del</span> <span class="n">lines</span><span class="p">[</span><span class="n">max_lines</span><span class="p">:]</span>

    <span class="c1"># Write feeds on image</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="n">line_positions</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
            <span class="n">box_size</span><span class="o">=</span><span class="p">(</span><span class="n">line_width</span><span class="p">,</span> <span class="n">line_height</span><span class="p">),</span>
            <span class="n">text</span><span class="o">=</span><span class="n">line</span><span class="p">,</span>
            <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span>
        <span class="p">)</span>

    <span class="c1"># return images</span>
    <span class="k">return</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_black</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">image_colour</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />
<h1 id="display-api">ðŸ–¥ Display API<a class="headerlink" href="#display-api" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="inkycal.display.display"></a>
    <div class="doc doc-contents first">

        <p>Inkycal ePaper Display Driver Abstraction</p>
<p>This module provides the high-level Display class used by Inkycal for rendering
images on supported E-Paper displays. It dynamically loads the appropriate
hardware driver based on the selected model and provides:</p>
<ul>
<li>Rendering black/white or black/white/colour images</li>
<li>Automatic fallback checks</li>
<li>Display calibration</li>
<li>Utility helpers for accessing supported display models</li>
</ul>
<p>All hardware driver implementations are expected to provide a <code>EPD</code> class with
methods:</p>
<ul>
<li><code>init()</code></li>
<li><code>display(buffer_black, buffer_colour=None)</code></li>
<li><code>getbuffer(image)</code></li>
<li><code>sleep()</code></li>
</ul>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.display.display.Display" class="doc doc-heading">
            <code>Display</code>


<a href="#inkycal.display.display.Display" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



        <p>High-level interface for rendering images on an ePaper display.</p>
<p>The Display class wraps the low-level hardware driver for the selected
E-Paper model and offers simplified rendering and calibration routines.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>epaper_model</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the display model, e.g. <code>"waveshare_7in5_colour"</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the driver module cannot be imported or if SPI appears</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/display/display.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Display</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;High-level interface for rendering images on an ePaper display.</span>

<span class="sd">    The Display class wraps the low-level hardware driver for the selected</span>
<span class="sd">    E-Paper model and offers simplified rendering and calibration routines.</span>

<span class="sd">    Args:</span>
<span class="sd">        epaper_model (str):</span>
<span class="sd">            Name of the display model, e.g. ``&quot;waveshare_7in5_colour&quot;``.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If the driver module cannot be imported or if SPI appears</span>
<span class="sd">        unavailable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># Initialization</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epaper_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load and initialize the driver for the given E-Paper model.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">supports_colour</span> <span class="o">=</span> <span class="s2">&quot;colour&quot;</span> <span class="ow">in</span> <span class="n">epaper_model</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">driver</span> <span class="o">=</span> <span class="n">import_driver</span><span class="p">(</span><span class="n">epaper_model</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_epaper</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">EPD</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">epaper_model</span>

        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Display model &#39;</span><span class="si">{</span><span class="n">epaper_model</span><span class="si">}</span><span class="s2">&#39; is not supported. &quot;</span>
                <span class="s2">&quot;Check spelling or supported models list.&quot;</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;SPI interface could not be initialized. &quot;</span>
                <span class="s2">&quot;Ensure SPI is enabled on your system.&quot;</span>
            <span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># Rendering</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">im_black</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">im_colour</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render one or two images on the selected E-Paper display.</span>

<span class="sd">        Args:</span>
<span class="sd">            im_black (PIL.Image):</span>
<span class="sd">                The image representing black pixels. Required for **all**</span>
<span class="sd">                supported E-Paper types. Anything non-white becomes black.</span>

<span class="sd">            im_colour (PIL.Image, optional):</span>
<span class="sd">                The image representing colour pixels (red/yellow). Required only</span>
<span class="sd">                when the selected display supports colour. Anything non-white</span>
<span class="sd">                becomes coloured.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: If a colour display is used without ``im_colour``.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Rendering a black-white image:</span>

<span class="sd">            &gt;&gt;&gt; img = Image.open(&quot;image.png&quot;)</span>
<span class="sd">            &gt;&gt;&gt; disp = Display(&quot;waveshare_7in5&quot;)</span>
<span class="sd">            &gt;&gt;&gt; disp.render(img)</span>

<span class="sd">            Rendering black-white on a colour display:</span>

<span class="sd">            &gt;&gt;&gt; img = Image.open(&quot;image.png&quot;)</span>
<span class="sd">            &gt;&gt;&gt; disp = Display(&quot;waveshare_7in5_colour&quot;)</span>
<span class="sd">            &gt;&gt;&gt; disp.render(img, img)</span>

<span class="sd">            Rendering fully separated black + colour channels:</span>

<span class="sd">            &gt;&gt;&gt; bw = Image.open(&quot;bw.png&quot;)</span>
<span class="sd">            &gt;&gt;&gt; col = Image.open(&quot;col.png&quot;)</span>
<span class="sd">            &gt;&gt;&gt; disp.render(bw, col)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">epaper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epaper</span>

        <span class="c1"># Initialize and update</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initialising..&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">epaper</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Updating display......&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">supports_colour</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">im_colour</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="s2">&quot;im_colour is required for colour E-Paper displays.&quot;</span>
                <span class="p">)</span>
            <span class="n">epaper</span><span class="o">.</span><span class="n">display</span><span class="p">(</span>
                <span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">im_black</span><span class="p">),</span>
                <span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">im_colour</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">epaper</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">im_black</span><span class="p">))</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">)</span>

        <span class="c1"># Put display into deep sleep to reduce ghosting and power usage</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sending E-Paper to deep sleep...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">epaper</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># Calibration</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">calibrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycles</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calibrate the display to reduce ghosting and restore contrast.</span>

<span class="sd">        Performs repeated full-screen refresh cycles using black/white or</span>
<span class="sd">        black/white/colour depending on the display type.</span>

<span class="sd">        Args:</span>
<span class="sd">            cycles (int):</span>
<span class="sd">                Number of calibration cycles. More cycles produce cleaner</span>
<span class="sd">                results but take longer.</span>

<span class="sd">        Notes:</span>
<span class="sd">            - Black/white displays: ~10 minutes for 3 cycles.</span>
<span class="sd">            - Colour displays: ~20 minutes for 3 cycles.</span>
<span class="sd">            - Recommended: run calibration every **~6 updates**.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If display initialization fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">epaper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epaper</span>
        <span class="n">epaper</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

        <span class="n">display_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_display_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span>

        <span class="n">white</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">display_size</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
        <span class="n">black</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">display_size</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------- Starting calibration ----------&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">supports_colour</span><span class="p">:</span>
            <span class="c1"># black â†’ colour â†’ white</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cycles</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cycle </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">cycles</span><span class="si">}</span><span class="s2">: black...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">epaper</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">black</span><span class="p">),</span> <span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">white</span><span class="p">))</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;colour...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">epaper</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">white</span><span class="p">),</span> <span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">black</span><span class="p">))</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;white...&quot;</span><span class="p">)</span>
                <span class="n">epaper</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">white</span><span class="p">),</span> <span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">white</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># black â†’ white</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cycles</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cycle </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">cycles</span><span class="si">}</span><span class="s2">: black...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="n">epaper</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">black</span><span class="p">))</span>

                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;white...&quot;</span><span class="p">)</span>
                <span class="n">epaper</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">white</span><span class="p">))</span>

            <span class="n">epaper</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------- Calibration complete ----------&quot;</span><span class="p">)</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># Display information helpers</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_display_size</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the pixel size of a supported display.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name (str):</span>
<span class="sd">                Display model identifier (key in ``supported_models``).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[int, int]: The display resolution as ``(width, height)``.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AssertionError: If the model is not found.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; Display.get_display_size(&quot;waveshare_7in5&quot;)</span>
<span class="sd">            (800, 480)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">supported_models</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">supported_models</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>

        <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; not found in supported models&quot;</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_display_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a list of all supported E-Paper model names.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: All supported display identifiers.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; Display.get_display_names()</span>
<span class="sd">            [&#39;waveshare_7in5&#39;, &#39;waveshare_7in5_colour&#39;, ...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">supported_models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="c1"># Utility: simple text rendering</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">render_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">font_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span> <span class="n">max_width_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render a centered, auto-wrapped text message on the display.</span>

<span class="sd">        This is primarily used for setup messages, error reporting,</span>
<span class="sd">        or simple system notifications.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str):</span>
<span class="sd">                Text to display. Auto-wrapped to fit screen width.</span>

<span class="sd">            font_size (int):</span>
<span class="sd">                Base font size used to render text.</span>

<span class="sd">            max_width_ratio (float):</span>
<span class="sd">                Maximum fraction of screen width allowed for text lines.</span>

<span class="sd">        Raises:</span>
<span class="sd">            Exception: If the display cannot be initialized or rendered.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; disp = Display(&quot;waveshare_7in5&quot;)</span>
<span class="sd">            &gt;&gt;&gt; disp.render_text(&quot;Hello world!&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImageDraw</span><span class="p">,</span> <span class="n">ImageFont</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">inkycal.utils.enums</span><span class="w"> </span><span class="kn">import</span> <span class="n">FONTS</span>

        <span class="c1"># Fetch resolution (Inkycal rotates images internally)</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_display_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span>

        <span class="c1"># Load font</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="n">FONTS</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">font_size</span><span class="p">)</span>

        <span class="c1"># Temporary canvas for measurements</span>
        <span class="n">temp_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
        <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">temp_img</span><span class="p">)</span>

        <span class="c1"># Helper: measure text line</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">measure</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">textbbox</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">line</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">max_width_px</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">max_width_ratio</span><span class="p">)</span>

        <span class="c1"># Auto-wrap</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
            <span class="n">test</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current</span> <span class="o">+</span> <span class="p">[</span><span class="n">word</span><span class="p">])</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">measure</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">w</span> <span class="o">&lt;=</span> <span class="n">max_width_px</span><span class="p">:</span>
                <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>
                <span class="n">current</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">current</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>

        <span class="c1"># Measure block height</span>
        <span class="n">line_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">measure</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
        <span class="n">total_height</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">h</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">line_sizes</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="n">total_height</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="c1"># Final BW image</span>
        <span class="n">img_bw</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
        <span class="n">draw_final</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">img_bw</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">line_sizes</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">draw_final</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">line</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">+=</span> <span class="n">h</span>

        <span class="c1"># Dummy colour channel</span>
        <span class="n">img_colour</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">img_bw</span><span class="p">,</span> <span class="n">img_colour</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.display.display.Display.__init__" class="doc doc-heading">
            <code class=" language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">epaper_model</span><span class="p">)</span></code>

<a href="#inkycal.display.display.Display.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load and initialize the driver for the given E-Paper model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/display/display.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epaper_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load and initialize the driver for the given E-Paper model.&quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">supports_colour</span> <span class="o">=</span> <span class="s2">&quot;colour&quot;</span> <span class="ow">in</span> <span class="n">epaper_model</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">driver</span> <span class="o">=</span> <span class="n">import_driver</span><span class="p">(</span><span class="n">epaper_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_epaper</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">EPD</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">epaper_model</span>

    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Display model &#39;</span><span class="si">{</span><span class="n">epaper_model</span><span class="si">}</span><span class="s2">&#39; is not supported. &quot;</span>
            <span class="s2">&quot;Check spelling or supported models list.&quot;</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
            <span class="s2">&quot;SPI interface could not be initialized. &quot;</span>
            <span class="s2">&quot;Ensure SPI is enabled on your system.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.display.display.Display.calibrate" class="doc doc-heading">
            <code class=" language-python"><span class="n">calibrate</span><span class="p">(</span><span class="n">cycles</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

<a href="#inkycal.display.display.Display.calibrate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calibrate the display to reduce ghosting and restore contrast.</p>
<p>Performs repeated full-screen refresh cycles using black/white or
black/white/colour depending on the display type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cycles</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of calibration cycles. More cycles produce cleaner
results but take longer.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Black/white displays: ~10 minutes for 3 cycles.</li>
<li>Colour displays: ~20 minutes for 3 cycles.</li>
<li>Recommended: run calibration every <strong>~6 updates</strong>.</li>
</ul>
</details>

<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="RuntimeError">RuntimeError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If display initialization fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/display/display.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calibrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cycles</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calibrate the display to reduce ghosting and restore contrast.</span>

<span class="sd">    Performs repeated full-screen refresh cycles using black/white or</span>
<span class="sd">    black/white/colour depending on the display type.</span>

<span class="sd">    Args:</span>
<span class="sd">        cycles (int):</span>
<span class="sd">            Number of calibration cycles. More cycles produce cleaner</span>
<span class="sd">            results but take longer.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Black/white displays: ~10 minutes for 3 cycles.</span>
<span class="sd">        - Colour displays: ~20 minutes for 3 cycles.</span>
<span class="sd">        - Recommended: run calibration every **~6 updates**.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If display initialization fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">epaper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epaper</span>
    <span class="n">epaper</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

    <span class="n">display_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_display_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span>

    <span class="n">white</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">display_size</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="n">black</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="n">display_size</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------- Starting calibration ----------&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">supports_colour</span><span class="p">:</span>
        <span class="c1"># black â†’ colour â†’ white</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cycles</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cycle </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">cycles</span><span class="si">}</span><span class="s2">: black...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">epaper</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">black</span><span class="p">),</span> <span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">white</span><span class="p">))</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;colour...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">epaper</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">white</span><span class="p">),</span> <span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">black</span><span class="p">))</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;white...&quot;</span><span class="p">)</span>
            <span class="n">epaper</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">white</span><span class="p">),</span> <span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">white</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># black â†’ white</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cycles</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cycle </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">cycles</span><span class="si">}</span><span class="s2">: black...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">epaper</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">black</span><span class="p">))</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;white...&quot;</span><span class="p">)</span>
            <span class="n">epaper</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">white</span><span class="p">))</span>

        <span class="n">epaper</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------- Calibration complete ----------&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.display.display.Display.get_display_names" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_display_names</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#inkycal.display.display.Display.get_display_names" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return a list of all supported E-Paper model names.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: All supported display identifiers.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>Display.get_display_names()
['waveshare_7in5', 'waveshare_7in5_colour', ...]</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/display/display.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_display_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a list of all supported E-Paper model names.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: All supported display identifiers.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; Display.get_display_names()</span>
<span class="sd">        [&#39;waveshare_7in5&#39;, &#39;waveshare_7in5_colour&#39;, ...]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">supported_models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.display.display.Display.get_display_size" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_display_size</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#inkycal.display.display.Display.get_display_size" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the pixel size of a supported display.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Display model identifier (key in <code>supported_models</code>).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[int, int]: The display resolution as <code>(width, height)</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="AssertionError">AssertionError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the model is not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>Display.get_display_size("waveshare_7in5")
(800, 480)</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/display/display.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_display_size</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the pixel size of a supported display.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_name (str):</span>
<span class="sd">            Display model identifier (key in ``supported_models``).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[int, int]: The display resolution as ``(width, height)``.</span>

<span class="sd">    Raises:</span>
<span class="sd">        AssertionError: If the model is not found.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; Display.get_display_size(&quot;waveshare_7in5&quot;)</span>
<span class="sd">        (800, 480)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">supported_models</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">supported_models</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>

    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&#39; not found in supported models&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.display.display.Display.render" class="doc doc-heading">
            <code class=" language-python"><span class="n">render</span><span class="p">(</span><span class="n">im_black</span><span class="p">,</span> <span class="n">im_colour</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#inkycal.display.display.Display.render" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Render one or two images on the selected E-Paper display.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>im_black</code>
            </td>
            <td>
                  <code><span title="PIL.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The image representing black pixels. Required for <strong>all</strong>
supported E-Paper types. Anything non-white becomes black.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>im_colour</code>
            </td>
            <td>
                  <code><span title="PIL.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The image representing colour pixels (red/yellow). Required only
when the selected display supports colour. Anything non-white
becomes coloured.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If a colour display is used without <code>im_colour</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Examples:</span></p>
    <p>Rendering a black-white image:</p>
    <div class="codehilite"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;image.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">disp</span> <span class="o">=</span> <span class="n">Display</span><span class="p">(</span><span class="s2">&quot;waveshare_7in5&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">disp</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</code></pre></div>
    <p>Rendering black-white on a colour display:</p>
    <div class="codehilite"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;image.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">disp</span> <span class="o">=</span> <span class="n">Display</span><span class="p">(</span><span class="s2">&quot;waveshare_7in5_colour&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">disp</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">img</span><span class="p">)</span>
</code></pre></div>
    <p>Rendering fully separated black + colour channels:</p>
    <div class="codehilite"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">bw</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;bw.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">col</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;col.png&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">disp</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">bw</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</code></pre></div>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/display/display.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">im_black</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">im_colour</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render one or two images on the selected E-Paper display.</span>

<span class="sd">    Args:</span>
<span class="sd">        im_black (PIL.Image):</span>
<span class="sd">            The image representing black pixels. Required for **all**</span>
<span class="sd">            supported E-Paper types. Anything non-white becomes black.</span>

<span class="sd">        im_colour (PIL.Image, optional):</span>
<span class="sd">            The image representing colour pixels (red/yellow). Required only</span>
<span class="sd">            when the selected display supports colour. Anything non-white</span>
<span class="sd">            becomes coloured.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If a colour display is used without ``im_colour``.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Rendering a black-white image:</span>

<span class="sd">        &gt;&gt;&gt; img = Image.open(&quot;image.png&quot;)</span>
<span class="sd">        &gt;&gt;&gt; disp = Display(&quot;waveshare_7in5&quot;)</span>
<span class="sd">        &gt;&gt;&gt; disp.render(img)</span>

<span class="sd">        Rendering black-white on a colour display:</span>

<span class="sd">        &gt;&gt;&gt; img = Image.open(&quot;image.png&quot;)</span>
<span class="sd">        &gt;&gt;&gt; disp = Display(&quot;waveshare_7in5_colour&quot;)</span>
<span class="sd">        &gt;&gt;&gt; disp.render(img, img)</span>

<span class="sd">        Rendering fully separated black + colour channels:</span>

<span class="sd">        &gt;&gt;&gt; bw = Image.open(&quot;bw.png&quot;)</span>
<span class="sd">        &gt;&gt;&gt; col = Image.open(&quot;col.png&quot;)</span>
<span class="sd">        &gt;&gt;&gt; disp.render(bw, col)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">epaper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epaper</span>

    <span class="c1"># Initialize and update</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Initialising..&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">epaper</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Updating display......&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">supports_colour</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">im_colour</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s2">&quot;im_colour is required for colour E-Paper displays.&quot;</span>
            <span class="p">)</span>
        <span class="n">epaper</span><span class="o">.</span><span class="n">display</span><span class="p">(</span>
            <span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">im_black</span><span class="p">),</span>
            <span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">im_colour</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">epaper</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">epaper</span><span class="o">.</span><span class="n">getbuffer</span><span class="p">(</span><span class="n">im_black</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">)</span>

    <span class="c1"># Put display into deep sleep to reduce ghosting and power usage</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sending E-Paper to deep sleep...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">epaper</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.display.display.Display.render_text" class="doc doc-heading">
            <code class=" language-python"><span class="n">render_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">max_width_ratio</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span></code>

<a href="#inkycal.display.display.Display.render_text" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Render a centered, auto-wrapped text message on the display.</p>
<p>This is primarily used for setup messages, error reporting,
or simple system notifications.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text to display. Auto-wrapped to fit screen width.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>font_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base font size used to render text.</p>
              </div>
            </td>
            <td>
                  <code>24</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_width_ratio</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum fraction of screen width allowed for text lines.</p>
              </div>
            </td>
            <td>
                  <code>0.95</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the display cannot be initialized or rendered.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>disp = Display("waveshare_7in5")
disp.render_text("Hello world!")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/display/display.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">render_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">font_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span> <span class="n">max_width_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render a centered, auto-wrapped text message on the display.</span>

<span class="sd">    This is primarily used for setup messages, error reporting,</span>
<span class="sd">    or simple system notifications.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str):</span>
<span class="sd">            Text to display. Auto-wrapped to fit screen width.</span>

<span class="sd">        font_size (int):</span>
<span class="sd">            Base font size used to render text.</span>

<span class="sd">        max_width_ratio (float):</span>
<span class="sd">            Maximum fraction of screen width allowed for text lines.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If the display cannot be initialized or rendered.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; disp = Display(&quot;waveshare_7in5&quot;)</span>
<span class="sd">        &gt;&gt;&gt; disp.render_text(&quot;Hello world!&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImageDraw</span><span class="p">,</span> <span class="n">ImageFont</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">inkycal.utils.enums</span><span class="w"> </span><span class="kn">import</span> <span class="n">FONTS</span>

    <span class="c1"># Fetch resolution (Inkycal rotates images internally)</span>
    <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_display_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">)</span>

    <span class="c1"># Load font</span>
    <span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="n">FONTS</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">font_size</span><span class="p">)</span>

    <span class="c1"># Temporary canvas for measurements</span>
    <span class="n">temp_img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">temp_img</span><span class="p">)</span>

    <span class="c1"># Helper: measure text line</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">measure</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">draw</span><span class="o">.</span><span class="n">textbbox</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">line</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">max_width_px</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">max_width_ratio</span><span class="p">)</span>

    <span class="c1"># Auto-wrap</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="n">test</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current</span> <span class="o">+</span> <span class="p">[</span><span class="n">word</span><span class="p">])</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">measure</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">w</span> <span class="o">&lt;=</span> <span class="n">max_width_px</span><span class="p">:</span>
            <span class="n">current</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>
            <span class="n">current</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">current</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current</span><span class="p">))</span>

    <span class="c1"># Measure block height</span>
    <span class="n">line_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">measure</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
    <span class="n">total_height</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">h</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">line_sizes</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="n">total_height</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="c1"># Final BW image</span>
    <span class="n">img_bw</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="n">draw_final</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">img_bw</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">line_sizes</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">draw_final</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">line</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">h</span>

    <span class="c1"># Dummy colour channel</span>
    <span class="n">img_colour</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">img_bw</span><span class="p">,</span> <span class="n">img_colour</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="inkycal.display.display.import_driver" class="doc doc-heading">
            <code class=" language-python"><span class="n">import_driver</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></code>

<a href="#inkycal.display.display.import_driver" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Dynamically import a driver module for the given display model.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/display/display.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">import_driver</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dynamically import a driver module for the given display model.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">import_module</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;inkycal.display.drivers.</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />
<h1 id="canvas-api">ðŸŽ¨ Canvas API<a class="headerlink" href="#canvas-api" title="Permanent link">&para;</a></h1>
<p>This is one of the most important components of Inkycal.<br />
It is used to render text, icons, shapes, and previews.</p>
<p>Auto-generate docs:</p>


<div class="doc doc-object doc-module">



<a id="inkycal.utils.canvas"></a>
    <div class="doc doc-contents first">

        <p>canvas.py</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="inkycal.utils.canvas.Canvas" class="doc doc-heading">
            <code>Canvas</code>


<a href="#inkycal.utils.canvas.Canvas" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">



        <p>Canvas class of Inkycal. Set this up once and use to draw text on a PIL Image.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>inkycal/utils/canvas.py</code></summary>
                <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Canvas</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Canvas class of Inkycal. Set this up once and use to draw text on a PIL Image.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">im_size</span><span class="p">:</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">font</span><span class="p">:</span> <span class="n">FONTS</span><span class="p">,</span> <span class="n">font_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="n">font</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">font_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_enum</span> <span class="o">=</span> <span class="n">font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_font_size</span> <span class="o">=</span> <span class="n">font_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_black</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_colour</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">im_size</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">set_font_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the font size to use&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_font_size</span> <span class="o">=</span> <span class="n">font_size</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">font_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font_size</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_black</span><span class="o">.</span><span class="n">size</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">:</span><span class="n">FONTS</span><span class="p">,</span> <span class="n">font_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_enum</span> <span class="o">=</span> <span class="n">font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">truetype</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">font_size</span> <span class="k">if</span> <span class="n">font_size</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font_size</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">font</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FONTS</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_enum</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">xy</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
            <span class="n">box_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
            <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="o">*</span><span class="p">,</span>
            <span class="n">alignment</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">autofit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">colour</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;colour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">rotation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">fill_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">fill_height</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write (possibly multi-line) text inside a rectangle.</span>
<span class="sd">        Supports &#39;\n&#39; and auto-wrapping inside each line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">box_x</span><span class="p">,</span> <span class="n">box_y</span> <span class="o">=</span> <span class="n">xy</span>
        <span class="n">box_w</span><span class="p">,</span> <span class="n">box_h</span> <span class="o">=</span> <span class="n">box_size</span>

        <span class="n">font_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_enum</span><span class="o">.</span><span class="n">value</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font_size</span>

        <span class="c1"># ----------------------------</span>
        <span class="c1"># 1) Auto-fit the font size</span>
        <span class="c1"># ----------------------------</span>
        <span class="k">if</span> <span class="n">autofit</span> <span class="ow">or</span> <span class="p">(</span><span class="n">fill_width</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">fill_height</span> <span class="o">!=</span> <span class="mf">0.8</span><span class="p">):</span>
            <span class="n">size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">font</span> <span class="o">=</span> <span class="n">_load_font</span><span class="p">(</span><span class="n">font_path</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

                <span class="c1"># measure test height with 1-line sample</span>
                <span class="n">sample_h</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="s2">&quot;Ag&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="s2">&quot;Ag&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">sample_h</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">box_h</span> <span class="o">*</span> <span class="n">fill_height</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="n">font</span> <span class="o">=</span> <span class="n">_load_font</span><span class="p">(</span><span class="n">font_path</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
                    <span class="k">break</span>

                <span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_font_size</span> <span class="o">=</span> <span class="n">size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_font</span> <span class="o">=</span> <span class="n">font</span>

        <span class="c1"># ----------------------------</span>
        <span class="c1"># 2) Split text into logical lines</span>
        <span class="c1"># ----------------------------</span>
        <span class="n">logical_lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># ----------------------------</span>
        <span class="c1"># 3) Wrap each line to the box width</span>
        <span class="c1"># ----------------------------</span>
        <span class="n">wrapped_lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">logical_lines</span><span class="p">:</span>
            <span class="n">wrapped_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_wrap</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">box_w</span> <span class="o">*</span> <span class="n">fill_width</span><span class="p">)))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">wrapped_lines</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># ----------------------------</span>
        <span class="c1"># 4) Measure combined height</span>
        <span class="c1"># ----------------------------</span>
        <span class="n">line_heights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_h</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">wrapped_lines</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">line_heights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
            <span class="n">total_h</span> <span class="o">+=</span> <span class="n">h</span>

        <span class="c1"># add minimal line spacing (you can tune this)</span>
        <span class="n">line_spacing</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">font</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">total_h</span> <span class="o">+=</span> <span class="n">line_spacing</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wrapped_lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># If text block too tall â†’ truncate bottom lines</span>
        <span class="k">while</span> <span class="n">total_h</span> <span class="o">&gt;</span> <span class="n">box_h</span> <span class="ow">and</span> <span class="n">wrapped_lines</span><span class="p">:</span>
            <span class="n">removed</span> <span class="o">=</span> <span class="n">wrapped_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">removed_h</span> <span class="o">=</span> <span class="n">line_heights</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">total_h</span> <span class="o">-=</span> <span class="p">(</span><span class="n">removed_h</span> <span class="o">+</span> <span class="n">line_spacing</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">wrapped_lines</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># ----------------------------</span>
        <span class="c1"># 5) Vertical centering</span>
        <span class="c1"># ----------------------------</span>
        <span class="n">cy</span> <span class="o">=</span> <span class="n">box_y</span> <span class="o">+</span> <span class="p">(</span><span class="n">box_h</span> <span class="o">-</span> <span class="n">total_h</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="c1"># ----------------------------</span>
        <span class="c1"># 6) Create transparent layer and draw lines</span>
        <span class="c1"># ----------------------------</span>
        <span class="n">space</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">box_w</span><span class="p">,</span> <span class="n">box_h</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>

        <span class="n">py</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">lh</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wrapped_lines</span><span class="p">,</span> <span class="n">line_heights</span><span class="p">):</span>

            <span class="c1"># horizontal alignment</span>
            <span class="n">line_w</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="n">line</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="n">line</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span>
                <span class="n">px</span> <span class="o">=</span> <span class="p">(</span><span class="n">box_w</span> <span class="o">-</span> <span class="n">line_w</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
                <span class="n">px</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
                <span class="n">px</span> <span class="o">=</span> <span class="n">box_w</span> <span class="o">-</span> <span class="n">line_w</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">px</span> <span class="o">=</span> <span class="p">(</span><span class="n">box_w</span> <span class="o">-</span> <span class="n">line_w</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

            <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">),</span> <span class="n">line</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
            <span class="n">py</span> <span class="o">+=</span> <span class="n">lh</span> <span class="o">+</span> <span class="n">line_spacing</span>

        <span class="c1"># ----------------------------</span>
        <span class="c1"># 7) Rotation + paste</span>
        <span class="c1"># ----------------------------</span>
        <span class="k">if</span> <span class="n">rotation</span><span class="p">:</span>
            <span class="n">space</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">rotation</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Always draw on black first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>

        <span class="c1"># Colour overlay if needed</span>
        <span class="k">if</span> <span class="n">colour</span> <span class="o">==</span> <span class="s2">&quot;colour&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">text_wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Split long text into wrapped lines using the Canvas&#39; current font.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: The full text to wrap.</span>
<span class="sd">            max_width: Maximum pixel width allowed per line.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of strings, each representing one wrapped line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
            <span class="c1"># Test candidate line</span>
            <span class="n">proposed</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_line</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">word</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">font</span><span class="o">.</span><span class="n">getlength</span><span class="p">(</span><span class="n">proposed</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_width</span><span class="p">:</span>
                <span class="c1"># Word fits â€” extend current line</span>
                <span class="n">current_line</span> <span class="o">=</span> <span class="n">proposed</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Word does not fit</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">current_line</span><span class="p">:</span>
                    <span class="c1"># Word itself too long: force-break</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Push current line and start a new one</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_line</span><span class="p">)</span>
                    <span class="n">current_line</span> <span class="o">=</span> <span class="n">word</span>

        <span class="c1"># Add final line</span>
        <span class="k">if</span> <span class="n">current_line</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_line</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">lines</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">auto_fontsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sample_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Ag&quot;</span><span class="p">,</span> <span class="n">target_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.80</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Automatically scale the canvas&#39; font so its height reaches ~target_ratio</span>
<span class="sd">        of the given max_height.</span>

<span class="sd">        Args:</span>
<span class="sd">            max_height (int): Maximum allowed pixel height.</span>
<span class="sd">            sample_text (str): Text used to measure font height. Default &quot;Ag&quot;.</span>
<span class="sd">            target_ratio (float): The portion of max_height the font should fill.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None â€” self.font and self._font_size are updated.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">best_size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">target_height</span> <span class="o">=</span> <span class="n">max_height</span> <span class="o">*</span> <span class="n">target_ratio</span>

        <span class="c1"># Start from the current size</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font_size</span>

        <span class="c1"># Increment font size until height overshoots target</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">_load_font</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font_enum</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="n">sample_text</span><span class="p">)</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">height</span> <span class="o">&gt;</span> <span class="n">target_height</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="n">best_size</span> <span class="o">=</span> <span class="n">size</span>
            <span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Load the chosen font size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_font_size</span> <span class="o">=</span> <span class="n">best_size</span>
        <span class="n">font_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_enum</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_font</span> <span class="o">=</span> <span class="n">_load_font</span><span class="p">(</span><span class="n">font_path</span><span class="p">,</span> <span class="n">best_size</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_line_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Ag&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the pixel line height of the currently active font.</span>
<span class="sd">        Based on ascent + descent, with a reliable fallback if unsupported.</span>

<span class="sd">        Args:</span>
<span class="sd">            sample_text (str): A sample string used to measure font height.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int â€” Line height in pixels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ascent</span><span class="p">,</span> <span class="n">descent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font</span><span class="o">.</span><span class="n">getmetrics</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">ascent</span> <span class="o">+</span> <span class="n">descent</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Fallback using bounding box</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="n">sample_text</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_text_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the rendered width of a string using the current font.</span>

<span class="sd">        Args:</span>
<span class="sd">            text (str): The text to measure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int â€” Width in pixels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">draw_icon</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">xy</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
            <span class="n">box_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
            <span class="n">icon</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">colour</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;colour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">rotation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">fill_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.90</span><span class="p">,</span>
            <span class="n">font</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FONTS</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">box_x</span><span class="p">,</span> <span class="n">box_y</span> <span class="o">=</span> <span class="n">xy</span>
        <span class="n">box_w</span><span class="p">,</span> <span class="n">box_h</span> <span class="o">=</span> <span class="n">box_size</span>

        <span class="c1"># Select icon font</span>
        <span class="n">font_enum</span> <span class="o">=</span> <span class="n">font</span> <span class="ow">or</span> <span class="n">FONTS</span><span class="o">.</span><span class="n">weather_icons</span>
        <span class="n">font_path</span> <span class="o">=</span> <span class="n">font_enum</span><span class="o">.</span><span class="n">value</span>

        <span class="c1"># --- Determine max usable size ---</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">test_font</span> <span class="o">=</span> <span class="n">_load_font</span><span class="p">(</span><span class="n">font_path</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">test_font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">w</span> <span class="o">&gt;=</span> <span class="n">box_w</span> <span class="o">*</span> <span class="n">fill_ratio</span> <span class="ow">or</span> <span class="n">h</span> <span class="o">&gt;=</span> <span class="n">box_h</span> <span class="o">*</span> <span class="n">fill_ratio</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">font_final</span> <span class="o">=</span> <span class="n">_load_font</span><span class="p">(</span><span class="n">font_path</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

        <span class="c1"># --- TEMP CANVAS FOR PIXEL ANALYSIS ---</span>
        <span class="n">temp_w</span> <span class="o">=</span> <span class="n">box_w</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">temp_h</span> <span class="o">=</span> <span class="n">box_h</span> <span class="o">*</span> <span class="mi">2</span>

        <span class="c1"># 1) Render icon for ALPHA extraction</span>
        <span class="n">temp_alpha</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">temp_w</span><span class="p">,</span> <span class="n">temp_h</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">dA</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">temp_alpha</span><span class="p">)</span>
        <span class="n">dA</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">temp_w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">temp_h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">icon</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font_final</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;mm&quot;</span><span class="p">)</span>

        <span class="c1"># Convert to numpy</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">temp_alpha</span><span class="p">)</span>

        <span class="c1"># Detect ink pixels</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">arr</span> <span class="o">&gt;</span> <span class="mi">10</span>  <span class="c1"># threshold to keep fill</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="n">ys</span><span class="p">,</span> <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="n">min_x</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">min_y</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">=</span> <span class="n">ys</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ys</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">ink_w</span> <span class="o">=</span> <span class="n">max_x</span> <span class="o">-</span> <span class="n">min_x</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">ink_h</span> <span class="o">=</span> <span class="n">max_y</span> <span class="o">-</span> <span class="n">min_y</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Extract the alpha mask for that region</span>
        <span class="n">mask_region</span> <span class="o">=</span> <span class="n">temp_alpha</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># --- 2) Render icon again as RGB fill (full-strength black) ---</span>
        <span class="n">temp_rgb</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">temp_w</span><span class="p">,</span> <span class="n">temp_h</span><span class="p">),</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
        <span class="n">dR</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">temp_rgb</span><span class="p">)</span>
        <span class="n">dR</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">temp_w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">temp_h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">icon</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font_final</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;mm&quot;</span><span class="p">)</span>

        <span class="n">rgb_region</span> <span class="o">=</span> <span class="n">temp_rgb</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="n">max_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># --- 3) Combine into RGBA for final paste ---</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">box_w</span><span class="p">,</span> <span class="n">box_h</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="n">paste_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">box_w</span> <span class="o">-</span> <span class="n">ink_w</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">paste_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">box_h</span> <span class="o">-</span> <span class="n">ink_h</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="n">layer</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">rgb_region</span><span class="p">,</span> <span class="p">(</span><span class="n">paste_x</span><span class="p">,</span> <span class="n">paste_y</span><span class="p">),</span> <span class="n">mask_region</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rotation</span><span class="p">:</span>
            <span class="n">layer</span> <span class="o">=</span> <span class="n">layer</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">rotation</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Paste to black layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">layer</span><span class="p">)</span>

        <span class="c1"># Paste to colour layer if needed</span>
        <span class="k">if</span> <span class="n">colour</span> <span class="o">==</span> <span class="s2">&quot;colour&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">layer</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_optimize_for_red_preview</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Normalize coloured-image contrast before converting to red.</span>
<span class="sd">        Dark pixels â†’ black</span>
<span class="sd">        Light pixels â†’ white</span>
<span class="sd">        Threshold-based cleanup prevents blurry thick red shapes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">red</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">green</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">blue</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Identify dark-ish pixels â†’ treat as black</span>
        <span class="n">dark_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">red</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">green</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">blue</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">)</span>

        <span class="c1"># Everything else becomes pure white</span>
        <span class="n">arr</span><span class="p">[</span><span class="o">~</span><span class="n">dark_mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">]</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">dark_mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">color_to_red</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert dark pixels to red with alpha transparency.</span>
<span class="sd">        Uses optimized thresholding for more accurate previews.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># dark = colored pixel (0,0,0) after optimization</span>
        <span class="n">dark_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Red output pixels</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">dark_mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>  <span class="c1"># R</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">dark_mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># G</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">dark_mask</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># B</span>

        <span class="c1"># Alpha channel</span>
        <span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dark_mask</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_preview_image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a black+red preview image, optimized for readability.&quot;&quot;&quot;</span>

        <span class="c1"># 1. Copy black image</span>
        <span class="n">image_black</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_black</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># 2. Optimize the colour layer first (cleans up anti-aliasing)</span>
        <span class="n">optimized_colour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_for_red_preview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_colour</span><span class="p">)</span>

        <span class="c1"># 3. Convert darkened layer to red overlay</span>
        <span class="n">image_colour_red</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_to_red</span><span class="p">(</span><span class="n">optimized_colour</span><span class="p">)</span>

        <span class="c1"># 4. Composite</span>
        <span class="n">image_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">image_colour_red</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">image_colour_red</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Preview image created (optimized black + red composite)&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image_black</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="inkycal.utils.canvas.Canvas.auto_fontsize" class="doc doc-heading">
            <code class=" language-python"><span class="n">auto_fontsize</span><span class="p">(</span><span class="n">max_height</span><span class="p">,</span> <span class="n">sample_text</span><span class="o">=</span><span class="s1">&#39;Ag&#39;</span><span class="p">,</span> <span class="n">target_ratio</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span></code>

<a href="#inkycal.utils.canvas.Canvas.auto_fontsize" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Automatically scale the canvas' font so its height reaches ~target_ratio
of the given max_height.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_height</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum allowed pixel height.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sample_text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Text used to measure font height. Default "Ag".</p>
              </div>
            </td>
            <td>
                  <code>&#39;Ag&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_ratio</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The portion of max_height the font should fill.</p>
              </div>
            </td>
            <td>
                  <code>0.8</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None â€” self.font and self._font_size are updated.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/utils/canvas.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">auto_fontsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sample_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Ag&quot;</span><span class="p">,</span> <span class="n">target_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.80</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Automatically scale the canvas&#39; font so its height reaches ~target_ratio</span>
<span class="sd">    of the given max_height.</span>

<span class="sd">    Args:</span>
<span class="sd">        max_height (int): Maximum allowed pixel height.</span>
<span class="sd">        sample_text (str): Text used to measure font height. Default &quot;Ag&quot;.</span>
<span class="sd">        target_ratio (float): The portion of max_height the font should fill.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None â€” self.font and self._font_size are updated.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">best_size</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">target_height</span> <span class="o">=</span> <span class="n">max_height</span> <span class="o">*</span> <span class="n">target_ratio</span>

    <span class="c1"># Start from the current size</span>
    <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font_size</span>

    <span class="c1"># Increment font size until height overshoots target</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">_load_font</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font_enum</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="n">sample_text</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">height</span> <span class="o">&gt;</span> <span class="n">target_height</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">best_size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Load the chosen font size</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_font_size</span> <span class="o">=</span> <span class="n">best_size</span>
    <span class="n">font_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_enum</span><span class="o">.</span><span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_font</span> <span class="o">=</span> <span class="n">_load_font</span><span class="p">(</span><span class="n">font_path</span><span class="p">,</span> <span class="n">best_size</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.utils.canvas.Canvas.color_to_red" class="doc doc-heading">
            <code class=" language-python"><span class="n">color_to_red</span><span class="p">(</span><span class="n">img</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#inkycal.utils.canvas.Canvas.color_to_red" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert dark pixels to red with alpha transparency.
Uses optimized thresholding for more accurate previews.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/utils/canvas.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">color_to_red</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert dark pixels to red with alpha transparency.</span>
<span class="sd">    Uses optimized thresholding for more accurate previews.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># dark = colored pixel (0,0,0) after optimization</span>
    <span class="n">dark_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Red output pixels</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">dark_mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>  <span class="c1"># R</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">dark_mask</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># G</span>
    <span class="n">arr</span><span class="p">[</span><span class="n">dark_mask</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># B</span>

    <span class="c1"># Alpha channel</span>
    <span class="n">arr</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">dark_mask</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.utils.canvas.Canvas.get_line_height" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_line_height</span><span class="p">(</span><span class="n">sample_text</span><span class="o">=</span><span class="s1">&#39;Ag&#39;</span><span class="p">)</span></code>

<a href="#inkycal.utils.canvas.Canvas.get_line_height" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the pixel line height of the currently active font.
Based on ascent + descent, with a reliable fallback if unsupported.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sample_text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A sample string used to measure font height.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Ag&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int â€” Line height in pixels.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/utils/canvas.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_line_height</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sample_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Ag&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the pixel line height of the currently active font.</span>
<span class="sd">    Based on ascent + descent, with a reliable fallback if unsupported.</span>

<span class="sd">    Args:</span>
<span class="sd">        sample_text (str): A sample string used to measure font height.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int â€” Line height in pixels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ascent</span><span class="p">,</span> <span class="n">descent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font</span><span class="o">.</span><span class="n">getmetrics</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ascent</span> <span class="o">+</span> <span class="n">descent</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># Fallback using bounding box</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="n">sample_text</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.utils.canvas.Canvas.get_preview_image" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_preview_image</span><span class="p">()</span></code>

<a href="#inkycal.utils.canvas.Canvas.get_preview_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Returns a black+red preview image, optimized for readability.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/utils/canvas.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_preview_image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a black+red preview image, optimized for readability.&quot;&quot;&quot;</span>

    <span class="c1"># 1. Copy black image</span>
    <span class="n">image_black</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_black</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># 2. Optimize the colour layer first (cleans up anti-aliasing)</span>
    <span class="n">optimized_colour</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_for_red_preview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_colour</span><span class="p">)</span>

    <span class="c1"># 3. Convert darkened layer to red overlay</span>
    <span class="n">image_colour_red</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_to_red</span><span class="p">(</span><span class="n">optimized_colour</span><span class="p">)</span>

    <span class="c1"># 4. Composite</span>
    <span class="n">image_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">image_colour_red</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">image_colour_red</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Preview image created (optimized black + red composite)&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image_black</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.utils.canvas.Canvas.get_text_width" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_text_width</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>

<a href="#inkycal.utils.canvas.Canvas.get_text_width" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the rendered width of a string using the current font.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The text to measure.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int â€” Width in pixels.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/utils/canvas.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_text_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the rendered width of a string using the current font.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): The text to measure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int â€” Width in pixels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.utils.canvas.Canvas.set_font_size" class="doc doc-heading">
            <code class=" language-python"><span class="n">set_font_size</span><span class="p">(</span><span class="n">font_size</span><span class="p">)</span></code>

<a href="#inkycal.utils.canvas.Canvas.set_font_size" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Set the font size to use</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/utils/canvas.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_font_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the font size to use&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_font_size</span> <span class="o">=</span> <span class="n">font_size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.utils.canvas.Canvas.text_wrap" class="doc doc-heading">
            <code class=" language-python"><span class="n">text_wrap</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">max_width</span><span class="p">)</span></code>

<a href="#inkycal.utils.canvas.Canvas.text_wrap" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Split long text into wrapped lines using the Canvas' current font.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The full text to wrap.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_width</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum pixel width allowed per line.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of strings, each representing one wrapped line.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/utils/canvas.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">text_wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split long text into wrapped lines using the Canvas&#39; current font.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: The full text to wrap.</span>
<span class="sd">        max_width: Maximum pixel width allowed per line.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of strings, each representing one wrapped line.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">current_line</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="c1"># Test candidate line</span>
        <span class="n">proposed</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_line</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">word</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">font</span><span class="o">.</span><span class="n">getlength</span><span class="p">(</span><span class="n">proposed</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_width</span><span class="p">:</span>
            <span class="c1"># Word fits â€” extend current line</span>
            <span class="n">current_line</span> <span class="o">=</span> <span class="n">proposed</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Word does not fit</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">current_line</span><span class="p">:</span>
                <span class="c1"># Word itself too long: force-break</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Push current line and start a new one</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_line</span><span class="p">)</span>
                <span class="n">current_line</span> <span class="o">=</span> <span class="n">word</span>

    <span class="c1"># Add final line</span>
    <span class="k">if</span> <span class="n">current_line</span><span class="p">:</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_line</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lines</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="inkycal.utils.canvas.Canvas.write" class="doc doc-heading">
            <code class=" language-python"><span class="n">write</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">box_size</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">autofit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colour</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">fill_height</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span></code>

<a href="#inkycal.utils.canvas.Canvas.write" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <div class="codehilite"><pre><span></span><code>    Write (possibly multi-line) text inside a rectangle.
    Supports &#39;
</code></pre></div>

<p>' and auto-wrapping inside each line.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/utils/canvas.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">xy</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">box_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">alignment</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">autofit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">colour</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;colour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">rotation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fill_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">fill_height</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write (possibly multi-line) text inside a rectangle.</span>
<span class="sd">    Supports &#39;\n&#39; and auto-wrapping inside each line.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">box_x</span><span class="p">,</span> <span class="n">box_y</span> <span class="o">=</span> <span class="n">xy</span>
    <span class="n">box_w</span><span class="p">,</span> <span class="n">box_h</span> <span class="o">=</span> <span class="n">box_size</span>

    <span class="n">font_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_enum</span><span class="o">.</span><span class="n">value</span>
    <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font</span>
    <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font_size</span>

    <span class="c1"># ----------------------------</span>
    <span class="c1"># 1) Auto-fit the font size</span>
    <span class="c1"># ----------------------------</span>
    <span class="k">if</span> <span class="n">autofit</span> <span class="ow">or</span> <span class="p">(</span><span class="n">fill_width</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">fill_height</span> <span class="o">!=</span> <span class="mf">0.8</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">_load_font</span><span class="p">(</span><span class="n">font_path</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

            <span class="c1"># measure test height with 1-line sample</span>
            <span class="n">sample_h</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="s2">&quot;Ag&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="s2">&quot;Ag&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">sample_h</span> <span class="o">&gt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">box_h</span> <span class="o">*</span> <span class="n">fill_height</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">font</span> <span class="o">=</span> <span class="n">_load_font</span><span class="p">(</span><span class="n">font_path</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_font_size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_font</span> <span class="o">=</span> <span class="n">font</span>

    <span class="c1"># ----------------------------</span>
    <span class="c1"># 2) Split text into logical lines</span>
    <span class="c1"># ----------------------------</span>
    <span class="n">logical_lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># ----------------------------</span>
    <span class="c1"># 3) Wrap each line to the box width</span>
    <span class="c1"># ----------------------------</span>
    <span class="n">wrapped_lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">logical_lines</span><span class="p">:</span>
        <span class="n">wrapped_lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text_wrap</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">box_w</span> <span class="o">*</span> <span class="n">fill_width</span><span class="p">)))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">wrapped_lines</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># ----------------------------</span>
    <span class="c1"># 4) Measure combined height</span>
    <span class="c1"># ----------------------------</span>
    <span class="n">line_heights</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">total_h</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">wrapped_lines</span><span class="p">:</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">line_heights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">total_h</span> <span class="o">+=</span> <span class="n">h</span>

    <span class="c1"># add minimal line spacing (you can tune this)</span>
    <span class="n">line_spacing</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">font</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>
    <span class="n">total_h</span> <span class="o">+=</span> <span class="n">line_spacing</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wrapped_lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># If text block too tall â†’ truncate bottom lines</span>
    <span class="k">while</span> <span class="n">total_h</span> <span class="o">&gt;</span> <span class="n">box_h</span> <span class="ow">and</span> <span class="n">wrapped_lines</span><span class="p">:</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="n">wrapped_lines</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">removed_h</span> <span class="o">=</span> <span class="n">line_heights</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">total_h</span> <span class="o">-=</span> <span class="p">(</span><span class="n">removed_h</span> <span class="o">+</span> <span class="n">line_spacing</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">wrapped_lines</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># ----------------------------</span>
    <span class="c1"># 5) Vertical centering</span>
    <span class="c1"># ----------------------------</span>
    <span class="n">cy</span> <span class="o">=</span> <span class="n">box_y</span> <span class="o">+</span> <span class="p">(</span><span class="n">box_h</span> <span class="o">-</span> <span class="n">total_h</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="c1"># ----------------------------</span>
    <span class="c1"># 6) Create transparent layer and draw lines</span>
    <span class="c1"># ----------------------------</span>
    <span class="n">space</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">box_w</span><span class="p">,</span> <span class="n">box_h</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>

    <span class="n">py</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">line</span><span class="p">,</span> <span class="n">lh</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wrapped_lines</span><span class="p">,</span> <span class="n">line_heights</span><span class="p">):</span>

        <span class="c1"># horizontal alignment</span>
        <span class="n">line_w</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="n">line</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">font</span><span class="o">.</span><span class="n">getbbox</span><span class="p">(</span><span class="n">line</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;center&quot;</span><span class="p">:</span>
            <span class="n">px</span> <span class="o">=</span> <span class="p">(</span><span class="n">box_w</span> <span class="o">-</span> <span class="n">line_w</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
            <span class="n">px</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">alignment</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
            <span class="n">px</span> <span class="o">=</span> <span class="n">box_w</span> <span class="o">-</span> <span class="n">line_w</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">px</span> <span class="o">=</span> <span class="p">(</span><span class="n">box_w</span> <span class="o">-</span> <span class="n">line_w</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">),</span> <span class="n">line</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
        <span class="n">py</span> <span class="o">+=</span> <span class="n">lh</span> <span class="o">+</span> <span class="n">line_spacing</span>

    <span class="c1"># ----------------------------</span>
    <span class="c1"># 7) Rotation + paste</span>
    <span class="c1"># ----------------------------</span>
    <span class="k">if</span> <span class="n">rotation</span><span class="p">:</span>
        <span class="n">space</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">rotation</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Always draw on black first</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">image_black</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>

    <span class="c1"># Colour overlay if needed</span>
    <span class="k">if</span> <span class="n">colour</span> <span class="o">==</span> <span class="s2">&quot;colour&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_colour</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />
<h1 id="utility-functions">ðŸ”§ Utility Functions<a class="headerlink" href="#utility-functions" title="Permanent link">&para;</a></h1>
<h3 id="general-utils">General Utils<a class="headerlink" href="#general-utils" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.utils.functions"></a>
    <div class="doc doc-contents first">

        <p>Utility Functions for Inkycal</p>
<p>This module contains small standalone helpers used throughout the Inkycal
framework. These functions handle tasks such as timezone detection, network
availability checks, simple drawing helpers, and generating lightweight charts.</p>
<p>These utilities are intentionally framework-agnostic and can be used inside
modules, during setup, or anywhere Inkycal requires common functionality.</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="inkycal.utils.functions.draw_border" class="doc doc-heading">
            <code class=" language-python"><span class="n">draw_border</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shrinkage</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">))</span></code>

<a href="#inkycal.utils.functions.draw_border" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Draw a stylized border around a rectangular region.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td>
                  <code><span title="PIL.Image.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The PIL image into which the border is drawn.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xy</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Top-left corner of the border (x, y).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Width and height of the border before shrinkage is applied.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>radius</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Corner roundness. <code>0</code> creates a rectangle with sharp corners.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>thickness</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stroke width in pixels.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shrinkage</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="float">float</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Proportional shrinkage of width and height. For example:
<code>(0.1, 0.2)</code> â†’ shrink width by 10% and height by 20%.</p>
              </div>
            </td>
            <td>
                  <code>(0.1, 0.1)</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <p>This function is used by various modules (Calendar, Agenda, Feeds)
to visually highlight areas such as days with events.</p>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/utils/functions.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">draw_border</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">xy</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">thickness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">shrinkage</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw a stylized border around a rectangular region.</span>

<span class="sd">    Args:</span>
<span class="sd">        image (PIL.Image.Image):</span>
<span class="sd">            The PIL image into which the border is drawn.</span>

<span class="sd">        xy (Tuple[int, int]):</span>
<span class="sd">            Top-left corner of the border (x, y).</span>

<span class="sd">        size (Tuple[int, int]):</span>
<span class="sd">            Width and height of the border before shrinkage is applied.</span>

<span class="sd">        radius (int, optional):</span>
<span class="sd">            Corner roundness. ``0`` creates a rectangle with sharp corners.</span>

<span class="sd">        thickness (int, optional):</span>
<span class="sd">            Stroke width in pixels.</span>

<span class="sd">        shrinkage (Tuple[float, float], optional):</span>
<span class="sd">            Proportional shrinkage of width and height. For example:</span>
<span class="sd">            ``(0.1, 0.2)`` â†’ shrink width by 10% and height by 20%.</span>

<span class="sd">    Notes:</span>
<span class="sd">        This function is used by various modules (Calendar, Agenda, Feeds)</span>
<span class="sd">        to visually highlight areas such as days with events.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">colour</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>

    <span class="c1"># Apply shrinkage to box size</span>
    <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">shrinkage</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">shrinkage</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="c1"># Center correction</span>
    <span class="n">offset_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">offset_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset_x</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">offset_y</span>
    <span class="n">diameter</span> <span class="o">=</span> <span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="c1"># Core rectangle parameters</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">width</span> <span class="o">-</span> <span class="n">diameter</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">height</span> <span class="o">-</span> <span class="n">diameter</span>

    <span class="c1"># Straight line segments</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">+</span> <span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">radius</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">radius</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">p5</span><span class="p">,</span> <span class="n">p6</span> <span class="o">=</span> <span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span> <span class="o">+</span> <span class="n">height</span><span class="p">),</span> <span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span>
    <span class="n">p7</span><span class="p">,</span> <span class="n">p8</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p4</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p3</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">((</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">thickness</span><span class="p">)</span>
    <span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">((</span><span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">thickness</span><span class="p">)</span>
    <span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">((</span><span class="n">p5</span><span class="p">,</span> <span class="n">p6</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">thickness</span><span class="p">)</span>
    <span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">((</span><span class="n">p7</span><span class="p">,</span> <span class="n">p8</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">thickness</span><span class="p">)</span>

    <span class="c1"># Rounded corners</span>
    <span class="k">if</span> <span class="n">radius</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">diameter</span><span class="p">)</span>
        <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span> <span class="o">-</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">diameter</span><span class="p">)</span>
        <span class="n">c5</span><span class="p">,</span> <span class="n">c6</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span> <span class="o">-</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">height</span> <span class="o">-</span> <span class="n">diameter</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">c7</span><span class="p">,</span> <span class="n">c8</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">height</span> <span class="o">-</span> <span class="n">diameter</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">diameter</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span>

        <span class="n">draw</span><span class="o">.</span><span class="n">arc</span><span class="p">((</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">),</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">thickness</span><span class="p">)</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">arc</span><span class="p">((</span><span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">),</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">thickness</span><span class="p">)</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">arc</span><span class="p">((</span><span class="n">c5</span><span class="p">,</span> <span class="n">c6</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">thickness</span><span class="p">)</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">arc</span><span class="p">((</span><span class="n">c7</span><span class="p">,</span> <span class="n">c8</span><span class="p">),</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">colour</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">thickness</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="inkycal.utils.functions.draw_border_2" class="doc doc-heading">
            <code class=" language-python"><span class="n">draw_border_2</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">xy</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span></code>

<a href="#inkycal.utils.functions.draw_border_2" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Draw a simple rounded rectangle border using Pillow's high-level API.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/utils/functions.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">draw_border_2</span><span class="p">(</span><span class="n">im</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">xy</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Draw a simple rounded rectangle border using Pillow&#39;s high-level API.&quot;&quot;&quot;</span>
    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">size</span>
    <span class="n">draw</span><span class="o">.</span><span class="n">rounded_rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">),</span> <span class="n">outline</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="inkycal.utils.functions.get_inkycal_version" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_inkycal_version</span><span class="p">()</span></code>

<a href="#inkycal.utils.functions.get_inkycal_version" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Resolve Inkycal version.</p>
<p>Priority:
1. Installed package metadata (preferred, matches pyproject.toml)
2. _version.txt inside the package (editable / dev fallback)</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/utils/functions.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_inkycal_version</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Resolve Inkycal version.</span>

<span class="sd">    Priority:</span>
<span class="sd">    1. Installed package metadata (preferred, matches pyproject.toml)</span>
<span class="sd">    2. _version.txt inside the package (editable / dev fallback)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pkg_version</span><span class="p">(</span><span class="s2">&quot;inkycal&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">PackageNotFoundError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">version_file</span> <span class="o">=</span> <span class="n">files</span><span class="p">(</span><span class="s2">&quot;inkycal&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;_version.txt&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">version_file</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="inkycal.utils.functions.get_system_tz" class="doc doc-heading">
            <code class=" language-python"><span class="n">get_system_tz</span><span class="p">()</span></code>

<a href="#inkycal.utils.functions.get_system_tz" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Return the system's timezone as a string.</p>
<p>Attempts to detect the local timezone using <code>tzlocal</code>. If detection fails,
the function falls back to <code>"UTC"</code> and logs a warning.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The detected timezone name. Examples include:
- <code>"Europe/Berlin"</code>
- <code>"America/New_York"</code>
- <code>"UTC"</code> (fallback)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>arrow.now(tz=get_system_tz())
<Arrow [2025-02-18T12:34:56+01:00]></p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/utils/functions.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_system_tz</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the system&#39;s timezone as a string.</span>

<span class="sd">    Attempts to detect the local timezone using ``tzlocal``. If detection fails,</span>
<span class="sd">    the function falls back to ``&quot;UTC&quot;`` and logs a warning.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The detected timezone name. Examples include:</span>
<span class="sd">            - ``&quot;Europe/Berlin&quot;``</span>
<span class="sd">            - ``&quot;America/New_York&quot;``</span>
<span class="sd">            - ``&quot;UTC&quot;`` (fallback)</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; arrow.now(tz=get_system_tz())</span>
<span class="sd">        &lt;Arrow [2025-02-18T12:34:56+01:00]&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">local_tz</span> <span class="o">=</span> <span class="n">tzlocal</span><span class="o">.</span><span class="n">get_localzone</span><span class="p">()</span><span class="o">.</span><span class="n">key</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Local system timezone is </span><span class="si">{</span><span class="n">local_tz</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;System timezone could not be parsed! Falling back to UTC.&quot;</span><span class="p">)</span>
        <span class="n">local_tz</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>

    <span class="c1"># Log formatted current time in detected TZ</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current time: </span><span class="si">{</span><span class="n">arrow</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">local_tz</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;YYYY-MM-DD HH:mm:ss ZZ&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">local_tz</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="inkycal.utils.functions.internet_available" class="doc doc-heading">
            <code class=" language-python"><span class="n">internet_available</span><span class="p">()</span></code>

<a href="#inkycal.utils.functions.internet_available" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Check whether the internet connection is reachable.</p>
<p>The function attempts 3 connections to <code>https://google.com</code> with a short
timeout. If any request succeeds, the network is considered available.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>True</code> if at least one connection attempt succeeds, otherwise</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>False</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>if internet_available():
...     print("Online!")
... else:
...     print("Offline!")</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/utils/functions.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">internet_available</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check whether the internet connection is reachable.</span>

<span class="sd">    The function attempts 3 connections to ``https://google.com`` with a short</span>
<span class="sd">    timeout. If any request succeeds, the network is considered available.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: ``True`` if at least one connection attempt succeeds, otherwise</span>
<span class="sd">        ``False``.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; if internet_available():</span>
<span class="sd">        ...     print(&quot;Online!&quot;)</span>
<span class="sd">        ... else:</span>
<span class="sd">        ...     print(&quot;Offline!&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://google.com&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Network could not be reached: </span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="inkycal.utils.functions.render_line_chart" class="doc doc-heading">
            <code class=" language-python"><span class="n">render_line_chart</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">bg_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

<a href="#inkycal.utils.functions.render_line_chart" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Render a lightweight line chart using Pillow.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="typing.Sequence">Sequence</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list/tuple of numeric values to plot. Must contain at least 2
points to draw a line.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>size</code>
            </td>
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output image size <code>(width, height)</code>.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>line_width</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Thickness of the plotted line.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>line_color</code>
            </td>
            <td>
                  <code><span title="str">str</span> or <span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Colour of the line. Accepts any Pillow colour value.</p>
              </div>
            </td>
            <td>
                  <code>&#39;black&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bg_color</code>
            </td>
            <td>
                  <code><span title="str">str</span> or <span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Background colour.</p>
              </div>
            </td>
            <td>
                  <code>&#39;white&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Inner padding in pixels (space to chart edges).</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="PIL.Image.Image">Image</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PIL.Image.Image:
A new image containing the rendered chart.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Scaling is automatically normalized between min(values) and
  max(values).</li>
<li>Used primarily by the Stocks module.</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>img = render_line_chart([1, 3, 2, 5], (200, 80))
img.show()</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="mkdocstrings-source">
              <summary>Source code in <code>inkycal/utils/functions.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">render_line_chart</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">line_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">bg_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Render a lightweight line chart using Pillow.</span>

<span class="sd">    Args:</span>
<span class="sd">        values (Sequence[float]):</span>
<span class="sd">            A list/tuple of numeric values to plot. Must contain at least 2</span>
<span class="sd">            points to draw a line.</span>

<span class="sd">        size (Tuple[int, int]):</span>
<span class="sd">            Output image size ``(width, height)``.</span>

<span class="sd">        line_width (int, optional):</span>
<span class="sd">            Thickness of the plotted line.</span>

<span class="sd">        line_color (str or tuple, optional):</span>
<span class="sd">            Colour of the line. Accepts any Pillow colour value.</span>

<span class="sd">        bg_color (str or tuple, optional):</span>
<span class="sd">            Background colour.</span>

<span class="sd">        padding (int, optional):</span>
<span class="sd">            Inner padding in pixels (space to chart edges).</span>

<span class="sd">    Returns:</span>
<span class="sd">        PIL.Image.Image:</span>
<span class="sd">            A new image containing the rendered chart.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Scaling is automatically normalized between min(values) and</span>
<span class="sd">          max(values).</span>
<span class="sd">        - Used primarily by the Stocks module.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; img = render_line_chart([1, 3, 2, 5], (200, 80))</span>
<span class="sd">        &gt;&gt;&gt; img.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">size</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">bg_color</span><span class="p">)</span>
    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">img</span>  <span class="c1"># nothing to draw</span>

    <span class="n">v_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">v_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="c1"># Avoid division by zero for flat datasets</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">):</span>
        <span class="n">v_min</span> <span class="o">-=</span> <span class="mf">1.0</span>
        <span class="n">v_max</span> <span class="o">+=</span> <span class="mf">1.0</span>

    <span class="n">inner_w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">padding</span><span class="p">)</span>
    <span class="n">inner_h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">padding</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_xy</span><span class="p">(</span><span class="n">idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform a value into canvas coordinates.&quot;&quot;&quot;</span>
        <span class="c1"># X: evenly spaced</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">padding</span> <span class="o">+</span> <span class="p">(</span><span class="n">inner_w</span> <span class="o">*</span> <span class="n">idx</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">padding</span> <span class="o">+</span> <span class="n">inner_w</span> <span class="o">/</span> <span class="mi">2</span>

        <span class="c1"># Y: inverted because (0,0) is top-left</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="n">v_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">v_max</span> <span class="o">-</span> <span class="n">v_min</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">padding</span> <span class="o">+</span> <span class="n">inner_h</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">norm</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_xy</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span>

    <span class="n">draw</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">line_color</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">line_width</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h3 id="enumerations-fonts-settings">Enumerations (fonts, settings)<a class="headerlink" href="#enumerations-fonts-settings" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.utils.enums"></a>
    <div class="doc doc-contents first">

        <p>enums.py</p>










<div class="doc doc-children">












  </div>

    </div>

</div><h3 id="supported-display-models">Supported Display Models<a class="headerlink" href="#supported-display-models" title="Permanent link">&para;</a></h3>


<div class="doc doc-object doc-module">



<a id="inkycal.display.supported_models"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">












  </div>

    </div>

</div><hr />
<h1 id="summary">ðŸ Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h1>
<p>This API reference is meant as a central index for:</p>
<ul>
<li>All modules  </li>
<li>Rendering engine (Canvas)  </li>
<li>ePaper Display driver  </li>
<li>Utilities  </li>
</ul>
<p>If you are developing your own module, be sure to check:</p>
<ul>
<li><code>template.py</code>  </li>
<li>Developer Guide (<code>dev_doc.md</code>)  </li>
<li>Canvas documentation (<code>canvas.md</code>)  </li>
</ul>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.instant", "navigation.expand", "navigation.top", "content.code.copy", "content.action.edit", "content.tooltips", "toc.follow"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>